{"version":3,"file":"lovelace-bubble-room.js","sources":["node_modules/@lit/reactive-element/css-tag.js","node_modules/@lit/reactive-element/reactive-element.js","node_modules/lit-html/lit-html.js","node_modules/lit-element/lit-element.js","src/helpers/entity-filters.js","src/helpers/auto-discovery.js","src/helpers/icon-mapping.js","src/helpers/icon-cache.js","src/panels/RoomPanel.js","src/helpers/sensor-mapping.js","src/panels/shared-styles.js","src/panels/SensorPanel.js","src/panels/MushroomPanel.js","src/panels/SubButtonPanel.js","src/panels/ColorPanel.js","src/panels/CameraPanel.js","src/panels/ClimatePanel.js","src/bubble-room-editor.js","src/components/BubbleSubButton.js","src/components/BubbleName.js","src/components/BubbleSensor.js","src/components/BubbleMushroom.js","src/components/BubbleIcon.js","src/bubble-room.js"],"sourcesContent":["/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\nconst t=window,e=t.ShadowRoot&&(void 0===t.ShadyCSS||t.ShadyCSS.nativeShadow)&&\"adoptedStyleSheets\"in Document.prototype&&\"replace\"in CSSStyleSheet.prototype,s=Symbol(),n=new WeakMap;class o{constructor(t,e,n){if(this._$cssResult$=!0,n!==s)throw Error(\"CSSResult is not constructable. Use `unsafeCSS` or `css` instead.\");this.cssText=t,this.t=e}get styleSheet(){let t=this.o;const s=this.t;if(e&&void 0===t){const e=void 0!==s&&1===s.length;e&&(t=n.get(s)),void 0===t&&((this.o=t=new CSSStyleSheet).replaceSync(this.cssText),e&&n.set(s,t))}return t}toString(){return this.cssText}}const r=t=>new o(\"string\"==typeof t?t:t+\"\",void 0,s),i=(t,...e)=>{const n=1===t.length?t[0]:e.reduce(((e,s,n)=>e+(t=>{if(!0===t._$cssResult$)return t.cssText;if(\"number\"==typeof t)return t;throw Error(\"Value passed to 'css' function must be a 'css' function result: \"+t+\". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.\")})(s)+t[n+1]),t[0]);return new o(n,t,s)},S=(s,n)=>{e?s.adoptedStyleSheets=n.map((t=>t instanceof CSSStyleSheet?t:t.styleSheet)):n.forEach((e=>{const n=document.createElement(\"style\"),o=t.litNonce;void 0!==o&&n.setAttribute(\"nonce\",o),n.textContent=e.cssText,s.appendChild(n)}))},c=e?t=>t:t=>t instanceof CSSStyleSheet?(t=>{let e=\"\";for(const s of t.cssRules)e+=s.cssText;return r(e)})(t):t;export{o as CSSResult,S as adoptStyles,i as css,c as getCompatibleStyle,e as supportsAdoptingStyleSheets,r as unsafeCSS};\n//# sourceMappingURL=css-tag.js.map\n","import{getCompatibleStyle as t,adoptStyles as i}from\"./css-tag.js\";export{CSSResult,adoptStyles,css,getCompatibleStyle,supportsAdoptingStyleSheets,unsafeCSS}from\"./css-tag.js\";\n/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */var s;const e=window,r=e.trustedTypes,h=r?r.emptyScript:\"\",o=e.reactiveElementPolyfillSupport,n={toAttribute(t,i){switch(i){case Boolean:t=t?h:null;break;case Object:case Array:t=null==t?t:JSON.stringify(t)}return t},fromAttribute(t,i){let s=t;switch(i){case Boolean:s=null!==t;break;case Number:s=null===t?null:Number(t);break;case Object:case Array:try{s=JSON.parse(t)}catch(t){s=null}}return s}},a=(t,i)=>i!==t&&(i==i||t==t),l={attribute:!0,type:String,converter:n,reflect:!1,hasChanged:a},d=\"finalized\";class u extends HTMLElement{constructor(){super(),this._$Ei=new Map,this.isUpdatePending=!1,this.hasUpdated=!1,this._$El=null,this._$Eu()}static addInitializer(t){var i;this.finalize(),(null!==(i=this.h)&&void 0!==i?i:this.h=[]).push(t)}static get observedAttributes(){this.finalize();const t=[];return this.elementProperties.forEach(((i,s)=>{const e=this._$Ep(s,i);void 0!==e&&(this._$Ev.set(e,s),t.push(e))})),t}static createProperty(t,i=l){if(i.state&&(i.attribute=!1),this.finalize(),this.elementProperties.set(t,i),!i.noAccessor&&!this.prototype.hasOwnProperty(t)){const s=\"symbol\"==typeof t?Symbol():\"__\"+t,e=this.getPropertyDescriptor(t,s,i);void 0!==e&&Object.defineProperty(this.prototype,t,e)}}static getPropertyDescriptor(t,i,s){return{get(){return this[i]},set(e){const r=this[t];this[i]=e,this.requestUpdate(t,r,s)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)||l}static finalize(){if(this.hasOwnProperty(d))return!1;this[d]=!0;const t=Object.getPrototypeOf(this);if(t.finalize(),void 0!==t.h&&(this.h=[...t.h]),this.elementProperties=new Map(t.elementProperties),this._$Ev=new Map,this.hasOwnProperty(\"properties\")){const t=this.properties,i=[...Object.getOwnPropertyNames(t),...Object.getOwnPropertySymbols(t)];for(const s of i)this.createProperty(s,t[s])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(i){const s=[];if(Array.isArray(i)){const e=new Set(i.flat(1/0).reverse());for(const i of e)s.unshift(t(i))}else void 0!==i&&s.push(t(i));return s}static _$Ep(t,i){const s=i.attribute;return!1===s?void 0:\"string\"==typeof s?s:\"string\"==typeof t?t.toLowerCase():void 0}_$Eu(){var t;this._$E_=new Promise((t=>this.enableUpdating=t)),this._$AL=new Map,this._$Eg(),this.requestUpdate(),null===(t=this.constructor.h)||void 0===t||t.forEach((t=>t(this)))}addController(t){var i,s;(null!==(i=this._$ES)&&void 0!==i?i:this._$ES=[]).push(t),void 0!==this.renderRoot&&this.isConnected&&(null===(s=t.hostConnected)||void 0===s||s.call(t))}removeController(t){var i;null===(i=this._$ES)||void 0===i||i.splice(this._$ES.indexOf(t)>>>0,1)}_$Eg(){this.constructor.elementProperties.forEach(((t,i)=>{this.hasOwnProperty(i)&&(this._$Ei.set(i,this[i]),delete this[i])}))}createRenderRoot(){var t;const s=null!==(t=this.shadowRoot)&&void 0!==t?t:this.attachShadow(this.constructor.shadowRootOptions);return i(s,this.constructor.elementStyles),s}connectedCallback(){var t;void 0===this.renderRoot&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),null===(t=this._$ES)||void 0===t||t.forEach((t=>{var i;return null===(i=t.hostConnected)||void 0===i?void 0:i.call(t)}))}enableUpdating(t){}disconnectedCallback(){var t;null===(t=this._$ES)||void 0===t||t.forEach((t=>{var i;return null===(i=t.hostDisconnected)||void 0===i?void 0:i.call(t)}))}attributeChangedCallback(t,i,s){this._$AK(t,s)}_$EO(t,i,s=l){var e;const r=this.constructor._$Ep(t,s);if(void 0!==r&&!0===s.reflect){const h=(void 0!==(null===(e=s.converter)||void 0===e?void 0:e.toAttribute)?s.converter:n).toAttribute(i,s.type);this._$El=t,null==h?this.removeAttribute(r):this.setAttribute(r,h),this._$El=null}}_$AK(t,i){var s;const e=this.constructor,r=e._$Ev.get(t);if(void 0!==r&&this._$El!==r){const t=e.getPropertyOptions(r),h=\"function\"==typeof t.converter?{fromAttribute:t.converter}:void 0!==(null===(s=t.converter)||void 0===s?void 0:s.fromAttribute)?t.converter:n;this._$El=r,this[r]=h.fromAttribute(i,t.type),this._$El=null}}requestUpdate(t,i,s){let e=!0;void 0!==t&&(((s=s||this.constructor.getPropertyOptions(t)).hasChanged||a)(this[t],i)?(this._$AL.has(t)||this._$AL.set(t,i),!0===s.reflect&&this._$El!==t&&(void 0===this._$EC&&(this._$EC=new Map),this._$EC.set(t,s))):e=!1),!this.isUpdatePending&&e&&(this._$E_=this._$Ej())}async _$Ej(){this.isUpdatePending=!0;try{await this._$E_}catch(t){Promise.reject(t)}const t=this.scheduleUpdate();return null!=t&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var t;if(!this.isUpdatePending)return;this.hasUpdated,this._$Ei&&(this._$Ei.forEach(((t,i)=>this[i]=t)),this._$Ei=void 0);let i=!1;const s=this._$AL;try{i=this.shouldUpdate(s),i?(this.willUpdate(s),null===(t=this._$ES)||void 0===t||t.forEach((t=>{var i;return null===(i=t.hostUpdate)||void 0===i?void 0:i.call(t)})),this.update(s)):this._$Ek()}catch(t){throw i=!1,this._$Ek(),t}i&&this._$AE(s)}willUpdate(t){}_$AE(t){var i;null===(i=this._$ES)||void 0===i||i.forEach((t=>{var i;return null===(i=t.hostUpdated)||void 0===i?void 0:i.call(t)})),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$Ek(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$E_}shouldUpdate(t){return!0}update(t){void 0!==this._$EC&&(this._$EC.forEach(((t,i)=>this._$EO(i,this[i],t))),this._$EC=void 0),this._$Ek()}updated(t){}firstUpdated(t){}}u[d]=!0,u.elementProperties=new Map,u.elementStyles=[],u.shadowRootOptions={mode:\"open\"},null==o||o({ReactiveElement:u}),(null!==(s=e.reactiveElementVersions)&&void 0!==s?s:e.reactiveElementVersions=[]).push(\"1.6.3\");export{u as ReactiveElement,n as defaultConverter,a as notEqual};\n//# sourceMappingURL=reactive-element.js.map\n","/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\nvar t;const i=window,s=i.trustedTypes,e=s?s.createPolicy(\"lit-html\",{createHTML:t=>t}):void 0,o=\"$lit$\",n=`lit$${(Math.random()+\"\").slice(9)}$`,l=\"?\"+n,h=`<${l}>`,r=document,u=()=>r.createComment(\"\"),d=t=>null===t||\"object\"!=typeof t&&\"function\"!=typeof t,c=Array.isArray,v=t=>c(t)||\"function\"==typeof(null==t?void 0:t[Symbol.iterator]),a=\"[ \\t\\n\\f\\r]\",f=/<(?:(!--|\\/[^a-zA-Z])|(\\/?[a-zA-Z][^>\\s]*)|(\\/?$))/g,_=/-->/g,m=/>/g,p=RegExp(`>|${a}(?:([^\\\\s\"'>=/]+)(${a}*=${a}*(?:[^ \\t\\n\\f\\r\"'\\`<>=]|(\"|')|))|$)`,\"g\"),g=/'/g,$=/\"/g,y=/^(?:script|style|textarea|title)$/i,w=t=>(i,...s)=>({_$litType$:t,strings:i,values:s}),x=w(1),b=w(2),T=Symbol.for(\"lit-noChange\"),A=Symbol.for(\"lit-nothing\"),E=new WeakMap,C=r.createTreeWalker(r,129,null,!1);function P(t,i){if(!Array.isArray(t)||!t.hasOwnProperty(\"raw\"))throw Error(\"invalid template strings array\");return void 0!==e?e.createHTML(i):i}const V=(t,i)=>{const s=t.length-1,e=[];let l,r=2===i?\"<svg>\":\"\",u=f;for(let i=0;i<s;i++){const s=t[i];let d,c,v=-1,a=0;for(;a<s.length&&(u.lastIndex=a,c=u.exec(s),null!==c);)a=u.lastIndex,u===f?\"!--\"===c[1]?u=_:void 0!==c[1]?u=m:void 0!==c[2]?(y.test(c[2])&&(l=RegExp(\"</\"+c[2],\"g\")),u=p):void 0!==c[3]&&(u=p):u===p?\">\"===c[0]?(u=null!=l?l:f,v=-1):void 0===c[1]?v=-2:(v=u.lastIndex-c[2].length,d=c[1],u=void 0===c[3]?p:'\"'===c[3]?$:g):u===$||u===g?u=p:u===_||u===m?u=f:(u=p,l=void 0);const w=u===p&&t[i+1].startsWith(\"/>\")?\" \":\"\";r+=u===f?s+h:v>=0?(e.push(d),s.slice(0,v)+o+s.slice(v)+n+w):s+n+(-2===v?(e.push(void 0),i):w)}return[P(t,r+(t[s]||\"<?>\")+(2===i?\"</svg>\":\"\")),e]};class N{constructor({strings:t,_$litType$:i},e){let h;this.parts=[];let r=0,d=0;const c=t.length-1,v=this.parts,[a,f]=V(t,i);if(this.el=N.createElement(a,e),C.currentNode=this.el.content,2===i){const t=this.el.content,i=t.firstChild;i.remove(),t.append(...i.childNodes)}for(;null!==(h=C.nextNode())&&v.length<c;){if(1===h.nodeType){if(h.hasAttributes()){const t=[];for(const i of h.getAttributeNames())if(i.endsWith(o)||i.startsWith(n)){const s=f[d++];if(t.push(i),void 0!==s){const t=h.getAttribute(s.toLowerCase()+o).split(n),i=/([.?@])?(.*)/.exec(s);v.push({type:1,index:r,name:i[2],strings:t,ctor:\".\"===i[1]?H:\"?\"===i[1]?L:\"@\"===i[1]?z:k})}else v.push({type:6,index:r})}for(const i of t)h.removeAttribute(i)}if(y.test(h.tagName)){const t=h.textContent.split(n),i=t.length-1;if(i>0){h.textContent=s?s.emptyScript:\"\";for(let s=0;s<i;s++)h.append(t[s],u()),C.nextNode(),v.push({type:2,index:++r});h.append(t[i],u())}}}else if(8===h.nodeType)if(h.data===l)v.push({type:2,index:r});else{let t=-1;for(;-1!==(t=h.data.indexOf(n,t+1));)v.push({type:7,index:r}),t+=n.length-1}r++}}static createElement(t,i){const s=r.createElement(\"template\");return s.innerHTML=t,s}}function S(t,i,s=t,e){var o,n,l,h;if(i===T)return i;let r=void 0!==e?null===(o=s._$Co)||void 0===o?void 0:o[e]:s._$Cl;const u=d(i)?void 0:i._$litDirective$;return(null==r?void 0:r.constructor)!==u&&(null===(n=null==r?void 0:r._$AO)||void 0===n||n.call(r,!1),void 0===u?r=void 0:(r=new u(t),r._$AT(t,s,e)),void 0!==e?(null!==(l=(h=s)._$Co)&&void 0!==l?l:h._$Co=[])[e]=r:s._$Cl=r),void 0!==r&&(i=S(t,r._$AS(t,i.values),r,e)),i}class M{constructor(t,i){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=i}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){var i;const{el:{content:s},parts:e}=this._$AD,o=(null!==(i=null==t?void 0:t.creationScope)&&void 0!==i?i:r).importNode(s,!0);C.currentNode=o;let n=C.nextNode(),l=0,h=0,u=e[0];for(;void 0!==u;){if(l===u.index){let i;2===u.type?i=new R(n,n.nextSibling,this,t):1===u.type?i=new u.ctor(n,u.name,u.strings,this,t):6===u.type&&(i=new Z(n,this,t)),this._$AV.push(i),u=e[++h]}l!==(null==u?void 0:u.index)&&(n=C.nextNode(),l++)}return C.currentNode=r,o}v(t){let i=0;for(const s of this._$AV)void 0!==s&&(void 0!==s.strings?(s._$AI(t,s,i),i+=s.strings.length-2):s._$AI(t[i])),i++}}class R{constructor(t,i,s,e){var o;this.type=2,this._$AH=A,this._$AN=void 0,this._$AA=t,this._$AB=i,this._$AM=s,this.options=e,this._$Cp=null===(o=null==e?void 0:e.isConnected)||void 0===o||o}get _$AU(){var t,i;return null!==(i=null===(t=this._$AM)||void 0===t?void 0:t._$AU)&&void 0!==i?i:this._$Cp}get parentNode(){let t=this._$AA.parentNode;const i=this._$AM;return void 0!==i&&11===(null==t?void 0:t.nodeType)&&(t=i.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,i=this){t=S(this,t,i),d(t)?t===A||null==t||\"\"===t?(this._$AH!==A&&this._$AR(),this._$AH=A):t!==this._$AH&&t!==T&&this._(t):void 0!==t._$litType$?this.g(t):void 0!==t.nodeType?this.$(t):v(t)?this.T(t):this._(t)}k(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}$(t){this._$AH!==t&&(this._$AR(),this._$AH=this.k(t))}_(t){this._$AH!==A&&d(this._$AH)?this._$AA.nextSibling.data=t:this.$(r.createTextNode(t)),this._$AH=t}g(t){var i;const{values:s,_$litType$:e}=t,o=\"number\"==typeof e?this._$AC(t):(void 0===e.el&&(e.el=N.createElement(P(e.h,e.h[0]),this.options)),e);if((null===(i=this._$AH)||void 0===i?void 0:i._$AD)===o)this._$AH.v(s);else{const t=new M(o,this),i=t.u(this.options);t.v(s),this.$(i),this._$AH=t}}_$AC(t){let i=E.get(t.strings);return void 0===i&&E.set(t.strings,i=new N(t)),i}T(t){c(this._$AH)||(this._$AH=[],this._$AR());const i=this._$AH;let s,e=0;for(const o of t)e===i.length?i.push(s=new R(this.k(u()),this.k(u()),this,this.options)):s=i[e],s._$AI(o),e++;e<i.length&&(this._$AR(s&&s._$AB.nextSibling,e),i.length=e)}_$AR(t=this._$AA.nextSibling,i){var s;for(null===(s=this._$AP)||void 0===s||s.call(this,!1,!0,i);t&&t!==this._$AB;){const i=t.nextSibling;t.remove(),t=i}}setConnected(t){var i;void 0===this._$AM&&(this._$Cp=t,null===(i=this._$AP)||void 0===i||i.call(this,t))}}class k{constructor(t,i,s,e,o){this.type=1,this._$AH=A,this._$AN=void 0,this.element=t,this.name=i,this._$AM=e,this.options=o,s.length>2||\"\"!==s[0]||\"\"!==s[1]?(this._$AH=Array(s.length-1).fill(new String),this.strings=s):this._$AH=A}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(t,i=this,s,e){const o=this.strings;let n=!1;if(void 0===o)t=S(this,t,i,0),n=!d(t)||t!==this._$AH&&t!==T,n&&(this._$AH=t);else{const e=t;let l,h;for(t=o[0],l=0;l<o.length-1;l++)h=S(this,e[s+l],i,l),h===T&&(h=this._$AH[l]),n||(n=!d(h)||h!==this._$AH[l]),h===A?t=A:t!==A&&(t+=(null!=h?h:\"\")+o[l+1]),this._$AH[l]=h}n&&!e&&this.j(t)}j(t){t===A?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,null!=t?t:\"\")}}class H extends k{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===A?void 0:t}}const I=s?s.emptyScript:\"\";class L extends k{constructor(){super(...arguments),this.type=4}j(t){t&&t!==A?this.element.setAttribute(this.name,I):this.element.removeAttribute(this.name)}}class z extends k{constructor(t,i,s,e,o){super(t,i,s,e,o),this.type=5}_$AI(t,i=this){var s;if((t=null!==(s=S(this,t,i,0))&&void 0!==s?s:A)===T)return;const e=this._$AH,o=t===A&&e!==A||t.capture!==e.capture||t.once!==e.once||t.passive!==e.passive,n=t!==A&&(e===A||o);o&&this.element.removeEventListener(this.name,this,e),n&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){var i,s;\"function\"==typeof this._$AH?this._$AH.call(null!==(s=null===(i=this.options)||void 0===i?void 0:i.host)&&void 0!==s?s:this.element,t):this._$AH.handleEvent(t)}}class Z{constructor(t,i,s){this.element=t,this.type=6,this._$AN=void 0,this._$AM=i,this.options=s}get _$AU(){return this._$AM._$AU}_$AI(t){S(this,t)}}const j={O:o,P:n,A:l,C:1,M:V,L:M,R:v,D:S,I:R,V:k,H:L,N:z,U:H,F:Z},B=i.litHtmlPolyfillSupport;null==B||B(N,R),(null!==(t=i.litHtmlVersions)&&void 0!==t?t:i.litHtmlVersions=[]).push(\"2.8.0\");const D=(t,i,s)=>{var e,o;const n=null!==(e=null==s?void 0:s.renderBefore)&&void 0!==e?e:i;let l=n._$litPart$;if(void 0===l){const t=null!==(o=null==s?void 0:s.renderBefore)&&void 0!==o?o:null;n._$litPart$=l=new R(i.insertBefore(u(),t),t,void 0,null!=s?s:{})}return l._$AI(t),l};export{j as _$LH,x as html,T as noChange,A as nothing,D as render,b as svg};\n//# sourceMappingURL=lit-html.js.map\n","import{ReactiveElement as t}from\"@lit/reactive-element\";export*from\"@lit/reactive-element\";import{render as e,noChange as i}from\"lit-html\";export*from\"lit-html\";\n/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */var l,o;const r=t;class s extends t{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var t,e;const i=super.createRenderRoot();return null!==(t=(e=this.renderOptions).renderBefore)&&void 0!==t||(e.renderBefore=i.firstChild),i}update(t){const i=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(t),this._$Do=e(i,this.renderRoot,this.renderOptions)}connectedCallback(){var t;super.connectedCallback(),null===(t=this._$Do)||void 0===t||t.setConnected(!0)}disconnectedCallback(){var t;super.disconnectedCallback(),null===(t=this._$Do)||void 0===t||t.setConnected(!1)}render(){return i}}s.finalized=!0,s._$litElement$=!0,null===(l=globalThis.litElementHydrateSupport)||void 0===l||l.call(globalThis,{LitElement:s});const n=globalThis.litElementPolyfillSupport;null==n||n({LitElement:s});const h={_$AK:(t,e,i)=>{t._$AK(e,i)},_$AL:t=>t._$AL};(null!==(o=globalThis.litElementVersions)&&void 0!==o?o:globalThis.litElementVersions=[]).push(\"3.3.3\");export{s as LitElement,r as UpdatingElement,h as _$LE};\n//# sourceMappingURL=lit-element.js.map\n","// src/helpers/entity-filters.js\n\n/* ───────────── etichette da mostrare sui chip ───────────── */\nexport const FILTER_LABELS = {\n  alarm_control_panel: 'Alarms',\n  binary_sensor: 'Binary Sensors',\n  camera: 'Cameras',\n  climate: 'Climate',\n  cover: 'Covers',\n  fan: 'Fan',\n  light: 'Light',\n  lock: 'Lock',\n  media_player: 'Media Player',\n  scene: 'Scenes',\n  script: 'Scripts',\n  siren: 'Siren',\n  vacuum: 'Vacuum',\n  motion: 'Motion',\n  occupancy: 'Occupancy',\n  presence: 'Presence',\n  moving: 'Moving',\n  door: 'Door',\n  window: 'Window',\n  opening: 'Opening',\n  garage_door: 'Garage Door',\n  vibration: 'Vibration',\n  sound: 'Sound',\n  moisture: 'Moisture/Leak',\n  water: 'Water/Leak',\n  smoke: 'Smoke',\n  gas: 'Gas',\n  carbon_monoxide: 'Carbon Monoxide',\n  cold: 'Cold',\n  heat: 'Heat',\n  light_level: 'Light Level',\n  connectivity: 'Connectivity',\n  lock_dc: 'Lock (status)', // opzionale se lo usi come DC\n  plug: 'Plug',\n  power: 'Power',\n  problem: 'Problem',\n  running: 'Running',\n  safety: 'Safety',\n  tamper: 'Tamper',\n  update: 'Update',\n  switch: 'Switch',\n  input_boolean: 'Boolean Switch',\n};\n\n/* ───────────── domini comuni (senza “sensor”) ───────────── */\nexport const COMMON_CATS = [\n  'alarm_control_panel',\n  'binary_sensor',\n  'camera',\n  'climate',\n  'cover',\n  'fan',\n  'input_boolean',\n  'light',\n  'lock',\n  'media_player',\n  'scene',\n  'script',\n  'siren',\n  'switch',\n  'vacuum',\n];\n\n/* —— device_class comuni dei binary_sensor rese selezionabili in UI —— */\nexport const BINARY_SENSOR_CATS = [\n  'motion', 'occupancy', 'presence', 'moving',\n  'door', 'window', 'opening', 'garage_door',\n  'vibration', 'sound', 'moisture', 'water', 'smoke', 'gas', 'carbon_monoxide',\n  'cold', 'heat', 'light_level', 'connectivity',\n  'plug', 'power', 'problem', 'running', 'safety', 'tamper', 'update'\n];\n\n/* ───────────── filtri di sezione (criteri dominio/device_class; niente area qui) ───────────── */\nexport const FILTERS = {\n  presence: (cats = []) => ({\n    includeDomains: COMMON_CATS,\n    entityFilter: (id, hass) => {\n      if (!cats.length) return false;\n      const [domain] = id.split('.');\n      if (domain === 'binary_sensor') {\n        const dc = hass.states[id]?.attributes?.device_class ?? '';\n        return cats.includes(dc);\n      }\n      return cats.includes(domain);\n    },\n  }),\n  \n  sensor: (cats = []) => ({\n    includeDomains: ['sensor'],\n    entityFilter: (id, hass) => {\n      if (!cats.length) return true;\n      const dc = hass.states[id]?.attributes?.device_class ?? '';\n      return cats.includes(dc);\n    },\n  }),\n  \n  mushroom: (cats = []) => ({\n    includeDomains: COMMON_CATS,\n    entityFilter: (id, hass) => {\n      if (!cats.length) {\n        // default: propone i binary_sensor\n        return id.split('.')[0] === 'binary_sensor';\n      }\n      const [domain] = id.split('.');\n      if (domain === 'binary_sensor') {\n        const dc = hass.states[id]?.attributes?.device_class ?? '';\n        return cats.includes(dc);\n      }\n      return cats.includes(domain);\n    },\n  }),\n  subbutton: (cats = []) => ({\n    includeDomains: COMMON_CATS,\n    entityFilter: (id, hass) => {\n      const [domain] = id.split('.');\n      \n      // Se nessun chip selezionato → mostra tutti i domini consentiti\n      if (!cats.length) {\n        return COMMON_CATS.includes(domain);\n      }\n      \n      // Se è un binary_sensor → filtra per device_class (chip come: motion, occupancy, ecc.)\n      if (domain === 'binary_sensor') {\n        const dc = hass.states[id]?.attributes?.device_class ?? '';\n        return cats.includes(dc);\n      }\n      \n      // Altrimenti → filtra per dominio in base ai chip selezionati (fan, light, scene, ecc.)\n      return cats.includes(domain);\n    },\n  }),\n  \n  camera: (cats = []) => ({\n    includeDomains: ['camera'],\n    entityFilter: (id, hass) => {\n      if (!cats.length) return true;\n      const dc = hass.states[id]?.attributes?.device_class ?? '';\n      return cats.includes(dc);\n    },\n  }),\n  \n  climate: (_cats = []) => ({\n    includeDomains: ['climate'],\n    entityFilter: (_id, _hass) => true,\n  }),\n};\n\n/* ───────────── helpers: normalizza registri che possono essere array o mappe ───────────── */\nfunction _toEntityMap(entities) {\n  if (!entities) return {};\n  if (!Array.isArray(entities)) return entities; // già mappa {entity_id: {...}}\n  const map = {};\n  for (const e of entities) {\n    const id = e?.entity_id || e?.id;\n    if (id) map[id] = e;\n  }\n  return map;\n}\n\nfunction _toDeviceMap(devices) {\n  if (!devices) return {};\n  if (!Array.isArray(devices)) return devices; // già mappa {device_id: {...}} o {id: {...}}\n  const map = {};\n  for (const d of devices) {\n    const id = d?.id || d?.device_id;\n    if (id) map[id] = d;\n  }\n  return map;\n}\n\n/* ───────────── helpers area (SOLO area_id, qualsiasi stringa non vuota) ───────────── */\nfunction _isValidAreaId(areaId) {\n  return typeof areaId === 'string' && areaId.trim().length > 0;\n}\n\n/** Verifica se una entity è nell'area indicata (solo confronti su area_id). */\nfunction _matchAreaId(hass, entityId, areaId) {\n  if (!_isValidAreaId(areaId)) return true;\n  \n  const entReg = _toEntityMap(hass?.entities);\n  const devReg = _toDeviceMap(hass?.devices);\n  \n  // 1) entity registry → area_id\n  const regEnt = entReg[entityId];\n  if (regEnt?.area_id === areaId) return true;\n  \n  // 2) entity registry → device_id → device.area_id\n  const devId = regEnt?.device_id || regEnt?.deviceId;\n  if (devId && devReg[devId]?.area_id === areaId) return true;\n  \n  // 3) stato → attributes.area_id\n  const attrAreaId = hass?.states?.[entityId]?.attributes?.area_id;\n  return attrAreaId === areaId;\n}\n\n/* ───────────── keep-selected uniforme ───────────── */\nfunction _keepSelectedFirst(list, selected) {\n  const out = Array.from(new Set(list));\n  const sel = Array.isArray(selected) ? selected : (selected ? [selected] : []);\n  for (let i = sel.length - 1; i >= 0; i--) {\n    const s = sel[i];\n    if (s && !out.includes(s)) out.unshift(s);\n  }\n  return out;\n}\n\n/** estrae TUTTE le entity già selezionate in una sezione (ricorsivo) */\nfunction _extractSelectedEntities(sectionConfig) {\n  const acc = new Set();\n  const walk = (v) => {\n    if (!v) return;\n    if (typeof v === 'string' && v.includes('.')) {\n      acc.add(v);\n      return;\n    }\n    if (Array.isArray(v)) {\n      v.forEach(walk);\n      return;\n    }\n    if (typeof v === 'object') {\n      Object.values(v).forEach(walk);\n    }\n  };\n  walk(sectionConfig);\n  return Array.from(acc);\n}\n\n/* ───────────── utility: tutte le entity in una certa area (SOLO area_id) ───────────── */\nexport function entitiesInArea(hass, areaId) {\n  if (!hass?.states || !_isValidAreaId(areaId)) return [];\n  return Object.keys(hass.states).filter((eid) => _matchAreaId(hass, eid, areaId));\n}\n\n/* ───────────── candidatesFor: lista per i selector (area-aware + keep-selected) ─────────────\n   Regole:\n   - Se c’è area_id (in config.area_id o config.area) → prova a filtrare per area (fallback se vuoto).\n   - Metti SEMPRE in testa le entità già selezionate in quella sezione (qualsiasi struttura).\n*/\nexport function candidatesFor(hass, config, section, cats = []) {\n  if (!hass?.states) return [];\n  \n  // 1) filtri base per sezione\n  let desc;\n  if (section === 'presence') {\n    desc = FILTERS.presence(cats);\n  } else if (section === 'sensor') {\n    desc = FILTERS.sensor(cats);\n  } else if (section === 'mushroom') {\n    desc = FILTERS.mushroom(cats);\n  } else if (section === 'subbutton') {\n    desc = FILTERS.subbutton(cats);\n  } else if (section === 'camera') {\n    desc = FILTERS.camera(cats);\n  } else if (section === 'climate') {\n    desc = FILTERS.climate(cats);\n  }\n  \n  if (!desc) return [];\n  \n  // 2) filtro per dominio\n  const byDomain = Object.keys(hass.states).filter((id) =>\n    desc.includeDomains.includes(id.split('.')[0])\n  );\n  \n  // 3) filtro specifico (device_class/domains)\n  const byDesc = byDomain.filter((id) => desc.entityFilter(id, hass));\n  \n  // 4) scoping per area (SOLO area_id) con fallback\n  let scoped = byDesc;\n  const areaId = typeof config?.area_id === 'string' ? config.area_id : config?.area;\n  if (_isValidAreaId(areaId)) {\n    const inArea = entitiesInArea(hass, areaId);\n    const filtered = byDesc.filter((id) => inArea.includes(id));\n    if (filtered.length) scoped = filtered; // fallback automatico se vuoto\n  }\n  \n  // 5) keep-selected per TUTTE le sezioni\n  const sectionCfg = section === 'subbutton' ?\n    config?.subbuttons :\n    config?.entities?.[section];\n  const selectedAll = _extractSelectedEntities(sectionCfg);\n  return _keepSelectedFirst(scoped, selectedAll);\n}","// src/helpers/auto-discovery.js\nimport { candidatesFor } from './entity-filters.js';\n\nconst DEBUG = !!window.__BUBBLE_DEBUG__;\n\n/* ===============================\n *  Helper generici riutilizzabili\n * =============================== */\n\n/** Ricava { areaId, areaName } dalla config, con risoluzione da nome → area_id se possibile. */\nfunction resolveAreaRef(hass, config) {\n  const raw = Array.isArray(config?.area) ? config.area[0] : config?.area;\n  const areaName = (typeof raw === 'string' && !raw.startsWith('area_')) ? raw : '';\n  let areaId = (typeof raw === 'string' && raw.startsWith('area_')) ? raw : '';\n\n  const areas = Array.isArray(hass?.areas) ? hass.areas : [];\n  if (!areaId && areas.length && areaName) {\n    const hit = areas.find((a) => (a.name || '').toLowerCase() === String(areaName).toLowerCase());\n    if (hit?.area_id) areaId = hit.area_id;\n  }\n\n  return { areaId, areaName };\n}\n\n/** Prova a determinare l'area di un entity id usando registry (entity→area_id o device→area_id) o gli attributi di stato. */\nfunction matchArea(hass, id, areaId, areaName) {\n  if (!(areaId || areaName)) return true;\n\n  const reg = hass?.entities;\n  const devices = hass?.devices;\n\n  // 1) entity registry → area_id diretto\n  const regEnt = reg?.[id];\n  if (regEnt?.area_id && areaId) return regEnt.area_id === areaId;\n\n  // 2) entity registry → device_id → device.area_id\n  if (regEnt?.device_id && Array.isArray(devices)) {\n    const dev = devices.find((d) => d.id === regEnt.device_id || d.device_id === regEnt.device_id);\n    if (dev?.area_id && areaId) return dev.area_id === areaId;\n  }\n\n  // 3) stato → attributes.area_id / attributes.area (nome)\n  const st = hass?.states?.[id];\n  if (st) {\n    const attrAreaId   = st.attributes?.area_id;\n    const attrAreaName = st.attributes?.area;\n    if (areaId && attrAreaId)   return attrAreaId === areaId;\n    if (areaName && attrAreaName) {\n      return String(attrAreaName).toLowerCase() === String(areaName).toLowerCase();\n    }\n  }\n\n  // se non trovo nulla di determinante, non escludo\n  return true;\n}\n\n/** Filtra la lista per area e garantisce che l’eventuale entità già selezionata resti in lista (prima posizione). */\nfunction filterByAreaKeepSelected(hass, list, areaRef, selected) {\n  const { areaId, areaName } = areaRef;\n  let filtered = (list || []).filter((id) => matchArea(hass, id, areaId, areaName)); // se non ci sono entità per l’area selezionata → nessuna entità\n  if ((areaId || areaName) && filtered.length === 0) {\n    filtered = [];\n  }\n\n  if (selected && !filtered.includes(selected)) filtered.unshift(selected);\n  return Array.from(new Set(filtered));\n}\n\n/** Raccoglie candidati dal pipeline “candidatesFor”, con fallback a hass.states se vuoto. */\nfunction gatherCandidates(hass, config, sectionOrDomain) {\n  let list = candidatesFor(hass, config, sectionOrDomain) || [];\n  if (!list.length && hass?.states) {\n    list = Object.keys(hass.states);\n  }\n  return list;\n}\n\n/** Generico “autofill” per dominio (es.: climate, camera) con filtro per area. */\nfunction autoFillByDomain(hass, config, domain, key) {\n  const entities = { ...(config.entities || {}) };\n  const slot = entities[key] || (entities[key] = {});\n  if (slot.entity) return { ...config, entities }; // già valorizzato\n\n  // 1) prova col canale specifico del dominio (se esiste nel filtro custom)\n  let pool = gatherCandidates(hass, config, domain);\n  if (!pool.length) {\n    // 2) fallback: usa i candidati \"mushroom\" e poi filtra per dominio\n    pool = gatherCandidates(hass, config, 'mushroom');\n  }\n  pool = (pool || []).filter((id) => id.startsWith(`${domain}.`));\n\n  // 3) filtro per area robusto\n  const areaRef = resolveAreaRef(hass, config);\n  const filtered = filterByAreaKeepSelected(hass, pool, areaRef, slot.entity);\n\n  // 4) prendo il primo utile\n  const pick = (filtered[0] || '');\n  if (pick) slot.entity = pick;\n\n  if (DEBUG) {\n    console.info(`[AutoDiscovery][${key}]`, {\n      domain, chosen: slot.entity, areaRef, pool: pool.length, filtered: filtered.length,\n    });\n  }\n\n  return { ...config, entities };\n}\n\n/** Trova il primo elemento non usato in “list”. */\nconst pickFirstFree = (list, used) => list.find((id) => !used.has(id)) || null;\n\n/* =========================\n *   AUTO-FILL (per sezione)\n * ========================= */\n\n/** Sensori: riempi sensor1..sensor8 (chiave .entity_id in alcune versioni, restiamo compatibili) */\nexport function autoFillSensors(hass, config) {\n  const keys = [\n    'sensor1','sensor2','sensor3','sensor4',\n    'sensor5','sensor6','sensor7','sensor8'\n  ];\n  const entities = { ...(config.entities || {}) };\n\n  // supporta sia .entity che .entity_id (compat retro)\n  const used = new Set(\n    keys.map((k) => entities[k]?.entity || entities[k]?.entity_id).filter(Boolean)\n  );\n\n  for (const k of keys) {\n    const ent = entities[k] || (entities[k] = {});\n    const already = ent.entity || ent.entity_id;\n    if (already) continue;\n\n    const type = ent.type || '';\n    const list = candidatesFor(hass, config, { section: 'sensor', type }) || [];\n    const pick = pickFirstFree(list, used);\n    if (pick) {\n      // preferisci .entity se nel resto del progetto usi quello\n      ent.entity = pick;\n      delete ent.entity_id;\n      used.add(pick);\n    }\n  }\n  return { ...config, entities };\n}\n\n/** Mushroom (5 slot + climate + camera) */\nexport function autoFillMushrooms(hass, config) {\n  const order = ['climate','camera','mushroom1','mushroom2','mushroom3','mushroom4','mushroom5'];\n  const entities = { ...(config.entities || {}) };\n  const used = new Set(order.map((k) => entities[k]?.entity).filter(Boolean));\n\n  // base candidati generici (poi filtriamo)\n  let all = gatherCandidates(hass, config, 'mushroom');\n\n  // climate\n  const cli = entities.climate || (entities.climate = {});\n  if (!cli.entity) {\n    const pick = all.find((id) => id.startsWith('climate.') && !used.has(id));\n    if (pick) { cli.entity = pick; used.add(pick); }\n  }\n\n  // camera\n  const cam = entities.camera || (entities.camera = {});\n  if (!cam.entity) {\n    const pick = all.find((id) => id.startsWith('camera.') && !used.has(id));\n    if (pick) { cam.entity = pick; used.add(pick); }\n  }\n\n  // altri 1..5\n  for (let i = 1; i <= 5; i++) {\n    const key = `mushroom${i}`;\n    const rec = entities[key] || (entities[key] = {});\n    if (rec.entity) continue;\n    const pick = pickFirstFree(all, used);\n    if (pick) { rec.entity = pick; used.add(pick); }\n  }\n\n  return { ...config, entities };\n}\n\n/** SubButtons (6 slot) */\nexport function autoFillSubButtons(hass, config) {\n  const keys = ['sub-button1','sub-button2','sub-button3','sub-button4','sub-button5','sub-button6'];\n  const entities = { ...(config.entities || {}) };\n  const used = new Set(keys.map((k) => entities[k]?.entity).filter(Boolean));\n  const list = candidatesFor(hass, config, 'subbutton') || [];\n\n  for (const k of keys) {\n    const ent = entities[k] || (entities[k] = {});\n    if (ent.entity) continue;\n    const pick = pickFirstFree(list, used);\n    if (pick) { ent.entity = pick; used.add(pick); }\n  }\n  return { ...config, entities };\n}\n\n/* ===== Presenza (locale, con filtro area) ===== */\nfunction presenceCandidatesLocal(hass, config) {\n  if (!hass || !hass.states) return [];\n  const allowed = new Set([\n    'person','device_tracker','binary_sensor','light','switch',\n    'media_player','fan','humidifier','lock','input_boolean','scene'\n  ]);\n\n  let ids = Object.keys(hass.states).filter((id) => allowed.has(id.split('.')[0]));\n  ids = ids.filter((id) => {\n    const domain = id.split('.')[0];\n    if (domain !== 'binary_sensor') return true;\n    const dc = hass.states[id]?.attributes?.device_class;\n    return ['motion','occupancy','presence'].includes(dc || '');\n  });\n\n  // Applica il filtro per area SOLO se l'autodiscovery \"presence\" è attivo\n  const adPresence = config?.auto_discovery_sections?.presence ?? false;\n  const { areaId, areaName } = resolveAreaRef(hass, config);\n  if (adPresence && (areaId || areaName)) {\n    const inArea = ids.filter((id) => matchArea(hass, id, areaId, areaName));\n    if (inArea.length) ids = inArea;\n  }\n\n  const selected = config?.entities?.presence?.entity || config?.presence_entity;\n  if (selected && !ids.includes(selected)) ids.unshift(selected);\n\n  if (DEBUG) console.info('[AutoDiscovery][presence candidates]', {\n    areaId, areaName, count: ids.length, sample: ids.slice(0, 8)\n  });\n  return ids;\n}\n\nexport function autoFillPresence(hass, config) {\n  const entities = { ...(config.entities || {}) };\n  const ent = entities.presence || (entities.presence = {});\n  if (!ent.entity) {\n    const list = presenceCandidatesLocal(hass, config);\n    if (list.length) ent.entity = list[0];\n  }\n  return { ...config, entities };\n}\n\n/* ===== Climate & Camera — allineate e con filtro area ===== */\nexport function autoFillClimate(hass, config) {\n  return autoFillByDomain(hass, config, 'climate', 'climate');\n}\n\nexport function autoFillCamera(hass, config) {\n  return autoFillByDomain(hass, config, 'camera', 'camera');\n}\n\n/* =========================\n *           RESET\n * ========================= */\nexport function resetSensors(config) {\n  const entities = { ...(config.entities || {}) };\n  ['sensor1','sensor2','sensor3','sensor4','sensor5','sensor6','sensor7','sensor8']\n    .forEach((k) => delete entities[k]);\n  return { ...config, entities };\n}\n\nexport function resetMushrooms(config) {\n  const entities = { ...(config.entities || {}) };\n  ['mushroom1','mushroom2','mushroom3','mushroom4','mushroom5','climate','camera']\n    .forEach((k) => delete entities[k]);\n  return { ...config, entities };\n}\n\nexport function resetSubButtons(config) {\n  const entities = { ...(config.entities || {}) };\n  ['sub-button1','sub-button2','sub-button3','sub-button4','sub-button5','sub-button6']\n    .forEach((k) => delete entities[k]);\n  return { ...config, entities };\n}\n\nexport function resetRoom(config) {\n  const entities = { ...(config.entities || {}) };\n  delete entities.presence;\n  const next = { ...config, entities };\n  delete next.name;\n  delete next.icon;\n  delete next.area;\n  delete next.presence_entity;\n  return next;\n}\n\n// --- RESET DEDICATI ---\nexport function resetClimate(config) {\n  const entities = { ...(config.entities || {}) };\n  delete entities.climate;\n  return { ...config, entities };\n}\n\nexport function resetCamera(config) {\n  const entities = { ...(config.entities || {}) };\n  delete entities.camera;\n  return { ...config, entities };\n}\n\n/* =========================\n *   TRIGGER CENTRALE\n * ========================= */\nexport function maybeAutoDiscover(hass, config, changedProp, debug = false) {\n  // Se non ho hass o config coerenti, non fare nulla\n  if (!hass || !config) return config;\n\n  const ad = config.auto_discovery_sections || {};\n  const isAreaChange = changedProp === 'area';\n  const isADChange   = changedProp && String(changedProp).startsWith('auto_discovery_sections.');\n  // ⚠️ Non mutiamo più la config: l’autodiscovery resta solo “suggeritore” lato UI.\n  if ((debug || DEBUG) && typeof window !== 'undefined') {\n    console.info('[AutoDiscovery] (no-op) after', changedProp, { sections: ad, isAreaChange, isADChange });\n  }\n  return config;\n}\n\n// Manteniamo export legacy per compatibilità con script esterni.\nexport const __deprecated = {\n  resolveAreaRef,\n  matchArea,\n  filterByAreaKeepSelected,\n  gatherCandidates,\n  pickFirstFree,\n};\n","\n// src/helpers/icon-mapping.js\n\n// Cache opzionale (se non esiste il modulo, usiamo una Map interna)\nlet _cache;\ntry {\n  const { IconCache } = await import('./icon-cache.js');\n  _cache = IconCache;\n} catch (_e) {\n  _cache = {\n    _m: new Map(),\n    get(k) { return this._m.get(k); },\n    set(k, v) { this._m.set(k, v); },\n  };\n}\n\nexport const DEFAULT_ICON = 'mdi:bookmark';\n\nexport const DOMAIN_ICON_MAP = {\n  light: 'mdi:lightbulb',\n  switch: 'mdi:toggle-switch',\n  fan: 'mdi:fan',\n  climate: 'mdi:thermostat',\n  media_player: 'mdi:play-circle',\n  script: 'mdi:script-text',\n  scene: 'mdi:palette',\n  lock: 'mdi:lock',\n  camera: 'mdi:video',\n  binary_sensor: 'mdi:checkbox-marked-circle-outline',\n  sensor: 'mdi:eye',\n  alarm_control_panel: 'mdi:shield-home',\n  vacuum: 'mdi:robot-vacuum',\n  siren: 'mdi:bullhorn',\n  input_boolean: 'mdi:toggle-switch',\n  humidifier: 'mdi:air-humidifier',\n};\n\nexport const DEVICE_CLASS_ICON_MAP = {\n  door: { on: 'mdi:door-open', off: 'mdi:door-closed' },\n  window: { on: 'mdi:window-open', off: 'mdi:window-closed' },\n  motion: { on: 'mdi:motion-sensor', off: 'mdi:motion-sensor-off' },\n  moisture: { on: 'mdi:water-alert', off: 'mdi:water-off' },\n  smoke: { on: 'mdi:smoke', off: 'mdi:smoke-detector-off' },\n  gas: { on: 'mdi:gas-cylinder', off: 'mdi:gas-off' },\n  lock: { on: 'mdi:lock-open-variant', off: 'mdi:lock' },\n  garage: { on: 'mdi:garage-open', off: 'mdi:garage' },\n  light: { on: 'mdi:lightbulb-on', off: 'mdi:lightbulb-off' },\n  plug: { on: 'mdi:power-plug', off: 'mdi:power-plug-off' },\n  presence: { on: 'mdi:account', off: 'mdi:account-off' },\n  vibration: { on: 'mdi:vibrate', off: 'mdi:vibrate-off' },\n  opening: { on: 'mdi:door-open', off: 'mdi:door-closed' },\n  battery: { on: 'mdi:battery', off: 'mdi:battery-outline' },\n  connectivity: { on: 'mdi:wifi', off: 'mdi:wifi-off' },\n  safety: { on: 'mdi:shield-check', off: 'mdi:shield-off' },\n  cold: { on: 'mdi:snowflake', off: 'mdi:snowflake-off' },\n  blind: { on: 'mdi:blinds-open', off: 'mdi:blinds' },\n  curtain: { on: 'mdi:curtains-open', off: 'mdi:curtains-closed' },\n  shutter: { on: 'mdi:window-shutter-open', off: 'mdi:window-shutter' },\n  awning: { on: 'mdi:awning-open', off: 'mdi:awning' },\n  shade: { on: 'mdi:blinds-open', off: 'mdi:blinds' },\n  gate: { on: 'mdi:gate-open', off: 'mdi:gate' },\n  damper: { on: 'mdi:air-filter', off: 'mdi:air-filter-alert' },\n  garage_door: { on: 'mdi:garage-open', off: 'mdi:garage' },\n  occupancy: { on: 'mdi:account-group', off: 'mdi:account-off' },\n  running: { on: 'mdi:play', off: 'mdi:stop' },\n  problem: { on: 'mdi:alert', off: 'mdi:check-circle' },\n  sound: { on: 'mdi:volume-high', off: 'mdi:volume-off' },\n  tamper: { on: 'mdi:cellphone-alert', off: 'mdi:cellphone-check' },\n  update: { on: 'mdi:update-alert', off: 'mdi:update' },\n  carbon_monoxide: { on: 'mdi:cloud-alert', off: 'mdi:cloud-check' },\n  heat: { on: 'mdi:thermometer-high', off: 'mdi:thermometer-low' },\n  moving: { on: 'mdi:arrow-up-down-bold', off: 'mdi:ray-vertex' },\n  power: { on: 'mdi:flash', off: 'mdi:flash-off' },\n};\n\nfunction _normalizeArgs(a, b) {\n  const looksLikeHassFirst = a && typeof a === 'object' && a.states && typeof b === 'string';\n  return looksLikeHassFirst ? { entityId: b, hass: a } : { entityId: a, hass: b };\n}\n\nfunction _domain(entityId) {\n  return (entityId || '').split('.')[0] || '';\n}\n\nfunction _stateIsOnLike(s) {\n  return ['on', 'open', 'unlocked', 'playing', 'active'].includes(s);\n}\n\nexport function resolveEntityIcon(a, b) {\n  const { entityId, hass } = _normalizeArgs(a, b);\n  if (!entityId) return DEFAULT_ICON;\n\n  const cached = _cache?.get?.(entityId);\n  if (cached) return cached;\n\n  const st = hass?.states?.[entityId];\n  const attrs = st?.attributes || {};\n  const domain = _domain(entityId);\n  const state = st?.state;\n\n  if (attrs.icon) {\n    _cache?.set?.(entityId, attrs.icon);\n    return attrs.icon;\n  }\n\n  const devClass = attrs.device_class;\n  if (devClass && DEVICE_CLASS_ICON_MAP[devClass]) {\n    const icon = _stateIsOnLike(state)\n      ? DEVICE_CLASS_ICON_MAP[devClass].on\n      : DEVICE_CLASS_ICON_MAP[devClass].off;\n    _cache?.set?.(entityId, icon);\n    return icon;\n  }\n\n  const domainIconMap = {\n    light: ['mdi:lightbulb-on', 'mdi:lightbulb-off'],\n    switch: ['mdi:toggle-switch', 'mdi:toggle-switch-off'],\n    fan: ['mdi:fan', 'mdi:fan-off'],\n    lock: ['mdi:lock-open-variant', 'mdi:lock'],\n    media_player: ['mdi:play-circle', 'mdi:stop-circle'],\n    humidifier: ['mdi:air-humidifier', 'mdi:air-humidifier-off'],\n    siren: ['mdi:bullhorn-variant', 'mdi:bullhorn-outline'],\n    vacuum: ['mdi:robot-vacuum', 'mdi:robot-vacuum-off'],\n    input_boolean: ['mdi:toggle-switch', 'mdi:toggle-switch-off'],\n    scene: ['mdi:palette', 'mdi:palette-outline'],\n    script: ['mdi:script-text-play-outline', 'mdi:script-text-outline'],\n    alarm_control_panel: ['mdi:shield-lock', 'mdi:shield-outline'],\n    camera: ['mdi:cctv', 'mdi:cctv-off'],\n  };\n\n  if (domainIconMap[domain]) {\n    const [iconOn, iconOff] = domainIconMap[domain];\n    const icon = _stateIsOnLike(state) ? iconOn : iconOff;\n    _cache?.set?.(entityId, icon);\n    return icon;\n  }\n\n  const fallback = DOMAIN_ICON_MAP[domain] || DEFAULT_ICON;\n  _cache?.set?.(entityId, fallback);\n  return fallback;\n}\n\nexport default resolveEntityIcon;","// src/helpers/icon-cache.js\nexport const IconCache = {\n  _list: null,\n  get(hass) {\n    if (this._list) return this._list;\n    // Fonte: mappa icone caricata da HA in sessione\n    const map = hass?.mdiIcons || null;\n    this._list = map ? Object.keys(map).sort() : [];\n    return this._list;\n  },\n  warm(hass) {\n    // alias esplicito per “precaricare”\n    return this.get(hass);\n  }\n};\n","// src/panels/RoomPanel.js\nimport { LitElement, html, css } from 'lit';\nimport { maybeAutoDiscover } from '../helpers/auto-discovery.js';\nimport { candidatesFor }     from '../helpers/entity-filters.js';\nimport { resolveEntityIcon } from '../helpers/icon-mapping.js'; // path corretto\nimport { IconCache }         from '../helpers/icon-cache.js';\n\nconst PRESENCE_CATS = [\n  'presence',\n  'motion',\n  'occupancy',\n  'light',\n  'switch',\n  'fan',\n];\n\nexport class RoomPanel extends LitElement {\n  static properties = {\n    hass:          { type: Object },\n    config:        { type: Object },\n    _expanded:     { type: Boolean, state: true },\n    activeFilters: { type: Array,  state: true },\n    layout:        { type: String },  // 'wide' or 'tall'\n  };\n\n  static styles = css`\n    :host { display: block; }\n\n    .glass-panel {\n      margin: 0 !important;\n      width: 100%;\n      box-sizing: border-box;\n      border-radius: 40px;\n      position: relative;\n      border: none;\n      --glass-bg: rgba(73,164,255,0.38);\n      --glass-shadow: 0 2px 24px rgba(50,180,255,0.25);\n      --glass-sheen: linear-gradient(\n        120deg,\n        rgba(255,255,255,0.26),\n        rgba(255,255,255,0.11) 70%,\n        transparent 100%\n      );\n      background: var(--glass-bg);\n      box-shadow: var(--glass-shadow);\n    }\n    .glass-panel::after {\n      content: '';\n      position: absolute;\n      inset: 0;\n      border-radius: inherit;\n      background: var(--glass-sheen);\n      pointer-events: none;\n    }\n    .glass-header {\n      padding: 22px 0 18px;\n      text-align: center;\n      font-size: 1.2rem;\n      font-weight: 700;\n      color: #fff;\n    }\n\n    .input-group {\n      background: rgba(44,70,100,0.23);\n      border: 1.5px solid rgba(255,255,255,0.13);\n      box-shadow: 0 2px 14px rgba(70,120,220,0.10);\n      backdrop-filter: blur(10px) saturate(1.2);\n      border-radius: 18px;\n      margin: 0 16px 13px;\n      padding: 14px 18px 10px;\n    }\n    .input-group label {\n      display: block;\n      font-size: 1.13rem;\n      font-weight: 700;\n      color: #55afff;\n      margin-bottom: 8px;\n    }\n    .input-group input[type=\"text\"],\n    .input-group ha-selector,\n    .input-group ha-icon-picker {\n      width: 100%;\n      box-sizing: border-box;\n      min-height: 56px;\n    }\n    .input-group ha-selector::part(combobox) {\n      min-height: 56px;\n    }\n\n    .mini-pill {\n      background: rgba(44,70,100,0.23);\n      border: 1.5px solid rgba(255,255,255,0.12);\n      box-shadow: 0 3px 22px rgba(70,120,220,0.13);\n      backdrop-filter: blur(10px) saturate(1.2);\n      border-radius: 24px;\n      margin: 0 16px 18px;\n      overflow: hidden;\n    }\n    .mini-pill-header {\n      padding: 15px 22px;\n      font-size: 1.15rem;\n      font-weight: 800;\n      color: #55afff;\n    }\n    .mini-pill-content {\n      padding: 15px 22px;\n    }\n\n    /* pill actions come Mushroom/SubButton */\n    .pill-group {\n      display: flex; flex-wrap: wrap; gap: 8px; margin-top: 6px;\n    }\n    .pill-button {\n      padding: 6px 10px; border-radius: 999px; border: 1px solid #555;\n      cursor: pointer; background: transparent; font-weight: 600;\n      transition: background .18s, border-color .18s, color .18s;\n    }\n    .pill-button.active { border-color: #55afff; color: #55afff; }\n    .pill-button:hover:not(.active) { background: rgba(85,175,255,0.12); }\n\n    /* RESET — allineato a CameraPanel */\n    .reset-button {\n      border: 3.5px solid #ff4c6a;\n      color: #ff4c6a;\n      border-radius: 24px;\n      padding: 12px 38px;\n      background: transparent;\n      cursor: pointer;\n      display: block;\n      margin: 20px auto;\n      font-size: 1.15rem;\n      font-weight: 700;\n      box-shadow: 0 2px 24px #ff4c6a44;\n    }\n\n    /* Layout chooser */\n    .toggle-group {\n      display: flex;\n      justify-content: center;\n      gap: 24px;\n      margin-top: 4px;\n    }\n    .toggle-btn {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      justify-content: center;\n      width: 64px;\n      padding: 8px;\n      background: rgba(255,255,255,0.12);\n      border: 1px solid rgba(255,255,255,0.24);\n      border-radius: 8px;\n      cursor: pointer;\n      transition: background 0.2s, border-color 0.2s;\n    }\n    .toggle-btn ha-icon {\n      --mdc-icon-size: 28px;\n      color: var(--primary-text-color);\n    }\n    .toggle-btn span {\n      margin-top: 4px;\n      font-size: 0.9rem;\n      color: var(--primary-text-color);\n    }\n    .toggle-btn.active {\n      background: #55afff;\n      border-color: #55afff;\n    }\n    .toggle-btn.active ha-icon,\n    .toggle-btn.active span {\n      color: white;\n    }\n    .toggle-btn:hover { background: rgba(255,255,255,0.18); }\n\n    /* AUTODISCOVER — pill orizzontale identica a CameraPanel */\n    .input-group.autodiscover {\n      margin: 0 16px 13px;\n      padding: 14px 18px 10px;\n      background: rgba(44, 70, 100, 0.23);\n      border: 1.5px solid rgba(255, 255, 255, 0.13);\n      border-radius: 18px;\n      display: flex;\n      align-items: center;\n      gap: 8px;\n    }\n    .input-group.autodiscover label {\n      margin: 0;               /* niente margine bottom, è inline con la checkbox */\n      display: inline-block;   /* stessa resa di CameraPanel */\n      color: #55afff;\n      font-weight: 700;\n      font-size: 1.13rem;\n    }\n  `;\n\n  constructor() {\n    super();\n    this.hass          = {};\n    this.config        = {};\n    this._expanded     = false;\n    this.activeFilters = [];\n    this.layout        = 'wide';\n    this._syncingFromConfig = false;\n  }\n\n  updated(changed) {\n    if (!changed.has('config') && !changed.has('hass')) return;\n  \n    this._syncingFromConfig = true;\n  \n    // 🔁 Applica autodiscovery su cambio area / primo load se area è valorizzata\n    if (this.config?.area || this.config?.area_id) {\n      // 'area' è un trigger \"globale\": l'helper applica AD a tutte le sezioni abilitate\n      maybeAutoDiscover(this.hass, this.config, 'area', false);\n    }\n  \n    // 🔸 Pre‑warm cache icone MDI — idempotente\n    IconCache.warm(this.hass);\n  \n    // 🧩 Sync filtri presenza dall a config (se presenti)\n    if (changed.has('config')) {\n      if (Array.isArray(this.config?.presence_filters)) {\n        this.activeFilters = [...this.config.presence_filters];\n      }\n      const cfgLayout = this.config?.layout;\n      if (cfgLayout && cfgLayout !== this.layout) {\n        this.layout = cfgLayout;\n      }\n    }\n  \n    this._syncingFromConfig = false;\n  \n    // 🎨 Auto‑icona stanza al primo load: se c'è una presence e manca l'icona della stanza\n    const pres = this.config?.entities?.presence?.entity;\n    const roomIcon = this.config?.icon || '';\n    if (pres && !roomIcon) {\n      const st = this.hass?.states?.[pres];\n      const autoIcon = st?.attributes?.icon || resolveEntityIcon(pres, this.hass);\n      if (autoIcon) {\n        // emetti l'aggiornamento dell'icona stanza\n        this._fire('icon', autoIcon);\n      }\n    }\n  }\n  \n\n  _onLayoutClick(mode) {\n    this.layout = mode;\n    this._fire('layout', mode);\n    const grid = mode === 'tall' ? { columns: 6, rows: 4 } : { columns: 12, rows: 4 };\n    this._fire('grid_options', grid);\n  }\n\n  _fire(prop, val) {\n    if (this._syncingFromConfig) return;\n    this.dispatchEvent(new CustomEvent('panel-changed', {\n      detail: { prop, val },\n      bubbles: true,\n      composed: true,\n    }));\n  }\n\n  _onPresenceEntityChange = (ent) => {\n    this._fire('entities.presence.entity', ent);\n    const currentIcon = this.config?.icon || '';\n    if (ent && !currentIcon) {\n      const st = this.hass?.states?.[ent];\n      const autoIcon = st?.attributes?.icon || resolveEntityIcon(ent, this.hass);\n      if (autoIcon) this._fire('icon', autoIcon);\n    }\n  };\n\n  // 🔹 Cambio area con auto-discovery attivo solo alla prima selezione\n  _onAreaChange(v) {\n    const cfg = this.config || {};\n    const ad = { ...(cfg.auto_discovery_sections || {}) };\n    \n    // Attiva auto-discovery solo quando l'area passa da vuota a valorizzata\n    if (v && !cfg.area) {\n      ad.camera = true;\n      ad.climate = true;\n      ad.sensor = true;\n      ad.mushroom = true;\n      ad.subbutton = true;\n      ad.presence = true;\n    }\n    const next = {\n      ...cfg,\n      area: v,\n      area_id: v,\n      auto_discovery_sections: ad\n    };\n\n    if (v) {\n      next.name = v.toUpperCase();\n    }\n\n    this.dispatchEvent(new CustomEvent('config-changed', {\n      detail: { config: next },\n      bubbles: true,\n      composed: true\n    }));\n  }\n  _presenceCandidatesNoArea(hass, filters = [], selected) {\n    if (!hass?.states) return [];\n    const allowed = new Set([\n      'person','device_tracker','binary_sensor','light','switch',\n      'media_player','fan','humidifier','lock','input_boolean','scene'\n    ]);\n    let ids = Object.keys(hass.states).filter((id) => allowed.has(id.split('.')[0]));\n    const wants = new Set(filters || []);\n    if (wants.size) {\n      ids = ids.filter((id) => {\n        const [domain] = id.split('.');\n        if (domain !== 'binary_sensor') return true;\n        const dc = hass.states[id]?.attributes?.device_class || '';\n        return (wants.has('motion') && dc === 'motion') ||\n               (wants.has('occupancy') && dc === 'occupancy') ||\n               (wants.has('presence') && dc === 'presence');\n      });\n    }\n    if (selected && !ids.includes(selected)) ids.unshift(selected);\n    return ids;\n  }\n\n  render() {\n    const cfg      = this.config;\n    const autoDisc = cfg.auto_discovery_sections?.presence ?? false;\n    const area     = cfg.area ?? '';\n    const name     = cfg.name ?? '';\n    const icon     = cfg.icon ?? '';\n    const presEntity = cfg.entities?.presence?.entity ?? '';\n    const presFilters = this.activeFilters.length\n      ? this.activeFilters\n      : (cfg.presence_filters ?? [...PRESENCE_CATS]);\n    const filterOptions = PRESENCE_CATS.map(cat => ({\n      value: cat,\n      label: cat.charAt(0).toUpperCase() + cat.slice(1),\n    }));\n\n    const presCandidates = (autoDisc)\n      ? candidatesFor(this.hass, this.config, 'presence', presFilters)\n      : this._presenceCandidatesNoArea(this.hass, presFilters, presEntity);\n\n\n    const actions = ['toggle','more-info','navigate','call-service','none'];\n    const tapCfg  = this.config?.tap_action  || {};\n    const holdCfg = this.config?.hold_action || {};\n\n    return html`\n      <ha-expansion-panel\n        class=\"glass-panel\"\n        .expanded=${this._expanded}\n        @expanded-changed=${e => this._expanded = e.detail.expanded}\n      >\n        <div slot=\"header\" class=\"glass-header\">🛋️ Room Settings</div>\n      \n        <div class=\"input-group autodiscover\">\n          <input\n            type=\"checkbox\"\n            .checked=${autoDisc}\n            @change=${e => this._fire('auto_discovery_sections.presence', e.target.checked)}\n          />\n          <label>🪄 Auto-discover Presence</label>\n        </div>\n      \n        <div class=\"input-group\">\n          <label>🏷️ Area:</label>\n          <ha-selector\n            .hass=${this.hass}\n            .value=${area}\n            .selector=${{ area: {} }}\n            @value-changed=${e => this._onAreaChange(e.detail.value)}\n          ></ha-selector>\n        </div>\n      \n        <div class=\"input-group\">\n          <label>🏠 Room name:</label>\n          <input\n            type=\"text\"\n            .value=${name}\n            @input=${e => this._fire('name', e.target.value)}\n          />\n        </div>\n      \n        <!-- 🎭 Icon & Presence -->\n        <div class=\"mini-pill\">\n          <div class=\"mini-pill-header\">🎭 Icon & Presence</div>\n          <div class=\"mini-pill-content\">\n            <!-- Room Icon -->\n            <div class=\"input-group\">\n              <label>Icon:</label>\n              <ha-icon-picker\n                .hass=${this.hass}\n                .value=${icon}\n                allow-custom-icon\n                @opened=${() => IconCache.warm(this.hass)}\n                @value-changed=${e => this._fire('icon', e.detail.value)}\n              ></ha-icon-picker>\n            </div>\n      \n            <!-- Filter categories -->\n            <div class=\"input-group\">\n              <label>Filter categories:</label>\n              <ha-selector\n                .hass=${this.hass}\n                .value=${presFilters}\n                .selector=${{ select: { multiple: true, mode: 'box', options: filterOptions } }}\n                @value-changed=${e => this._fire('presence_filters', e.detail.value)}\n              ></ha-selector>\n            </div>\n      \n            <!-- Presence entity -->\n            <div class=\"input-group\">\n              <label>Presence (ID):</label>\n              <ha-selector\n                .hass=${this.hass}\n                .value=${presEntity}\n                .selector=${{ entity: { include_entities: presCandidates, multiple: false } }}\n                allow-custom-entity\n                @value-changed=${e => this._onPresenceEntityChange(e.detail.value)}\n              ></ha-selector>\n            </div>\n      \n            <!-- Actions -->\n            <div class=\"input-group\">\n              <label>Tap Action</label>\n              <div class=\"pill-group\">\n                ${actions.map(a => html`\n                  <button\n                    class=\"pill-button ${tapCfg.action === a ? 'active' : ''}\"\n                    @click=${() => this._fire('tap_action.action', a)}\n                  >${a}</button>\n                `)}\n              </div>\n              ${tapCfg.action === 'navigate' ? html`\n                <input type=\"text\" placeholder=\"Path\"\n                  .value=${tapCfg.navigation_path || ''}\n                  @input=${e => this._fire('tap_action.navigation_path', e.target.value)}\n                />\n              ` : ''}\n              ${tapCfg.action === 'call-service' ? html`\n                <input type=\"text\" placeholder=\"service\"\n                  .value=${tapCfg.service || ''}\n                  @input=${e => this._fire('tap_action.service', e.target.value)}\n                />\n                <input type=\"text\" placeholder='service_data (JSON)'\n                  .value=${tapCfg.service_data ? JSON.stringify(tapCfg.service_data) : ''}\n                  @input=${e => {\n                    let v = e.target.value;\n                    try { v = v ? JSON.parse(v) : undefined; } catch { v = undefined; }\n                    this._fire('tap_action.service_data', v);\n                  }}\n                />\n              ` : ''}\n            </div>\n\n            <div class=\"input-group\">\n              <label>Hold Action</label>\n              <div class=\"pill-group\">\n                ${actions.map(a => html`\n                  <button\n                    class=\"pill-button ${holdCfg.action === a ? 'active' : ''}\"\n                    @click=${() => this._fire('hold_action.action', a)}\n                  >${a}</button>\n                `)}\n              </div>\n              ${holdCfg.action === 'navigate' ? html`\n                <input type=\"text\" placeholder=\"Path\"\n                  .value=${holdCfg.navigation_path || ''}\n                  @input=${e => this._fire('hold_action.navigation_path', e.target.value)}\n                />\n              ` : ''}\n              ${holdCfg.action === 'call-service' ? html`\n                <input type=\"text\" placeholder=\"service (es. light.turn_on)\"\n                  .value=${holdCfg.service || ''}\n                  @input=${e => this._fire('hold_action.service', e.target.value)}\n                />\n                <input type=\"text\" placeholder='service_data (JSON)'\n                  .value=${holdCfg.service_data ? JSON.stringify(holdCfg.service_data) : ''}\n                  @input=${e => {\n                    let v = e.target.value;\n                    try { v = v ? JSON.parse(v) : undefined; } catch { v = undefined; }\n                    this._fire('hold_action.service_data', v);\n                  }}\n                />\n              ` : ''}\n            </div>\n          </div>\n        </div>\n      \n        <!-- 📐 Layout -->\n        <div class=\"input-group\">\n          <label>📐 Layout:</label>\n          <div class=\"toggle-group\">\n\n            <button\n              class=\"toggle-btn ${this.layout === 'tall' ? 'active' : ''}\"\n              @click=${() => this._onLayoutClick('tall')}\n            >\n              <ha-icon icon=\"mdi:cellphone\"></ha-icon>\n              <span>Tall</span>\n            </button>\n            <button\n              class=\"toggle-btn ${this.layout === 'wide' ? 'active' : ''}\"\n              @click=${() => this._onLayoutClick('wide')}\n            >\n              <ha-icon icon=\"mdi:tablet\"></ha-icon> \n              <span>Wide</span> \n            </button>\n          </div>\n        </div>\n      \n        <!-- Reset (identico a CameraPanel) -->\n        <button class=\"reset-button\"\n          @click=${() => this._fire('__panel_cmd__', { cmd: 'reset', section: 'room' })}>\n          🧹 Reset Room\n        </button>\n      </ha-expansion-panel>\n    `;\n  }\n}\n\ncustomElements.define('room-panel', RoomPanel);","// src/helpers/sensor-mapping.js\n\nexport const SENSOR_TYPE_MAP = {\n  // —— ENVIRONMENT / AIR QUALITY ——\n  temperature: { label: 'Temperature', emoji: '🌡️', units: ['°C', '°F'] },\n  apparent_temperature: { label: 'Feels Like', emoji: '🥵', units: ['°C', '°F'] },\n  humidity: { label: 'Humidity', emoji: '💧', units: ['%'] },\n  pressure: { label: 'Pressure', emoji: '🧭', units: ['hPa', 'mbar', 'kPa'] },\n  illuminance: { label: 'Illuminance', emoji: '🔆', units: ['lx'] },\n  sound_pressure: { label: 'Sound Pressure', emoji: '🔊', units: ['dB'] },\n  pm1: { label: 'PM1', emoji: '🌫️', units: ['µg/m³'] },\n  pm2_5: { label: 'PM2.5', emoji: '🌫️', units: ['µg/m³'] },\n  pm10: { label: 'PM10', emoji: '🌫️', units: ['µg/m³'] },\n  co2: { label: 'CO₂', emoji: '🫁', units: ['ppm'] },\n  \n  // —— WEATHER ——\n  uv_index: { label: 'UV Index', emoji: '☀️', units: ['UV index'] },\n  irradiance: { label: 'Irradiance', emoji: '🌞', units: ['W/m²'] },\n  \n  wind_speed: {\n    label: 'Wind Speed',\n    emoji: '🌀',\n    units: ['km/h', 'm/s', 'mph', 'kn'],\n    formatter: (value, unit) => {\n      const v = Number(value);\n      if (isNaN(v)) return { value, unit };\n      if (unit === 'm/s') return { value: (v * 3.6).toFixed(0), unit: 'km/h' };\n      if (unit === 'mph') return { value: (v * 1.60934).toFixed(0), unit: 'km/h' };\n      if (unit === 'kn') return { value: (v * 1.852).toFixed(0), unit: 'km/h' };\n      return { value: v.toFixed(0), unit: unit || 'km/h' };\n    }\n  },\n  speed: { label: 'Speed', emoji: '🌀', units: ['km/h', 'm/s', 'mph', 'kn'] },\n  wind_gust: { label: 'Wind Gust', emoji: '🌬️', units: ['km/h', 'm/s', 'mph', 'kn'] },\n  wind_bearing: { label: 'Wind Direction', emoji: '🧭', units: ['°', 'cardinal'] },\n  \n  precipitation: { label: 'Precipitation', emoji: '🌧️', units: ['mm', 'cm', 'in'] },\n  precipitation_intensity: { label: 'Precipitation Intensity', emoji: '🌦️', units: ['mm/h', 'in/h'] },\n  precipitation_probability: { label: 'Rain Probability', emoji: '☔', units: ['%'] },\n  \n  cloud_coverage: { label: 'Cloud Coverage', emoji: '☁️', units: ['%'] },\n  visibility: { label: 'Visibility', emoji: '👁️', units: ['km', 'm', 'mi'] },\n  dew_point: { label: 'Dew Point', emoji: '💧', units: ['°C', '°F'] },\n  \n  // —— ELECTRICITY ——\n  power: {\n    label: 'Power',\n    emoji: '⚡',\n    units: ['kW', 'W', 'MW'],\n    formatter: (value, unit) => {\n      const v = Number(value);\n      if (isNaN(v)) return { value, unit };\n      if (unit === 'W') return { value: (v / 1000).toFixed(v >= 100 ? 0 : 1), unit: 'kW' };\n      if (unit === 'MW') return { value: (v * 1000).toFixed(0), unit: 'kW' };\n      return { value: v, unit: unit || 'kW' };\n    },\n  },\n  energy: {\n    label: 'Energy',\n    emoji: '🔌',\n    units: ['kWh', 'Wh', 'MWh'],\n    formatter: (value, unit) => {\n      const v = Number(value);\n      if (isNaN(v)) return { value, unit };\n      if (unit === 'Wh') return { value: (v / 1000).toFixed(v >= 1000 ? 0 : 1), unit: 'kWh' };\n      if (unit === 'MWh') return { value: (v * 1000).toFixed(0), unit: 'kWh' };\n      return { value: v, unit: unit || 'kWh' };\n    },\n  },\n  power_factor: { label: 'Power Factor', emoji: '📐', units: ['%', 'ratio'] },\n  voltage: { label: 'Voltage', emoji: '⚙️', units: ['V'] },\n  current: { label: 'Current', emoji: '🧲', units: ['A', 'mA'] },\n  frequency: { label: 'Frequency', emoji: '〰️', units: ['Hz'] },\n  apparent_power: { label: 'Apparent Power', emoji: '🧮', units: ['VA', 'kVA'] },\n  reactive_power: { label: 'Reactive Power', emoji: '🧮', units: ['var', 'kvar'] },\n  \n  // —— COST / UTILITIES ——\n  monetary: { label: 'Cost', emoji: '💶', units: ['€', 'EUR', '$'] },\n  gas: { label: 'Gas', emoji: '🔥', units: ['m³', 'Nm³', 'kWh'] },\n  water: { label: 'Water', emoji: '🚿', units: ['m³', 'L'] },\n  \n  // —— STATUS / OTHER ——\n  battery: { label: 'Battery', emoji: '🔋', units: ['%'] },\n  signal_strength: { label: 'Signal Strength', emoji: '📶', units: ['dBm'] },\n  \n  // Fallback generic\n  _fallback: { label: 'Other', emoji: '❓', units: [''] },\n};\n\n// —— Utility functions mantenute per compat legacy ——\nexport function formatByDeviceClass(deviceClass, value, unit) {\n  const m = SENSOR_TYPE_MAP[deviceClass];\n  if (!m?.formatter) return { value, unit };\n  try { return m.formatter(value, unit); } catch { return { value, unit }; }\n}\n\nexport function defaultEmoji(deviceClass) {\n  return (SENSOR_TYPE_MAP[deviceClass]?.emoji) ?? SENSOR_TYPE_MAP._fallback.emoji;\n}\n\nexport function defaultUnit(deviceClass) {\n  const list = SENSOR_TYPE_MAP[deviceClass]?.units || SENSOR_TYPE_MAP._fallback.units;\n  return list[0] || '';\n}\n","// src/panels/shared-styles.js\nimport { css } from 'lit';\n\nexport const sharedPanelStyles = css`\n  :host { display: block; }\n\n  .glass-panel {\n    margin: 0 !important;\n    width: 100%;\n    box-sizing: border-box;\n    border-radius: 40px;\n    position: relative;\n    background: var(--bubble-glass-bg, var(--glass-bg, rgba(167,255,175,0.22)));\n    box-shadow: var(--bubble-glass-shadow, var(--glass-shadow, 0 2px 24px rgba(167,255,175,0.13)));\n    overflow: hidden;\n  }\n  .glass-panel::after {\n    content: '';\n    position: absolute;\n    inset: 0;\n    border-radius: inherit;\n    background: var(--bubble-glass-sheen,\n      var(--glass-sheen,\n        linear-gradient(120deg, rgba(255,255,255,0.11),\n        rgba(255,255,255,0.07) 70%, transparent 100%)\n      )\n    );\n    pointer-events: none;\n  }\n\n  .glass-header {\n    padding: 22px 0;\n    text-align: center;\n    font-size: 1.12rem;\n    font-weight: 700;\n    color: var(--bubble-header-color, #fff);\n  }\n\n  .input-group.autodiscover {\n    margin: 0 16px 13px;\n    padding: 14px 18px 10px;\n    background: rgba(44,70,100,0.23);\n    border: 1.5px solid rgba(255,255,255,0.13);\n    box-shadow: 0 2px 14px rgba(70,120,220,0.10);\n    border-radius: 18px;\n    display: flex;\n    align-items: center;\n    gap: 8px;\n  }\n  .input-group.autodiscover input {\n    margin-right: 8px;\n  }\n  .input-group.autodiscover label {\n    margin: 0;\n    font-weight: 700;\n    color: var(--bubble-autodiscover-label-color, #fff);\n  }\n\n  .mini-pill {\n    background: rgba(44,70,100,0.23);\n    border: 1.5px solid rgba(255,255,255,0.13);\n    box-shadow: 0 2px 14px rgba(70,120,220,0.10);\n    backdrop-filter: blur(7px) saturate(1.2);\n    border-radius: 24px;\n    margin: 8px 16px;\n    overflow: hidden;\n  }\n  .mini-pill-header {\n    display: flex;\n    align-items: center;\n    padding: 12px 16px;\n    cursor: pointer;\n    user-select: none;\n    font-weight: 700;\n    color: var(--bubble-accent-color, #8cff8a);\n  }\n  .mini-pill-header .chevron {\n    margin-left: auto;\n    transition: transform 0.2s;\n  }\n  .mini-pill.expanded .mini-pill-header .chevron {\n    transform: rotate(90deg);\n  }\n  .mini-pill-content {\n    padding: 12px 16px 16px;\n    animation: pill-expand 0.2s ease-out both;\n  }\n  @keyframes pill-expand {\n    from { opacity: 0; transform: translateY(-8px); }\n    to   { opacity: 1; transform: translateY(0); }\n  }\n\n  .input-group {\n    margin-bottom: 12px;\n  }\n  .input-group label {\n    display: block;\n    font-weight: 600;\n    margin-bottom: 6px;\n    color: var(--bubble-accent-color, #8cff8a);\n  }\n\n  ha-selector,\n  ha-icon-picker {\n    width: 100%;\n    box-sizing: border-box;\n  }\n  ha-selector::part(combobox) {\n    min-height: 40px;\n  }\n\n  .filter-row {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    gap: 8px;\n    margin-bottom: 6px;\n  }\n\n  .clear-chip {\n    border: 2px solid var(--bubble-clear-chip-color, var(--warning-color, #ff8a65));\n    color: var(--bubble-clear-chip-color, var(--warning-color, #ff8a65));\n    background: transparent;\n    border-radius: 999px;\n    padding: 6px 12px;\n    font-size: 0.9rem;\n    font-weight: 800;\n    cursor: pointer;\n    transition: background .15s, color .15s, box-shadow .15s, border-color .15s;\n    box-shadow: 0 1px 10px rgba(255,138,101,0.25);\n  }\n  .clear-chip:hover {\n    background: rgba(255,138,101,0.18);\n    color: #fff;\n    border-color: #ff8a65;\n    box-shadow: 0 3px 16px rgba(255,138,101,0.45);\n  }\n\n  .reset-button {\n    border: 3.5px solid #ff4c6a;\n    color: #ff4c6a;\n    border-radius: 24px;\n    padding: 12px 38px;\n    background: transparent;\n    cursor: pointer;\n    display: block;\n    margin: 20px auto;\n    font-size: 1.15rem;\n    font-weight: 700;\n    box-shadow: 0 2px 24px #ff4c6a44;\n    transition: background 0.18s, color 0.18s, box-shadow 0.18s;\n  }\n  .reset-button:hover {\n    background: rgba(255,76,106,0.18);\n    color: #fff;\n    box-shadow: 0 6px 32px #ff4c6abf;\n  }\n`;\n","// src/panels/SensorPanel.js\nimport { LitElement, html, css } from 'lit';\nimport { maybeAutoDiscover } from '../helpers/auto-discovery.js';\nimport { candidatesFor }     from '../helpers/entity-filters.js';\nimport { SENSOR_TYPE_MAP }   from '../helpers/sensor-mapping.js';\nimport { sharedPanelStyles } from './shared-styles.js';\n\nexport class SensorPanel extends LitElement {\n  static properties = {\n    hass:       { type: Object },\n    config:     { type: Object },\n    expanded:   { type: Boolean },\n    _expanded:  { type: Array, state: true },\n    _filters:   { type: Array, state: true },\n    _entities:  { type: Array, state: true },\n  };\n\n  constructor() {\n    super();\n    this.hass      = {};\n    this.config    = {};\n    this.expanded  = false;\n    this._expanded = Array(5).fill(false);\n\n    const allTypes = Object.keys(SENSOR_TYPE_MAP);\n    // Stato locale dei filtri: default = TUTTI i tipi (non scritto nel YAML)\n    this._filters  = Array(5).fill().map(() => [...allTypes]);\n    this._entities = Array(5).fill('');\n\n    // Flag per distinguere i change generati dal tasto Clear\n    this._ignoreNextFilterChange = new Set(); // indici -> ignora il prossimo value-changed\n  }\n\n  updated(changed) {\n    if (changed.has('config') || changed.has('hass')) {\n      // Auto-discover: usa il valore di ritorno e propaga la nuova config (se serve)\n      const next = maybeAutoDiscover(this.hass, this.config, 'auto_discovery_sections.sensor');\n      if (next && next !== this.config) {\n        this.dispatchEvent(new CustomEvent('config-changed', {\n          detail: { config: next }, bubbles: true, composed: true\n        }));\n      }\n\n      // Se esiste in config, carica ma NON riscrivere mai sensor_filters nel YAML\n      for (let i = 0; i < 5; i++) {\n        const key = `sensor${i + 1}`;\n        const cfgFilter = this.config?.sensor_filters?.[i];\n        const cfgEnt    = this.config?.entities?.[key]?.entity;\n        if (Array.isArray(cfgFilter)) this._filters[i] = [...cfgFilter];\n        if (cfgEnt)                   this._entities[i] = cfgEnt;\n      }\n    }\n  }\n\n  static styles = [\n    sharedPanelStyles,\n    css`\n      :host {\n        --bubble-glass-bg: var(--glass-bg, rgba(167,255,175,0.22));\n        --bubble-glass-shadow: var(--glass-shadow, 0 2px 24px rgba(167,255,175,0.13));\n        --bubble-glass-sheen: var(--glass-sheen,\n          linear-gradient(120deg, rgba(255,255,255,0.11),\n          rgba(255,255,255,0.07) 70%, transparent 100%));\n        --bubble-accent-color: #8cff8a;\n      }\n\n      .preview {\n        display: flex;\n        align-items: center;\n        gap: 12px;\n        padding: 0 16px 16px;\n      }\n      .preview .emoji {\n        font-size: 1.8rem;\n        line-height: 1;\n      }\n      .preview .state {\n        font-size: 1.2rem;\n        color: #fff;\n      }\n    `,\n  ];\n\n  render() {\n    const autoDisc = this.config?.auto_discovery_sections?.sensor ?? false;\n\n    const options = Object.entries(SENSOR_TYPE_MAP)\n      .filter(([type]) => type !== '_fallback')\n      .map(([type, info]) => {\n        const niceLabel = info.label ||\n          type.replace(/_/g, ' ').replace(/\\b\\w/g, c => c.toUpperCase());\n        return { value: type, label: `${info.emoji || ''} ${niceLabel}`.trim() };\n      });\n\n    return html`\n      <ha-expansion-panel\n        class=\"glass-panel\"\n        .expanded=${this.expanded}\n        @expanded-changed=${e => {\n          this.expanded = e.detail.expanded;\n          if (this.expanded) this._expanded = Array(5).fill(false);\n        }}\n      >\n        <div slot=\"header\" class=\"glass-header\">🧭 Sensors</div>\n\n        <div class=\"input-group autodiscover\">\n          <input\n            type=\"checkbox\"\n            .checked=${autoDisc}\n            @change=${e => this._toggleAuto(e.target.checked)}\n          />\n          <label>🪄 Auto-discover Sensors</label>\n        </div>\n\n        ${this._expanded.map((open, i) => this._renderSensor(i, open, options))}\n\n        <button class=\"reset-button\" @click=${() => this._reset()}>\n          🧹 Reset Sensors\n        </button>\n      </ha-expansion-panel>\n    `;\n  }\n\n  _renderSensor(i, open, options) {\n    const types = this._filters[i];\n    const ent   = this._entities[i];\n\n    // AD ON ⇒ filtrato per area; AD OFF ⇒ nessun filtro area (per device_class)\n    const adOn = this.config?.auto_discovery_sections?.sensor ?? false;\n    let cands;\n    if (adOn) {\n      cands = candidatesFor(this.hass, this.config, 'sensor', types) || [];\n    } else {\n      // bypass area: prendi tutti i sensor/binary_sensor e, se presenti \"types\",\n      // filtra per device_class (non per dominio!)\n      const states = this.hass?.states || {};\n      const allIds = Object.keys(states);\n      const hasTypes = Array.isArray(types) && types.length > 0;\n      const typeSet  = hasTypes ? new Set(types) : null;\n      cands = allIds.filter((id) => {\n        const domain = id.split('.')[0];\n        if (domain !== 'sensor' && domain !== 'binary_sensor') return false;\n        if (!hasTypes) return true;\n        const dc = states[id]?.attributes?.device_class;\n        return dc ? typeSet.has(dc) : false;\n      });\n    }\n\n    if (ent && !cands.includes(ent)) cands = [ent, ...cands];\n\n    return html`\n      <div class=\"mini-pill ${open ? 'expanded' : ''}\">\n        <div class=\"mini-pill-header\" @click=${() => this._togglePill(i)}>\n          Sensor ${i+1}\n          <span class=\"chevron\">${open ? '▼' : '▶'}</span>\n        </div>\n        ${open ? html`\n          <div class=\"mini-pill-content\">\n            <div class=\"input-group\">\n              <div class=\"filter-row\">\n                <label for=\"filter-${i}\">Filter category:</label>\n                <button\n                  class=\"clear-chip\"\n                  type=\"button\"\n                  @click=${() => this._clearFilter(i)}\n                  title=\"Clear filter category\">\n                  Clear\n                </button>\n              </div>\n              <ha-selector\n                id=\"filter-${i}\"\n                .hass=${this.hass}\n                .value=${types}\n                .selector=${{ select: { multiple: true, mode: 'box', options } }}\n                @value-changed=${e => this._onFilter(i, e.detail.value)}\n              ></ha-selector>\n            </div>\n\n            <div class=\"input-group\">\n              <label>Entity:</label>\n              <ha-selector\n                .hass=${this.hass}\n                .value=${ent}\n                .selector=${{ entity: { include_entities: cands, multiple: false } }}\n                allow-custom-entity\n                @value-changed=${e => this._onEntity(i, e.detail.value)}\n              ></ha-selector>\n            </div>\n\n            ${ent ? (() => {\n              const stateObj = this.hass.states[ent];\n              const dc       = stateObj?.attributes?.device_class;\n              const info     = SENSOR_TYPE_MAP[dc] || {};\n              const emoji    = info.emoji || '❓';\n              const unit     = stateObj?.attributes?.unit_of_measurement\n                               || (info.units?.[0] ?? '');\n              const val      = stateObj?.state ?? '-';\n              return html`\n                <div class=\"preview\">\n                  <span class=\"emoji\">${emoji}</span>\n                  <div class=\"state\">${val} ${unit}</div>\n                </div>\n              `;\n            })() : ''}\n          </div>\n        ` : ''}\n      </div>\n    `;\n  }\n\n  _toggleAuto(on) {\n    this.dispatchEvent(new CustomEvent('panel-changed', {\n      detail: { prop: 'auto_discovery_sections.sensor', val: on },\n      bubbles: true, composed: true,\n    }));\n  }\n\n  _togglePill(i) {\n    this._expanded = this._expanded.map((v, idx) => idx === i ? !v : false);\n    this.requestUpdate();\n  }\n\n  // Se rimuovi manualmente tutti i chip => ricrea la lista completa.\n  // Se arriva da \"Clear\" (flag attivo) => resta vuoto.\n  _onFilter(i, values) {\n    const all = Object.keys(SENSOR_TYPE_MAP);\n\n    if (this._ignoreNextFilterChange.has(i)) {\n      // Cambio generato dal bottone Clear: mantieni vuoto e consuma il flag\n      this._ignoreNextFilterChange.delete(i);\n      this._filters[i] = [];\n    } else {\n      // Cambio manuale: se l'array è vuoto/undefined => ripristina tutti\n      const arr = Array.isArray(values) && values.length ? values.filter(Boolean) : all;\n      this._filters[i] = [...arr];\n    }\n\n    this.requestUpdate('_filters');\n\n    // Sincronizza visivamente il selector\n    const sel = this.renderRoot?.querySelector(`#filter-${i}`);\n    if (sel) sel.value = [...this._filters[i]];\n  }\n\n  // Clear: svuota davvero l'elenco e informa _onFilter di NON ricrearlo\n  _clearFilter(i) {\n    this._filters[i] = [];\n    this.requestUpdate('_filters');\n\n    const sel = this.renderRoot?.querySelector(`#filter-${i}`);\n    if (sel) {\n      // Attiva il flag: il prossimo value-changed ([]) non verrà \"riempito\"\n      this._ignoreNextFilterChange.add(i);\n      sel.value = [];\n      sel.dispatchEvent(new CustomEvent('value-changed', {\n        detail: { value: [] }, bubbles: true, composed: true\n      }));\n    }\n  }\n\n  _onEntity(i, ent) {\n    this._entities[i] = ent;\n    this.dispatchEvent(new CustomEvent('panel-changed', {\n      detail: { prop: `entities.sensor${i+1}.entity`, val: ent },\n      bubbles: true, composed: true,\n    }));\n  }\n\n  _reset() {\n    this._expanded = Array(5).fill(false);\n    const allTypes = Object.keys(SENSOR_TYPE_MAP);\n    this._filters  = Array(5).fill().map(() => [...allTypes]);\n    this._entities = Array(5).fill('');\n\n    // Reset solo delle entità nel YAML; i filtri restano locali\n    for (let i = 1; i <= 5; i++) {\n      this.dispatchEvent(new CustomEvent('panel-changed', {\n        detail: { prop: `entities.sensor${i}.entity`, val: '' },\n        bubbles: true, composed: true,\n      }));\n    }\n  }\n}\n\ncustomElements.define('sensor-panel', SensorPanel);","// src/panels/MushroomPanel.js\nimport { LitElement, html, css } from 'lit';\nimport { maybeAutoDiscover } from '../helpers/auto-discovery.js';\nimport {\n  candidatesFor,\n  COMMON_CATS,\n  FILTER_LABELS,\n  BINARY_SENSOR_CATS, // ← aggiunto: includiamo anche le device_class dei binary_sensor\n} from '../helpers/entity-filters.js';\nimport { resolveEntityIcon } from '../helpers/icon-mapping.js';\nimport { sharedPanelStyles } from './shared-styles.js';\n\nexport class MushroomPanel extends LitElement {\n  static properties = {\n    hass:      { type: Object },\n    config:    { type: Object },\n    expanded:  { type: Boolean },\n\n    _expanded: { type: Array,  state: true }, // quale “pill” è aperta\n    _filters:  { type: Array,  state: true }, // 5 array di categorie\n    _entities: { type: Array,  state: true }, // 5 entity_id\n    _icons:    { type: Array,  state: true }, // 5 icone (mdi:...)\n  };\n\n  constructor() {\n    super();\n    this.hass      = {};\n    this.config    = {};\n    this.expanded  = false;\n\n    // Tutte le categorie disponibili: domini comuni + device_class dei binary_sensor\n    this._ALL_CATS = Array.from(new Set([...COMMON_CATS, ...BINARY_SENSOR_CATS]));\n\n    this._expanded = Array(5).fill(false);\n    // Default: tutte le categorie disponibili (non solo COMMON_CATS)\n    this._filters  = Array(5).fill().map(() => [...this._ALL_CATS]);\n    this._entities = Array(5).fill('');\n    this._icons    = Array(5).fill('');\n\n    this._syncingFromConfig = false;        // evita side effects durante la sync\n    this._ignoreNextFilterChange = new Set(); // per “Clear” intenzionale\n  }\n\n  updated(changed) {\n    if (!changed.has('config') && !changed.has('hass')) return;\n\n    this._syncingFromConfig = true;\n\n    // 1) Autodiscovery area-based (applica il valore di ritorno)\n    if (this.config?.area || this.config?.area_id) {\n      const next = maybeAutoDiscover(this.hass, this.config, 'area', false);\n      if (next && next !== this.config) {\n        this.dispatchEvent(new CustomEvent('config-changed', {\n          detail: { config: next }, bubbles: true, composed: true\n        }));\n      }\n    }\n\n    // 2) sincronizza filtri da config (se presenti)\n    const cfgFilters = this.config?.mushroom_filters;\n    if (Array.isArray(cfgFilters) && cfgFilters.length === 5) {\n      this._filters = cfgFilters.map(f => Array.isArray(f) ? [...f] : [...this._ALL_CATS]);\n    } else {\n      // se non c’è nulla in config, assicurati di avere il default completo\n      this._filters = Array(5).fill().map(() => [...this._ALL_CATS]);\n    }\n\n    // 3) sincronizza entity + icon da config.entities\n    const ents = this.config?.entities || {};\n    for (let i = 0; i < 5; i++) {\n      const key = `mushroom${i+1}`;\n      const rec = ents[key] || {};\n      if (rec.entity) this._entities[i] = rec.entity;\n      if (typeof rec.icon === 'string') this._icons[i] = rec.icon;\n    }\n\n    this._syncingFromConfig = false;\n\n    // 4) Auto-icona al primo load (non sovrascrive scelta utente)\n    const pending = [];\n    for (let i = 0; i < 5; i++) {\n      const key = `mushroom${i+1}`;\n      const ent = this._entities[i];\n      const cfgIcon = this.config?.entities?.[key]?.icon;\n      if (ent && !cfgIcon) {\n        const st = this.hass?.states?.[ent];\n        const iconFromState = st?.attributes?.icon;\n        const autoIco = iconFromState || resolveEntityIcon(ent, this.hass);\n        if (autoIco) pending.push({ i, key, icon: autoIco });\n      }\n    }\n    if (pending.length) {\n      for (const { i, key, icon } of pending) {\n        this._icons[i] = icon;\n        this.dispatchEvent(new CustomEvent('panel-changed', {\n          detail: { prop: `entities.${key}.icon`, val: icon },\n          bubbles: true, composed: true,\n        }));\n      }\n    }\n  }\n\n  static styles = [\n    sharedPanelStyles,\n    css`\n      :host {\n        --bubble-glass-bg: var(--glass-bg, rgba(80,235,175,0.28));\n        --bubble-glass-shadow: var(--glass-shadow, 0 2px 24px rgba(40,220,145,0.18));\n        --bubble-glass-sheen: var(--glass-sheen,\n          linear-gradient(120deg, rgba(255,255,255,0.18),\n          rgba(255,255,255,0.10) 70%, transparent 100%));\n        --bubble-accent-color: #36e6a0;\n      }\n\n      .pill-group {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n        margin-top: 6px;\n      }\n      .pill-button {\n        padding: 6px 10px;\n        border-radius: 999px;\n        border: 1px solid #555;\n        cursor: pointer;\n        background: transparent;\n        font-weight: 600;\n        transition: background 0.18s, border-color 0.18s, color 0.18s;\n      }\n      .pill-button.active {\n        border-color: #36e6a0;\n        color: #36e6a0;\n      }\n      .pill-button:hover:not(.active) {\n        background: rgba(54,230,160,0.1);\n      }\n    `,\n  ];\n\n  render() {\n    const autoDisc = this.config?.auto_discovery_sections?.mushroom ?? false;\n\n    // Opzioni: tutte le categorie (domini + device_class)\n    const options = this._ALL_CATS.map(cat => ({\n      value: cat,\n      label: FILTER_LABELS[cat] || (cat.charAt(0).toUpperCase() + cat.slice(1)),\n    }));\n\n    return html`\n      <ha-expansion-panel\n        class=\"glass-panel\"\n        .expanded=${this.expanded}\n        @expanded-changed=${e => {\n          this.expanded = e.detail.expanded;\n          if (this.expanded) this._expanded = Array(5).fill(false);\n        }}\n      >\n        <div slot=\"header\" class=\"glass-header\">🍄 Mushroom Entities</div>\n\n        <div class=\"input-group autodiscover\">\n          <input\n            type=\"checkbox\"\n            .checked=${autoDisc}\n            @change=${e => this._toggleAuto(e.target.checked)}\n          />\n          <label>🪄 Auto-discover Mushroom</label>\n        </div>\n\n        ${this._expanded.map((open, i) => this._renderMushroom(i, open, options))}\n\n        <button class=\"reset-button\" @click=${() => this._reset()}>\n          🧹 Reset Mushrooms\n        </button>\n      </ha-expansion-panel>\n    `;\n  }\n\n  _renderMushroom(i, open, options) {\n    const key   = `mushroom${i+1}`;\n    const types = this._filters[i];\n    const ent   = this._entities[i];\n    const icon  = this._icons[i];\n    const cfg   = (this.config.entities && this.config.entities[key]) ? this.config.entities[key] : {};\n\n    // Candidati:\n    // - AD ON  ⇒ pipeline standard (filtrata per area) via candidatesFor\n    // - AD OFF ⇒ stessa pipeline ma senza area (così funzionano anche le device_class)\n    const autoDisc = this.config?.auto_discovery_sections?.mushroom ?? false;\n    let cands;\n    if (autoDisc) {\n      cands = candidatesFor(this.hass, this.config, 'mushroom', types) || [];\n    } else {\n      const cfgNoArea = { ...this.config, area: undefined, area_id: undefined };\n      cands = candidatesFor(this.hass, cfgNoArea, 'mushroom', types) || [];\n    }\n    // preserva l’entità selezionata in cima se non già inclusa\n    if (ent && !cands.includes(ent)) cands = [ent, ...cands];\n    const actions = ['toggle', 'more-info', 'navigate', 'call-service', 'none'];\n\n    return html`\n      <div class=\"mini-pill ${open ? 'expanded' : ''}\">\n        <div class=\"mini-pill-header\" @click=${() => this._togglePill(i)}>\n          Mushroom ${i+1}\n          <span class=\"chevron\">${open ? '▼' : '▶'}</span>\n        </div>\n\n        ${open ? html`\n          <div class=\"mini-pill-content\">\n            <!-- Filter categories (layout/UX identici a SensorPanel) -->\n            <div class=\"input-group\">\n              <div class=\"filter-row\">\n                <label for=\"filter-${i}\">Filter category:</label>\n                <button\n                  class=\"clear-chip\"\n                  type=\"button\"\n                  @click=${() => this._clearFilter(i)}\n                  title=\"Clear filter category\">\n                  Clear\n                </button>\n              </div>\n              <ha-selector\n                id=\"filter-${i}\"\n                .hass=${this.hass}\n                .value=${types}\n                .selector=${{ select: { multiple: true, mode: 'box', options } }}\n                @value-changed=${e => this._onFilter(i, e.detail.value)}\n              ></ha-selector>\n            </div>\n\n            <!-- Entity -->\n            <div class=\"input-group\">\n              <label>Entity:</label>\n              <ha-selector\n                .hass=${this.hass}\n                .value=${ent}\n                .selector=${{ entity: { include_entities: cands, multiple: false } }}\n                allow-custom-entity\n                @value-changed=${e => this._onEntity(i, e.detail.value)}\n              ></ha-selector>\n            </div>\n\n            <!-- Icon -->\n            <div class=\"input-group\">\n              <label>Icon:</label>\n              <ha-icon-picker\n                .hass=${this.hass}\n                .value=${icon}\n                allow-custom-icon\n                @value-changed=${e => this._onIcon(i, e.detail.value)}\n              ></ha-icon-picker>\n            </div>\n\n            <!-- Tap Action -->\n            <div class=\"input-group\">\n              <label>Tap Action:</label>\n              <div class=\"pill-group\">\n                ${actions.map(a => html`\n                  <button\n                    class=\"pill-button ${cfg.tap_action?.action === a ? 'active' : ''}\"\n                    @click=${() => this._onAction(i, 'tap', 'action', a)}\n                  >${a}</button>\n                `)}\n              </div>\n              ${this._extraFields(i, 'tap', cfg)}\n            </div>\n\n            <!-- Hold Action -->\n            <div class=\"input-group\">\n              <label>Hold Action:</label>\n              <div class=\"pill-group\">\n                ${actions.map(a => html`\n                  <button\n                    class=\"pill-button ${cfg.hold_action?.action === a ? 'active' : ''}\"\n                    @click=${() => this._onAction(i, 'hold', 'action', a)}\n                  >${a}</button>\n                `)}\n              </div>\n              ${this._extraFields(i, 'hold', cfg)}\n            </div>\n          </div>\n        ` : ''}\n      </div>\n    `;\n  }\n\n  _extraFields(i, type, cfg) {\n    const act = cfg?.[`${type}_action`]?.action;\n    if (act === 'navigate') {\n      return html`\n        <input type=\"text\" placeholder=\"Path\"\n          .value=${cfg[`${type}_action`]?.navigation_path || ''}\n          @input=${e => this._onAction(i, type, 'navigation_path', e.target.value)}\n        />\n      `;\n    }\n    if (act === 'call-service') {\n      return html`\n        <input type=\"text\" placeholder=\"Service (es. light.turn_on)\"\n          .value=${cfg[`${type}_action`]?.service || ''}\n          @input=${e => this._onAction(i, type, 'service', e.target.value)}\n        />\n        <input type=\"text\" placeholder='Service Data (JSON)'\n          .value=${cfg[`${type}_action`]?.service_data ? JSON.stringify(cfg[`${type}_action`].service_data) : ''}\n          @input=${e => this._onAction(i, type, 'service_data', this._safeJson(e.target.value))}\n        />\n      `;\n    }\n    return '';\n  }\n\n  _safeJson(txt) { try { return JSON.parse(txt); } catch { return {}; } }\n\n  /* --------------------------- HANDLERS ------------------------------ */\n  _toggleAuto(on) {\n    if (this._syncingFromConfig) return;\n    this.dispatchEvent(new CustomEvent('panel-changed', {\n      detail: { prop: 'auto_discovery_sections.mushroom', val: on },\n      bubbles: true, composed: true,\n    }));\n  }\n\n  _togglePill(i) {\n    this._expanded = this._expanded.map((v, idx) => (idx === i ? !v : false));\n    this.requestUpdate();\n  }\n\n  _onFilter(i, values) {\n    // stessa logica di SensorPanel ma con default = _ALL_CATS\n    if (this._ignoreNextFilterChange.has(i)) {\n      this._ignoreNextFilterChange.delete(i);\n      this._filters[i] = [];\n    } else {\n      const arr = Array.isArray(values) && values.length\n        ? values.filter(Boolean)\n        : [...this._ALL_CATS];\n      this._filters[i] = [...arr];\n    }\n    this.requestUpdate('_filters');\n\n    if (!this._syncingFromConfig) {\n      const nextFilters = this._filters.map(list => [...list]);\n      this.dispatchEvent(new CustomEvent('panel-changed', {\n        detail: { prop: 'mushroom_filters', val: nextFilters },\n        bubbles: true, composed: true,\n      }));\n    }\n\n    // Sync visuale del selector\n    const sel = this.renderRoot?.querySelector(`#filter-${i}`);\n    if (sel) sel.value = [...this._filters[i]];\n  }\n\n  // Clear identico a SensorPanel: svuota, setta il flag, dispatch value-changed([])\n  _clearFilter(i) {\n    this._filters[i] = [];\n    this.requestUpdate('_filters');\n    const sel = this.renderRoot?.querySelector(`#filter-${i}`);\n    if (sel) {\n      this._ignoreNextFilterChange.add(i);\n      sel.value = [];\n      sel.dispatchEvent(new CustomEvent('value-changed', {\n        detail: { value: [] }, bubbles: true, composed: true\n      }));\n    }\n  }\n\n  _onEntity(i, ent) {\n    this._entities[i] = ent;\n\n    if (!this._syncingFromConfig) {\n      // salva l’entità\n      this.dispatchEvent(new CustomEvent('panel-changed', {\n        detail: { prop: `entities.mushroom${i+1}.entity`, val: ent },\n        bubbles: true, composed: true,\n      }));\n\n      // se l’icona è vuota → imposta subito auto-icona (stato → fallback)\n      const currentIcon = this.config?.entities?.[`mushroom${i+1}`]?.icon || '';\n      if (!currentIcon) {\n        const st = this.hass?.states?.[ent];\n        const iconFromState = st?.attributes?.icon;\n        const autoIco = iconFromState || resolveEntityIcon(ent, this.hass);\n        if (autoIco) {\n          this._icons[i] = autoIco;\n          this.dispatchEvent(new CustomEvent('panel-changed', {\n            detail: { prop: `entities.mushroom${i+1}.icon`, val: autoIco },\n            bubbles: true, composed: true,\n          }));\n        }\n      }\n    }\n  }\n\n  _onIcon(i, icon) {\n    this._icons[i] = icon || '';\n    if (this._syncingFromConfig) return;\n    this.dispatchEvent(new CustomEvent('panel-changed', {\n      detail: { prop: `entities.mushroom${i+1}.icon`, val: this._icons[i] },\n      bubbles: true, composed: true,\n    }));\n  }\n\n  _onAction(i, type, field, val) {\n    if (this._syncingFromConfig) return;\n    const key = `mushroom${i+1}`;\n    const prev = this.config?.entities?.[key]?.[`${type}_action`] || {};\n    const next = { ...prev, [field]: val };\n    this.dispatchEvent(new CustomEvent('panel-changed', {\n      detail: { prop: `entities.${key}.${type}_action`, val: next },\n      bubbles: true, composed: true,\n    }));\n  }\n\n  _reset() {\n    this._expanded = Array(5).fill(false);\n    this._filters  = Array(5).fill().map(() => [...this._ALL_CATS]);\n    this._entities = Array(5).fill('');\n    this._icons    = Array(5).fill('');\n\n    this.dispatchEvent(new CustomEvent('panel-changed', {\n      detail: { prop: 'mushroom_filters', val: this._filters },\n      bubbles: true, composed: true,\n    }));\n\n    for (let i = 1; i <= 5; i++) {\n      this.dispatchEvent(new CustomEvent('panel-changed', {\n        detail: { prop: `entities.mushroom${i}.entity`, val: '' },\n        bubbles: true, composed: true,\n      }));\n      this.dispatchEvent(new CustomEvent('panel-changed', {\n        detail: { prop: `entities.mushroom${i}.icon`, val: '' },\n        bubbles: true, composed: true,\n      }));\n      // reset anche azioni\n      this.dispatchEvent(new CustomEvent('panel-changed', {\n        detail: { prop: `entities.mushroom${i}.tap_action`, val: { action: 'none' } },\n        bubbles: true, composed: true,\n      }));\n      this.dispatchEvent(new CustomEvent('panel-changed', {\n        detail: { prop: `entities.mushroom${i}.hold_action`, val: { action: 'none' } },\n        bubbles: true, composed: true,\n      }));\n    }\n  }\n\n  /* --------------------------- UTILS -------------------------------- */\n  _autoIconFor(entityId) {\n    if (!entityId) return '';\n    const st = this.hass?.states?.[entityId];\n    return st?.attributes?.icon || resolveEntityIcon(entityId, this.hass);\n  }\n}\n\ncustomElements.define('mushroom-panel', MushroomPanel);","// src/panels/SubButtonPanel.js\nimport { LitElement, html, css } from 'lit';\nimport { maybeAutoDiscover } from '../helpers/auto-discovery.js';\nimport {\n  candidatesFor,\n  COMMON_CATS,\n  FILTER_LABELS,\n} from '../helpers/entity-filters.js';\nimport { resolveEntityIcon } from '../helpers/icon-mapping.js';\nimport { sharedPanelStyles } from './shared-styles.js';\n\nexport class SubButtonPanel extends LitElement {\n  static properties = {\n    hass: { type: Object },\n    config: { type: Object },\n    expanded: { type: Boolean },\n    _expanded: { type: Array, state: true },\n    _filters: { type: Array, state: true },\n    _entities: { type: Array, state: true },\n  };\n\n  constructor() {\n    super();\n    this.hass = {};\n    this.config = {};\n    this.expanded = false;\n\n    this._expanded = Array(4).fill(false);\n    this._filters  = Array(4).fill().map(() => [...COMMON_CATS]);\n    this._entities = Array(4).fill('');\n\n    this._ignoreNextFilterChange = new Set(); // one-shot per Clear\n    this._filtersHydrated = false;\n    this._syncingFromConfig = false;          // evita side-effects\n  }\n\n  updated(changed) {\n    if (!changed.has('config') && !changed.has('hass')) return;\n\n    this._syncingFromConfig = true;\n\n    // Autodiscovery area-aware (non muta la config localmente)\n    if (this.config?.area || this.config?.area_id) {\n      const next = maybeAutoDiscover(this.hass, this.config, 'area', false);\n      if (next && next !== this.config) {\n        this.dispatchEvent(new CustomEvent('config-changed', {\n          detail: { config: next }, bubbles: true, composed: true,\n        }));\n      }\n    }\n\n    // Non mutare mai this.config qui. Assicura però la struttura letta.\n    const list = Array.isArray(this.config?.subbuttons) ? this.config.subbuttons : [];\n    if (list.length) {\n      for (let i = 0; i < Math.min(4, list.length); i++) {\n        const ent = list[i]?.entity_id || '';\n        this._entities[i] = ent;\n        // auto-icona (solo dispatch, non scrivere this.config)\n        if (ent) {\n          const existing = list[i]?.icon;\n          if (!existing) {\n            const st = this.hass?.states?.[ent];\n            const iconFromState = st?.attributes?.icon;\n            const autoIcon = iconFromState || resolveEntityIcon(ent, this.hass);\n            if (autoIcon) {\n              this.dispatchEvent(new CustomEvent('panel-changed', {\n                detail: { prop: `subbuttons.${i}.icon`, val: autoIcon },\n                bubbles: true, composed: true,\n              }));\n            }\n          }\n        }\n      }\n    }\n\n    // idrata filtri da YAML SOLO la prima volta\n    if (!this._filtersHydrated) {\n      const cfgFilters = this.config?.subbutton_filters;\n      if (Array.isArray(cfgFilters) && cfgFilters.length === 4) {\n        this._filters = cfgFilters.map(f => Array.isArray(f) ? [...f] : [...COMMON_CATS]);\n      }\n      this._filtersHydrated = true;\n    }\n\n    this._syncingFromConfig = false;\n  }\n\n  static styles = [\n    sharedPanelStyles,\n    css`\n      :host {\n        --bubble-glass-bg: var(--glass-bg, rgba(180,120,255,0.34));\n        --bubble-glass-shadow: var(--glass-shadow, 0 2px 24px rgba(160,100,255,0.19));\n        --bubble-glass-sheen: var(--glass-sheen,\n          linear-gradient(120deg, rgba(255,255,255,0.22),\n          rgba(255,255,255,0.10) 70%, transparent 100%));\n        --bubble-accent-color: #b28fff;\n      }\n\n      .pill-group {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n        margin-top: 6px;\n      }\n      .pill-button {\n        padding: 6px 10px;\n        border-radius: 999px;\n        border: 1px solid #555;\n        cursor: pointer;\n        background: transparent;\n        font-weight: 600;\n        transition: background 0.18s, border-color 0.18s, color 0.18s;\n      }\n      .pill-button.active {\n        border-color: #b28fff;\n        color: #b28fff;\n      }\n      .pill-button:hover:not(.active) {\n        background: rgba(178,143,255,0.1);\n      }\n    `,\n  ];\n\n  render() {\n    const autoDisc = this.config?.auto_discovery_sections?.subbutton ?? false;\n    const options = COMMON_CATS.map(cat => ({\n      value: cat,\n      label: FILTER_LABELS[cat] || cat.charAt(0).toUpperCase() + cat.slice(1),\n    }));\n\n    return html`\n      <ha-expansion-panel\n        class=\"glass-panel\"\n        .expanded=${this.expanded}\n        @expanded-changed=${e => (this.expanded = e.detail.expanded)}\n      >\n        <div slot=\"header\" class=\"glass-header\">🎛️ Sub-buttons</div>\n\n        <div class=\"input-group autodiscover\">\n          <input type=\"checkbox\" .checked=${autoDisc}\n                 @change=${e => this._toggleAuto(e.target.checked)} />\n          <label>🪄 Auto-discover Subbuttons</label>\n        </div>\n\n        ${this._expanded.map((open, i) => this._renderSubButton(i, open, options))}\n\n        <button class=\"reset-button\" @click=${() => this._reset()}>🧹 Reset Sub-buttons</button>\n      </ha-expansion-panel>\n    `;\n  }\n\n  _renderSubButton(i, open, options) {\n    const types = this._filters[i];\n    const ent = this._entities[i];\n    const adOn = this.config?.auto_discovery_sections?.subbutton ?? false;\n\n    let cands;\n    if (adOn) {\n      cands = candidatesFor(this.hass, this.config, 'subbutton', types) || [];\n    } else {\n      const cfgNoArea = { ...this.config, area: undefined, area_id: undefined };\n      cands = candidatesFor(this.hass, cfgNoArea, 'subbutton', types) || [];\n    }\n    if (ent && !cands.includes(ent)) cands = [ent, ...cands];\n\n    const cfg = Array.isArray(this.config?.subbuttons) ? (this.config.subbuttons[i] || {}) : {};\n    const actions = ['toggle', 'more-info', 'navigate', 'call-service', 'none'];\n\n    return html`\n      <div class=\"mini-pill ${open ? 'expanded' : ''}\">\n        <div class=\"mini-pill-header\" @click=${() => this._togglePill(i)}>\n          Sub-button ${i + 1}  <span class=\"chevron\">${open ? '▼' : '▶'}</span>\n        </div>\n        ${open ? html`\n          <div class=\"mini-pill-content\">\n            <div class=\"input-group\">\n              <div class=\"filter-row\">\n                <label for=\"filter-${i}\">Filter category:</label>\n                <button class=\"clear-chip\" type=\"button\"\n                        @click=${() => this._clearFilter(i)}\n                        title=\"Clear filter category\">Clear</button>\n              </div>\n              <ha-selector\n                id=\"filter-${i}\"\n                .hass=${this.hass}\n                .value=${types}\n                .selector=${{ select: { multiple: true, mode: 'box', options } }}\n                @value-changed=${e => this._onFilter(i, e.detail.value)}\n              ></ha-selector>\n            </div>\n\n            <div class=\"input-group\">\n              <label>Entity:</label>\n              <ha-selector\n                .hass=${this.hass}\n                .value=${ent}\n                .selector=${{ entity: { include_entities: cands, multiple: false } }}\n                allow-custom-entity\n                @value-changed=${e => this._onEntity(i, e.detail.value)}\n              ></ha-selector>\n            </div>\n\n            <div class=\"input-group\">\n              <label>Icon:</label>\n              <ha-icon-picker\n                .hass=${this.hass}\n                .value=${cfg.icon || ''}\n                allow-custom-icon\n                @value-changed=${e => this._onIcon(i, e.detail.value)}\n              ></ha-icon-picker>\n            </div>\n\n            ${['tap','hold'].map(type => html`\n              <div class=\"input-group\">\n                <label>${type === 'tap' ? 'Tap Action' : 'Hold Action'}:</label>\n                <div class=\"pill-group\">\n                  ${actions.map(a => html`\n                    <button\n                      class=\"pill-button ${cfg[`${type}_action`]?.action === a ? 'active' : ''}\"\n                      @click=${() => this._onAction(i, type, 'action', a)}\n                    >${a}</button>\n                  `)}\n                </div>\n                ${this._extraFields(i, type, cfg)}\n              </div>\n            `)}\n          </div>\n        ` : ''}\n      </div>\n    `;\n  }\n\n  _extraFields(i, type, cfg) {\n    const act = cfg?.[`${type}_action`]?.action;\n    if (act === 'navigate') {\n      return html`\n        <input type=\"text\" placeholder=\"Path\"\n          .value=${cfg?.[`${type}_action`]?.navigation_path || ''}\n          @input=${e => this._onAction(i, type, 'navigation_path', e.target.value)}\n        />\n      `;\n    }\n    if (act === 'call-service') {\n      return html`\n        <input type=\"text\" placeholder=\"Service\"\n          .value=${cfg?.[`${type}_action`]?.service || ''}\n          @input=${e => this._onAction(i, type, 'service', e.target.value)}\n        />\n        <input type=\"text\" placeholder='Service Data (JSON)'\n          .value=${cfg?.[`${type}_action`]?.service_data ? JSON.stringify(cfg[`${type}_action`].service_data) : ''}\n          @input=${e => this._onAction(i, type, 'service_data', this._safeJson(e.target.value))}\n        />\n      `;\n    }\n    return '';\n  }\n\n  _safeJson(txt) { try { return JSON.parse(txt); } catch { return {}; } }\n\n  _toggleAuto(on) {\n    if (this._syncingFromConfig) return;\n    this._emit('auto_discovery_sections.subbutton', on);\n  }\n\n  _togglePill(i) {\n    this._expanded = this._expanded.map((v, k) => (k === i ? !v : false));\n  }\n\n  // Filtri: singolo chip e Clear (one-shot)\n  // identico a MushroomPanel: niente .value forzato\n  _onFilter(i, vals) {\n    let newFilters;\n    \n    if (this._ignoreNextFilterChange.has(i)) {\n      this._ignoreNextFilterChange.delete(i);\n      newFilters = [];\n    } else {\n      newFilters = Array.isArray(vals) ? vals.filter(Boolean) : [];\n    }\n    \n    // crea un nuovo array per triggerare il re-render\n    this._filters = this._filters.map((f, idx) => idx === i ? [...newFilters] : f);\n    \n    this.requestUpdate('_filters');\n    this._emit('subbutton_filters', this._filters);\n  }\n  \n  _clearFilter(i) {\n    this._ignoreNextFilterChange.add(i);\n    \n    // crea nuovo array vuoto nella posizione i\n    this._filters = this._filters.map((f, idx) => idx === i ? [] : f);\n    \n    this.requestUpdate('_filters');\n    this._emit('subbutton_filters', this._filters);\n  }\n\n\n  _onEntity(i, ent) {\n    this._entities[i] = ent || '';\n    if (this._syncingFromConfig) return;\n    \n    // Salva l’entità selezionata (anche vuota)\n    this._emit(`subbuttons.${i}.entity_id`, this._entities[i]);\n    \n    // Se l'entità è stata cancellata → cancella anche l'icona (comportamento come MushroomPanel)\n    if (!this._entities[i]) {\n      this._emit(`subbuttons.${i}.icon`, '');\n      return;\n    }\n    \n    // Entità presente → ricalcola SEMPRE l’icona (stato → fallback mapping)\n    const st = this.hass?.states?.[this._entities[i]];\n    const iconFromState = st?.attributes?.icon;\n    const autoIcon = iconFromState || resolveEntityIcon(this._entities[i], this.hass);\n    if (autoIcon) {\n      this._emit(`subbuttons.${i}.icon`, autoIcon);\n    }\n  }\n  _onIcon(i, icon) {\n    if (this._syncingFromConfig) return;\n    this._emit(`subbuttons.${i}.icon`, icon || '');\n  }\n\n  _onAction(i, type, field, val) {\n    if (this._syncingFromConfig) return;\n    const patch = { ...((this.config?.subbuttons?.[i] || {})[`${type}_action`] || {}), [field]: val };\n    this._emit(`subbuttons.${i}.${type}_action`, patch);\n  }\n\n  _reset() {\n    this._expanded = Array(4).fill(false);\n    this._filters  = Array(4).fill().map(() => [...COMMON_CATS]);\n    this._entities = Array(4).fill('');\n\n    // Propaga reset: filtri ed entità\n    this._emit('subbutton_filters', this._filters);\n    for (let i = 0; i < 4; i++) {\n      this._emit(`subbuttons.${i}`, {}); // svuota ogni subbutton\n    }\n  }\n\n  _emit(prop, val) {\n    this.dispatchEvent(new CustomEvent('panel-changed', {\n      detail: { prop, val },\n      bubbles: true,\n      composed: true,\n    }));\n  }\n}\n\ncustomElements.define('sub-button-panel', SubButtonPanel);","// src/panels/ColorPanel.js\nimport { LitElement, html, css } from 'lit';\n\nexport class ColorPanel extends LitElement {\n  static properties = {\n    hass:     { type: Object },\n    config:   { type: Object },\n    expanded: { type: Boolean },\n\n    // stati derivati e UI\n    _room:      { type: Object, state: true },\n    _subbutton: { type: Object, state: true },\n    _mushroom:  { type: Object, state: true },\n    _sensor:    { type: Object, state: true },\n\n    _selectedPreset:  { type: String,  state: true },\n    _expandedColors:  { type: Array,   state: true }, // [room, subbutton, mushroom]\n    _subbuttonStyle:  { type: String,  state: true },\n  };\n\n  constructor() {\n    super();\n    this.hass = {};\n    this.config = {};\n    this.expanded = false;\n\n    // stati locali\n    this._room = {};\n    this._subbutton = {};\n    this._mushroom = {};\n    this._sensor = {};\n\n    // UI state\n    this._selectedPreset = 'green';\n    this._expandedColors = [false, false, false];\n    this._subbuttonStyle = 'standard';\n  }\n\n  updated(changed) {\n    if (changed.has('config')) {\n      const c = this.config?.colors || {};\n      this._room = {\n        icon_active:         c.room?.icon_active ?? '',\n        icon_inactive:       c.room?.icon_inactive ?? '',\n        background_active:   c.room?.background_active ?? '',\n        background_inactive: c.room?.background_inactive ?? '',\n        text_active:         c.room?.text_active ?? '',\n        text_inactive:       c.room?.text_inactive ?? '',\n      };\n      this._subbutton = {\n        background_on:  c.subbutton?.background_on  ?? '',\n        background_off: c.subbutton?.background_off ?? '',\n        icon_on:        c.subbutton?.icon_on        ?? '',\n        icon_off:       c.subbutton?.icon_off       ?? '',\n      };\n      this._mushroom = {\n        active:   c.mushroom?.active   ?? '',\n        inactive: c.mushroom?.inactive ?? '',\n      };\n      this._sensor = {\n        sensor_active:   c.sensor?.sensor_active   ?? '',\n        sensor_inactive: c.sensor?.sensor_inactive ?? '',\n      };\n\n      this._subbuttonStyle = this.config?.subbutton_style || 'standard';\n    }\n  }\n\n  // ───────────────── Preset (schema NIDIFICATO usato dalla UI) ─────────────────\n  get PRESETS() {\n    return {\n      green: {\n        label: \"Green\",\n        room: {\n          icon_active: \"#21df73\",\n          icon_inactive: \"rgba(33,223,115,0.35)\",\n          background_active: \"rgba(33,223,115,0.50)\",\n          background_inactive: \"rgba(33,223,115,0.25)\",\n          text_active: \"rgba(33,223,115,0.50)\",\n          text_inactive: \"rgba(33,223,115,0.25)\",\n        },\n        sub: {\n          background_on: \"rgba(33,223,115,0.50)\",\n          background_off: \"rgba(33,223,115,0.25)\",\n          icon_on: \"#21df73\",\n          icon_off: \"rgba(33,223,115,0.35)\",\n        },\n        mushroom: { active: \"#21df73\", inactive: \"rgba(33,223,115,0.35)\" },\n        sensor: { sensor_active: \"rgba(33,223,115,0.50)\", sensor_inactive: \"rgba(33,223,115,0.25)\" },\n      },\n      \n      blue: {\n        label: \"Blue\",\n        room: {\n          icon_active: \"#55afff\",\n          icon_inactive: \"rgba(85,175,255,0.35)\",\n          background_active: \"rgba(85,175,255,0.50)\",\n          background_inactive: \"rgba(85,175,255,0.25)\",\n          text_active: \"rgba(85,175,255,0.50)\",\n          text_inactive: \"rgba(85,175,255,0.25)\",\n        },\n        sub: {\n          background_on: \"rgba(85,175,255,0.50)\",\n          background_off: \"rgba(85,175,255,0.25)\",\n          icon_on: \"#55afff\",\n          icon_off: \"rgba(85,175,255,0.35)\",\n        },\n        mushroom: { active: \"#55afff\", inactive: \"rgba(85,175,255,0.35)\" },\n        sensor: { sensor_active: \"rgba(85,175,255,0.50)\", sensor_inactive: \"rgba(85,175,255,0.25)\" },\n      },\n      \n      amber: {\n        label: \"Amber\",\n        room: {\n          icon_active: \"#ff9b3d\",\n          icon_inactive: \"rgba(255,155,61,0.35)\",\n          background_active: \"rgba(255,155,61,0.50)\",\n          background_inactive: \"rgba(255,155,61,0.25)\",\n          text_active: \"rgba(255,155,61,0.50)\",\n          text_inactive: \"rgba(255,155,61,0.25)\",\n        },\n        sub: {\n          background_on: \"rgba(255,155,61,0.50)\",\n          background_off: \"rgba(255,155,61,0.25)\",\n          icon_on: \"#ff9b3d\",\n          icon_off: \"rgba(255,155,61,0.35)\",\n        },\n        mushroom: { active: \"#ff9b3d\", inactive: \"rgba(255,155,61,0.35)\" },\n        sensor: { sensor_active: \"rgba(255,155,61,0.50)\", sensor_inactive: \"rgba(255,155,61,0.25)\" },\n      },\n      \n      purple: {\n        label: \"Purple\",\n        room: {\n          icon_active: \"#bd64ff\",\n          icon_inactive: \"rgba(189,100,255,0.35)\",\n          background_active: \"rgba(189,100,255,0.50)\",\n          background_inactive: \"rgba(189,100,255,0.25)\",\n          text_active: \"rgba(189,100,255,0.50)\",\n          text_inactive: \"rgba(189,100,255,0.25)\",\n        },\n        sub: {\n          background_on: \"rgba(189,100,255,0.50)\",\n          background_off: \"rgba(189,100,255,0.25)\",\n          icon_on: \"#bd64ff\",\n          icon_off: \"rgba(189,100,255,0.35)\",\n        },\n        mushroom: { active: \"#bd64ff\", inactive: \"rgba(189,100,255,0.35)\" },\n        sensor: { sensor_active: \"rgba(189,100,255,0.50)\", sensor_inactive: \"rgba(189,100,255,0.25)\" },\n      },\n      \n      red: {\n        label: \"Red\",\n        room: {\n          icon_active: \"#ff5c6a\",\n          icon_inactive: \"rgba(255,92,106,0.35)\",\n          background_active: \"rgba(255,92,106,0.50)\",\n          background_inactive: \"rgba(255,92,106,0.25)\",\n          text_active: \"rgba(255,92,106,0.50)\",\n          text_inactive: \"rgba(255,92,106,0.25)\",\n        },\n        sub: {\n          background_on: \"rgba(255,92,106,0.50)\",\n          background_off: \"rgba(255,92,106,0.25)\",\n          icon_on: \"#ff5c6a\",\n          icon_off: \"rgba(255,92,106,0.35)\",\n        },\n        mushroom: { active: \"#ff5c6a\", inactive: \"rgba(255,92,106,0.35)\" },\n        sensor: { sensor_active: \"rgba(255,92,106,0.50)\", sensor_inactive: \"rgba(255,92,106,0.25)\" },\n      },\n      \n      yellow: {\n        label: \"Yellow\",\n        room: {\n          icon_active: \"#ffd633\",\n          icon_inactive: \"rgba(255,214,51,0.35)\",\n          background_active: \"rgba(255,214,51,0.50)\",\n          background_inactive: \"rgba(255,214,51,0.25)\",\n          text_active: \"rgba(255,214,51,0.50)\",\n          text_inactive: \"rgba(255,214,51,0.25)\",\n        },\n        sub: {\n          background_on: \"rgba(255,214,51,0.50)\",\n          background_off: \"rgba(255,214,51,0.25)\",\n          icon_on: \"#ffd633\",\n          icon_off: \"rgba(255,214,51,0.35)\",\n        },\n        mushroom: { active: \"#ffd633\", inactive: \"rgba(255,214,51,0.35)\" },\n        sensor: { sensor_active: \"rgba(255,214,51,0.50)\", sensor_inactive: \"rgba(255,214,51,0.25)\" },\n      },\n      \n      teal: {\n        label: \"Teal\",\n        room: {\n          icon_active: \"#00bfa5\",\n          icon_inactive: \"rgba(0,191,165,0.35)\",\n          background_active: \"rgba(0,191,165,0.50)\",\n          background_inactive: \"rgba(0,191,165,0.25)\",\n          text_active: \"rgba(0,191,165,0.50)\",\n          text_inactive: \"rgba(0,191,165,0.25)\",\n        },\n        sub: {\n          background_on: \"rgba(0,191,165,0.50)\",\n          background_off: \"rgba(0,191,165,0.25)\",\n          icon_on: \"#00bfa5\",\n          icon_off: \"rgba(0,191,165,0.35)\",\n        },\n        mushroom: { active: \"#00bfa5\", inactive: \"rgba(0,191,165,0.35)\" },\n        sensor: { sensor_active: \"rgba(0,191,165,0.50)\", sensor_inactive: \"rgba(0,191,165,0.25)\" },\n      },\n      \n      gray: {\n        label: \"Gray\",\n        room: {\n          icon_active: \"#c5c8ce\",\n          icon_inactive: \"rgba(197,200,206,0.35)\",\n          background_active: \"rgba(197,200,206,0.50)\",\n          background_inactive: \"rgba(197,200,206,0.25)\",\n          text_active: \"rgba(197,200,206,0.50)\",\n          text_inactive: \"rgba(197,200,206,0.25)\",\n        },\n        sub: {\n          background_on: \"rgba(197,200,206,0.50)\",\n          background_off: \"rgba(197,200,206,0.25)\",\n          icon_on: \"#c5c8ce\",\n          icon_off: \"rgba(197,200,206,0.35)\",\n        },\n        mushroom: { active: \"#c5c8ce\", inactive: \"rgba(197,200,206,0.35)\" },\n        sensor: { sensor_active: \"rgba(197,200,206,0.50)\", sensor_inactive: \"rgba(197,200,206,0.25)\" },\n      },\n    };\n  }\n  // ─────────────────── STILI ───────────────────\n  static styles = css`\n    :host { display:block; }\n    .glass-panel {\n      margin: 0 !important;\n      width: 100%;\n      box-sizing: border-box;\n      border-radius: 40px;\n      position: relative;\n      background: var(--glass-bg, rgba(95,255,235,0.26));\n      box-shadow: var(--glass-shadow, 0 2px 24px rgba(95,255,235,0.13));\n      overflow: hidden;\n    }\n    .glass-panel::after {\n      content: '';\n      position: absolute; inset: 0;\n      border-radius: inherit;\n      background: var(--glass-sheen,\n        linear-gradient(120deg, rgba(255,255,255,0.14),\n        rgba(255,255,255,0.08) 70%, transparent 100%));\n      pointer-events: none;\n    }\n    .glass-header {\n      padding: 22px 0;\n      text-align: center;\n      font-size: 1.11rem;\n      font-weight: 700;\n      color: #fff;\n    }\n\n    /* Grid delle card preset */\n    .preset-bar {\n      display: grid;\n      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));\n      gap: 12px;\n      padding: 8px 16px 2px 16px;\n      box-sizing: border-box;\n    }\n    .style-section {\n      padding: 0 16px 12px 16px;\n      box-sizing: border-box;\n    }\n    .style-heading {\n      font-size: 1.05rem;\n      font-weight: 700;\n      color: #e9f8ff;\n      text-align: center;\n      margin: 4px 0 10px 0;\n    }\n    .style-bar {\n      display: grid;\n      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));\n      gap: 12px;\n    }\n    .style-card {\n      position: relative;\n      border-radius: 14px;\n      border: 1px solid rgba(255,255,255,0.14);\n      background: rgba(24,32,40,0.45);\n      padding: 14px 16px;\n      cursor: pointer;\n      user-select: none;\n      transition: transform .12s ease, box-shadow .12s ease, border-color .12s ease;\n      outline: none;\n      display: flex;\n      flex-direction: column;\n      gap: 6px;\n      text-align: center;\n      min-height: 98px;\n    }\n    .style-card:hover {\n      transform: translateY(-2px);\n      box-shadow: 0 6px 20px rgba(0,0,0,0.25);\n      border-color: rgba(255,255,255,0.28);\n    }\n    .style-card.selected {\n      border-color: #73f6e5;\n      box-shadow: 0 0 0 2px inset rgba(115,246,229,0.35);\n    }\n    .style-card:focus-visible {\n      box-shadow: 0 0 0 3px rgba(115,246,229,0.55);\n    }\n    .style-name {\n      font-weight: 800;\n      font-size: 1.0rem;\n      color: #e9f8ff;\n    }\n    .style-desc {\n      font-size: 0.88rem;\n      color: rgba(233,248,255,0.75);\n      line-height: 1.35;\n    }\n    .preset-card {\n      position: relative;\n      border-radius: 14px;\n      border: 1px solid rgba(255,255,255,0.14);\n      background: rgba(24,32,40,0.45);\n      padding: 12px 12px 10px;\n      cursor: pointer;\n      user-select: none;\n      transition: transform .12s ease, box-shadow .12s ease, border-color .12s ease;\n      outline: none;\n      display: grid;\n      grid-template-rows: auto auto; /* nome sopra, swatches sotto */\n      gap: 8px;\n    }\n    .preset-card:hover {\n      transform: translateY(-2px);\n      box-shadow: 0 6px 20px rgba(0,0,0,0.25);\n      border-color: rgba(255,255,255,0.28);\n    }\n    .preset-card.selected {\n      border-color: #73f6e5;\n      box-shadow: 0 0 0 2px inset rgba(115,246,229,0.35);\n    }\n    .preset-name {\n      order: 1;\n      font-weight: 800;\n      color: #e9f8ff;\n      font-size: .95rem;\n      text-align: center;\n      margin-bottom: 2px;\n    }\n\n    /* swatches: etichetta SOTTO al pallino */\n    .swatches {\n      order: 2;\n      display: grid;\n      grid-template-columns: 1fr 1fr;\n      gap: 8px;\n    }\n    .swatch {\n      border-radius: 10px;\n      padding: 8px 6px;\n      border: 1px solid rgba(255,255,255,0.10);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      gap: 6px;\n      flex-direction: column;   /* testo sotto */\n    }\n    .dot {\n      width: 16px; height: 16px; border-radius: 50%;\n      border: 2px solid rgba(255,255,255,0.75);\n      flex: 0 0 auto;\n    }\n    .swatch-label {\n      color: #f0f6ff;\n      font-size: .8rem;\n      opacity: .95;\n      line-height: 1;\n    }\n    /* tasto apply preset */\n    .apply-row {\n      display: flex;\n      justify-content: center;\n      padding: 16px 0;\n    }\n\n    .apply-btn {\n      font-size: 1.1rem;\n      padding: 12px 24px;\n      border: 2.5px solid #73f6e5;\n      color: #073a34;\n      background: #73f6e5;\n      border-radius: 14px;\n      cursor: pointer;\n      font-weight: 800;\n      transition: transform .12s ease, box-shadow .12s ease, filter .12s ease;\n    }\n    .apply-btn:hover {\n      transform: translateY(-1px);\n      filter: brightness(1.05);\n    }\n\n    /* Sezioni manuali */\n    .mini-pill {\n      background: rgba(44,70,100,0.23);\n      border: 1.5px solid rgba(255,255,255,0.12);\n      box-shadow: 0 3px 22px rgba(70,120,220,0.13);\n      backdrop-filter: blur(10px) saturate(1.2);\n      border-radius: 24px;\n      margin: 8px 16px;\n      overflow: hidden;\n      transition: background 0.18s, box-shadow 0.18s, border 0.18s;\n    }\n    .mini-pill-header {\n      display: flex;\n      align-items: center;\n      padding: 15px 22px;\n      font-weight: 800;\n      color: var(--section-accent, #73f6e5);\n      cursor: pointer;\n      user-select: none;\n    }\n    .mini-pill-header .chevron {\n      margin-left: auto;\n      font-size: 1.2em;\n      transition: transform 0.18s;\n    }\n    .mini-pill.expanded .mini-pill-header .chevron {\n      transform: rotate(90deg);\n    }\n    .mini-pill-content {\n      padding: 15px 22px 16px;\n      animation: pill-expand 0.22s cubic-bezier(.5,1.2,.6,1) both;\n      position: relative;\n      z-index: 1;\n    }\n    @keyframes pill-expand {\n      from { opacity: 0; transform: translateY(-12px); }\n      to   { opacity: 1; transform: translateY(0); }\n    }\n    .input-group {\n      background: rgba(44,70,100,0.23);\n      border: 1.5px solid rgba(255,255,255,0.13);\n      box-shadow: 0 2px 14px rgba(70,120,220,0.10);\n      border-radius: 18px;\n      margin-bottom: 13px;\n      padding: 14px 18px 10px;\n    }\n    .input-group label {\n      display: block;\n      font-size: 1.13rem;\n      font-weight: 700;\n      color: var(--section-accent, #73f6e5);\n      margin-bottom: 6px;\n    }\n    input[type=\"color\"] {\n      width: 56px; height: 32px;\n      border: 2px solid #fff4;\n      border-radius: 9px;\n      cursor: pointer;\n    }\n    input[type=\"range\"] { width: 100%; }\n    input[type=\"text\"] {\n      width: 100%;\n      border: 1px solid #444;\n      border-radius: 6px;\n      padding: 8px;\n      background-color: #202020;\n      color: #f1f1f1;\n      font-size: 0.97rem;\n    }\n    .reset-button {\n      border: 3.5px solid #ff4c6a !important;\n      color: #ff4c6a !important;\n      font-size: 1.15rem;\n      font-weight: 700;\n      box-shadow: 0 2px 24px #ff4c6a44;\n      padding: 12px 38px !important;\n      margin: 20px auto 0 auto !important;\n      display: block;\n      background: transparent;\n      border-radius: 24px !important;\n      transition: background 0.18s, color 0.18s, box-shadow 0.18s;\n    }\n    .reset-button:hover {\n      background: rgba(255,76,106,0.18) !important;\n      color: #fff !important;\n      box-shadow: 0 6px 32px #ff4c6abf;\n    }\n  `;\n\n  // ─────────────────── UI ───────────────────\n  render() {\n    return html`\n      <ha-expansion-panel\n        class=\"glass-panel\"\n        .expanded=${this.expanded}\n        @expanded-changed=${e => {\n          this.expanded = e.detail.expanded;\n          if (this.expanded) this._expandedColors = [false, false, false];\n        }}\n      >\n        <div slot=\"header\" class=\"glass-header\">🎨 Colors & Presets</div>\n\n        ${this._renderStyleChooser()}\n\n        <!-- Preset chooser -->\n        ${this._renderPresetChooser()}\n\n        <!-- Room colors -->\n        <div class=\"mini-pill ${this._expandedColors[0] ? 'expanded' : ''}\">\n          <div\n            class=\"mini-pill-header\"\n            style=\"--section-accent: #55afff;\"\n            @click=${() => this._toggleColor(0)}\n          >\n            Room Colors\n            <span class=\"chevron\">${this._expandedColors[0] ? '▼' : '▶'}</span>\n          </div>\n          ${this._expandedColors[0] ? html`\n            <div class=\"mini-pill-content\">\n              ${this._renderColorField('room', 'background_active',   'Background Active')}\n              ${this._renderColorField('room', 'background_inactive', 'Background Inactive')}\n              ${this._renderColorField('room', 'icon_active',         'Icon Active')}\n              ${this._renderColorField('room', 'icon_inactive',       'Icon Inactive')}\n              ${this._renderColorField('room', 'text_active',         'Text Active')}\n              ${this._renderColorField('room', 'text_inactive',       'Text Inactive')}\n            </div>\n          ` : ''}\n        </div>\n\n        <!-- Subbutton colors -->\n        <div class=\"mini-pill ${this._expandedColors[1] ? 'expanded' : ''}\">\n          <div\n            class=\"mini-pill-header\"\n            style=\"--section-accent: #b28fff;\"\n            @click=${() => this._toggleColor(1)}\n          >\n            Subbutton Colors\n            <span class=\"chevron\">${this._expandedColors[1] ? '▼' : '▶'}</span>\n          </div>\n          ${this._expandedColors[1] ? html`\n            <div class=\"mini-pill-content\">\n              ${this._renderColorField('subbutton', 'background_on',  'Background On')}\n              ${this._renderColorField('subbutton', 'background_off', 'Background Off')}\n              ${this._renderColorField('subbutton', 'icon_on',        'Icon On')}\n              ${this._renderColorField('subbutton', 'icon_off',       'Icon Off')}\n            </div>\n          ` : ''}\n        </div>\n\n        <!-- Mushroom colors -->\n        <div class=\"mini-pill ${this._expandedColors[2] ? 'expanded' : ''}\">\n          <div\n            class=\"mini-pill-header\"\n            style=\"--section-accent: #4bd1b4;\"\n            @click=${() => this._toggleColor(2)}\n          >\n            Mushroom Colors\n            <span class=\"chevron\">${this._expandedColors[2] ? '▼' : '▶'}</span>\n          </div>\n          ${this._expandedColors[2] ? html`\n            <div class=\"mini-pill-content\">\n              ${this._renderColorField('mushroom', 'active',   'Active')}\n              ${this._renderColorField('mushroom', 'inactive', 'Inactive')}\n            </div>\n          ` : ''}\n        </div>\n\n        <!-- Reset -->\n        <button class=\"reset-button\" @click=${() => this._resetColors()}>\n          🧹 Reset Colors\n        </button>\n      </ha-expansion-panel>\n    `;\n  }\n\n  // ─────────────────── UI helpers ───────────────────\n  _renderStyleChooser() {\n    const options = [\n      {\n        key: 'standard',\n        label: 'Standard (v5.0.6)',\n        description: 'Aspetto classico con pillole solide e contrastate.',\n      },\n      {\n        key: 'liquid-glass',\n        label: 'Liquid Glass',\n        description: 'Effetto vetro liquido con trasparenze morbide.',\n      },\n    ];\n\n    return html`\n      <div class=\"style-section\">\n        <div class=\"style-heading\">Subbutton Style</div>\n        <div class=\"style-bar\">\n          ${options.map(opt => this._renderStyleCard(opt))}\n        </div>\n      </div>\n    `;\n  }\n\n  _renderStyleCard({ key, label, description }) {\n    const isSelected = this._subbuttonStyle === key;\n    const selectedClass = isSelected ? 'selected' : '';\n    return html`\n      <div\n        class=\"style-card ${selectedClass}\"\n        role=\"button\"\n        tabindex=\"0\"\n        aria-pressed=${isSelected ? 'true' : 'false'}\n        @click=${() => this._selectStyle(key)}\n        @keydown=${e => this._onStyleKeydown(e, key)}\n      >\n        <div class=\"style-name\">${label}</div>\n        <div class=\"style-desc\">${description}</div>\n      </div>\n    `;\n  }\n\n  _renderPresetChooser() {\n    const keys = Object.keys(this.PRESETS);\n    return html`\n      <div class=\"preset-bar\">\n        ${keys.map(k => this._renderPresetCard(k, this.PRESETS[k]))}\n      </div>\n      <div class=\"apply-row\">\n        <button class=\"apply-btn\" @click=${this._applySelectedPreset}>\n          Apply Preset\n        </button>\n      </div>\n    `;\n  }\n\n  _renderPresetCard(key, p) {\n    const sel = this._selectedPreset === key ? 'selected' : '';\n    const roomA = p.room.background_active;\n    const roomI = p.room.background_inactive;\n    const iconA = p.room.icon_active;\n    const iconI = p.room.icon_inactive;\n    return html`\n      <div class=\"preset-card ${sel}\" @click=${() => this._selectedPreset = key}>\n        <div class=\"preset-name\">${p.label}</div>\n        <div class=\"swatches\">\n          <div class=\"swatch\" style=\"background:${roomA}\">\n            <span class=\"dot\" style=\"background:${iconA}\"></span>\n            <span class=\"swatch-label\">On</span>\n          </div>\n          <div class=\"swatch\" style=\"background:${roomI}\">\n            <span class=\"dot\" style=\"background:${iconI}\"></span>\n            <span class=\"swatch-label\">Off</span>\n          </div>\n        </div>\n      </div>\n    `;\n  }\n\n  _toggleColor(index) {\n    this._expandedColors = this._expandedColors.map((v, i) => i === index ? !v : false);\n  }\n\n  _renderColorField(section, key, label) {\n    const rgba = this.config?.colors?.[section]?.[key] || '';\n    const [r, g, b, a] = this._parseRGBA(rgba);\n    const hex = `#${[r, g, b].map(x => x.toString(16).padStart(2, '0')).join('')}`;\n    return html`\n      <div class=\"input-group\">\n        <label>${label}</label>\n        <input\n          type=\"color\"\n          .value=${hex}\n          @input=${e => this._updateColor(section, key, e.target.value, a)}\n        />\n        <input\n          type=\"range\"\n          min=\"0\" max=\"1\" step=\"0.01\"\n          .value=${a}\n          @input=${e => this._updateColor(section, key, hex, e.target.value)}\n        />\n        <input\n          type=\"text\"\n          .value=${rgba}\n          @input=${e => this._updateColorRaw(section, key, e.target.value)}\n        />\n      </div>\n    `;\n  }\n\n  // ─────────────────── APPLY / RESET ───────────────────\n  _applySelectedPreset = () => {\n    const key = this._selectedPreset;\n    const preset = this.PRESETS[key];\n    if (!preset) return;\n\n    const ops = [\n      // Room\n      ['colors.room.background_active',   preset.room.background_active],\n      ['colors.room.background_inactive', preset.room.background_inactive],\n      ['colors.room.icon_active',         preset.room.icon_active],\n      ['colors.room.icon_inactive',       preset.room.icon_inactive],\n      ['colors.room.text_active',         preset.room.text_active],\n      ['colors.room.text_inactive',       preset.room.text_inactive],\n\n      // Subbutton\n      ['colors.subbutton.background_on',  preset.sub.background_on],\n      ['colors.subbutton.background_off', preset.sub.background_off],\n      ['colors.subbutton.icon_on',        preset.sub.icon_on],\n      ['colors.subbutton.icon_off',       preset.sub.icon_off],\n\n      // Mushroom\n      ['colors.mushroom.active',          preset.mushroom.active],\n      ['colors.mushroom.inactive',        preset.mushroom.inactive],\n\n      // Sensor\n      ['colors.sensor.sensor_active',     preset.sensor.sensor_active],\n      ['colors.sensor.sensor_inactive',   preset.sensor.sensor_inactive],\n    ];\n\n    for (const [prop, val] of ops) {\n      this._emit(prop, val);\n    }\n  };\n\n  _resetColors() {\n    this._expandedColors = [false, false, false];\n    const sections = ['room','subbutton','mushroom','sensor'];\n    const keys = {\n      room:      ['background_active','background_inactive','icon_active','icon_inactive','text_active','text_inactive'],\n      subbutton: ['background_on','background_off','icon_on','icon_off'],\n      mushroom:  ['active','inactive'],\n      sensor:    ['sensor_active','sensor_inactive'],\n    };\n    sections.forEach(sec => {\n      keys[sec].forEach(k => this._emit(`colors.${sec}.${k}`, ''));\n    });\n  }\n\n  // ─────────────────── Low-level helpers ───────────────────\n  _parseRGBA(str) {\n    if (!str) return [0,0,0,1];\n    const m = /rgba?\\((\\d+),\\s*(\\d+),\\s*(\\d+)(?:,\\s*([\\d.]+))?\\)/.exec(str);\n    if (m) return [ +m[1], +m[2], +m[3], +(m[4] ?? 1) ];\n    // supporta anche #rrggbb fallback\n    if (str.startsWith('#') && (str.length === 7 || str.length === 4)) {\n      const hex = str.length === 7 ? str.slice(1) :\n        str.slice(1).split('').map(c => c + c).join('');\n      const r = parseInt(hex.slice(0,2),16);\n      const g = parseInt(hex.slice(2,4),16);\n      const b = parseInt(hex.slice(4,6),16);\n      return [r,g,b,1];\n    }\n    return [0,0,0,1];\n  }\n\n  _updateColor(section, key, hex, alpha) {\n    const r = parseInt(hex.slice(1,3),16);\n    const g = parseInt(hex.slice(3,5),16);\n    const b = parseInt(hex.slice(5,7),16);\n    const a = Number(alpha);\n    const rgba = `rgba(${r},${g},${b},${isNaN(a) ? 1 : a})`;\n    this._emit(`colors.${section}.${key}`, rgba);\n  }\n\n  _updateColorRaw(section, key, raw) {\n    this._emit(`colors.${section}.${key}`, raw);\n  }\n\n  _selectStyle(style) {\n    if (this._subbuttonStyle === style) return;\n    this._subbuttonStyle = style;\n    this._emit('subbutton_style', style);\n  }\n\n  _onStyleKeydown(event, style) {\n    if (event.key === 'Enter' || event.key === ' ') {\n      event.preventDefault();\n      this._selectStyle(style);\n    }\n  }\n\n  _emit(prop, val) {\n    this.dispatchEvent(new CustomEvent('panel-changed', {\n      detail: { prop, val },\n      bubbles: true,\n      composed: true,\n    }));\n  }\n}\n\ncustomElements.define('color-panel', ColorPanel);","// src/panels/CameraPanel.js\nimport { LitElement, html, css } from 'lit';\nimport { maybeAutoDiscover } from '../helpers/auto-discovery.js';\nimport { candidatesFor } from '../helpers/entity-filters.js';\nimport { resolveEntityIcon } from '../helpers/icon-mapping.js';\n\nexport class CameraPanel extends LitElement {\n  static properties = {\n    hass:     { type: Object },\n    config:   { type: Object },\n    expanded: { type: Boolean },\n\n    _entity:      { type: String, state: true },\n    _icon:        { type: String, state: true },\n    _candidates:  { type: Array,  state: true },\n    _presence: { type: String, state: true },\n    _presenceCandidates: { type: Array, state: true },\n  };\n\n  constructor() {\n    super();\n    this.hass = {};\n    this.config = {};\n    this.expanded = false;\n\n    this._entity = '';\n    this._icon = '';\n    this._candidates = [];\n    this._presence = '';\n    this._presenceCandidates = [];\n    this._syncingFromConfig = false;\n  }\n\n  updated(changed) {\n    if (changed.has('config') || changed.has('hass')) {\n      this._syncingFromConfig = true;\n\n      // 🔎 applica autodiscovery (usando il valore di ritorno)\n      if (this.config?.area || this.config?.area_id) {\n        const next = maybeAutoDiscover(this.hass, this.config, 'area', false);\n        if (next && next !== this.config) {\n          this.dispatchEvent(new CustomEvent('config-changed', {\n            detail: { config: next }, bubbles: true, composed: true\n          }));\n        }\n      }\n\n      // sync stato locale da config\n      this._entity = this.config?.entities?.camera?.entity || '';\n      this._icon   = this.config?.entities?.camera?.icon   || '';\n      this._presence = this.config?.entities?.camera?.presence?.entity || '';\n\n      // 🎯 candidati\n      const autoDisc = this.config?.auto_discovery_sections?.camera ?? false;\n      if (autoDisc) {\n        this._candidates = candidatesFor(this.hass, this.config, 'camera') || [];\n        \n          // Presence/Motion: filtra per device_class e poi area\n        const presAll = candidatesFor(this.hass, this.config, 'presence', [\n          'motion', 'occupancy', 'presence', 'moving'\n        ]) || [];\n        const presBin = presAll.filter(id => id.startsWith('binary_sensor.'));\n        // Mantiene la selezionata in cima\n        if (this._presence && !presBin.includes(this._presence)) {\n          presBin.unshift(this._presence);\n        }\n        this._presenceCandidates = presBin;   \n        \n      } else {\n        // Nessun filtro area: tutte le entità camera, con la selezionata in cima\n        let ids = Object.keys(this.hass?.states || {}).filter((id) => id.startsWith('camera.'));\n        if (this._entity && !ids.includes(this._entity)) ids.unshift(this._entity);\n        this._candidates = ids;\n        \n        // Nessun filtro presence: tutti i binary_sensor, con la selezionata in cima\n        let presIds = Object.keys(this.hass?.states || {}).filter(id => id.startsWith('binary_sensor.'));\n        if (this._presence && !presIds.includes(this._presence)) presIds.unshift(this._presence);\n        this._presenceCandidates = presIds;        \n        \n      }\n      // 🎨 Auto-icona camera al primo load se entità presente e icona vuota\n      if (this._entity && !this._icon) {\n        const st = this.hass?.states?.[this._entity];\n        const autoIcon = st?.attributes?.icon || resolveEntityIcon(this._entity, this.hass);\n        if (autoIcon) this._icon = autoIcon;\n      }\n\n      this._syncingFromConfig = false;\n    }\n  }\n\n  static styles = css`\n    :host { display: block; }\n    .glass-panel {\n      margin: 0 !important; width: 100%; box-sizing: border-box;\n      border-radius: 40px; position: relative;\n      background: var(--glass-bg, rgba(80,120,200,0.28));\n      box-shadow: var(--glass-shadow, 0 2px 24px rgba(80,120,200,0.18));\n      overflow: hidden;\n    }\n    .glass-panel::after {\n      content:''; position:absolute; inset:0; border-radius:inherit;\n      background: var(--glass-sheen,\n        linear-gradient(120deg, rgba(255,255,255,0.18),\n        rgba(255,255,255,0.10) 70%, transparent 100%));\n      pointer-events:none;\n    }\n    .glass-header {\n      padding: 22px 0; text-align: center; font-size: 1.12rem;\n      font-weight: 700; color: #fff;\n    }\n    .input-group.autodiscover {\n      margin: 0 16px 13px; padding: 14px 18px 10px;\n      background: rgba(20,40,70,0.23);\n      border: 1.5px solid rgba(255,255,255,0.13);\n      box-shadow: 0 2px 14px rgba(40,120,180,0.10);\n      border-radius: 18px; display:flex; align-items:center; gap:8px;\n    }\n    .input-group { margin: 12px 16px; }\n    .input-group label {\n      display:block; font-weight:700; margin-bottom:6px; color:#a7c7ff;\n    }\n    ha-selector, ha-icon-picker { width:100%; box-sizing:border-box; }\n    .reset-button {\n      border: 3.5px solid #ff4c6a; color:#ff4c6a; border-radius:24px;\n      padding:12px 38px; background:transparent; cursor:pointer;\n      display:block; margin: 20px auto; font-size:1.15rem; font-weight:700;\n      box-shadow: 0 2px 24px #ff4c6a44;\n    }\n  `;\n\n  render() {\n    const autoDisc = this.config?.auto_discovery_sections?.camera ?? false;\n    return html`\n      <ha-expansion-panel\n        class=\"glass-panel\"\n        .expanded=${this.expanded}\n        @expanded-changed=${e => (this.expanded = e.detail.expanded)}\n      >\n        <div slot=\"header\" class=\"glass-header\">📷 Camera</div>\n\n        <div class=\"input-group autodiscover\">\n          <input\n            type=\"checkbox\"\n            .checked=${autoDisc}\n            @change=${e => this._toggleAuto(e.target.checked)}\n          />\n          <label>🪄 Auto-discover</label>\n        </div>\n\n        <div class=\"input-group\">\n          <label>Camera (ID):</label>\n          <ha-selector\n            .hass=${this.hass}\n            .value=${this._entity}\n            .selector=${\n              this._candidates.length\n                ? { entity: { include_entities: this._candidates, multiple: false } }\n                : { entity: { domain: 'camera' } }\n            }\n            allow-custom-entity\n            @value-changed=${e => this._onEntity(e.detail.value)}\n          ></ha-selector>\n        </div>\n\n        <div class=\"input-group\">\n          <label>Camera Icon:</label>\n          <ha-icon-picker\n            .hass=${this.hass}\n            .value=${this._icon}\n            allow-custom-icon\n            @value-changed=${e => this._onIcon(e.detail.value)}\n          ></ha-icon-picker>\n        </div>\n        \n        <div class=\"input-group\">\n          <label>Presence/Motion Entity:</label>\n          <ha-selector\n            .hass=${this.hass}\n            .value=${this._presence}\n            .selector=${\n              this._presenceCandidates.length\n                ? { entity: { include_entities: this._presenceCandidates, multiple: false } }\n                : { entity: { domain: 'binary_sensor' } }\n            }\n            allow-custom-entity\n            @value-changed=${e => this._onPresence(e.detail.value)}\n          ></ha-selector>\n        </div>\n\n\n        <button\n          class=\"reset-button\"\n          @click=${() =>\n            this.dispatchEvent(new CustomEvent('__panel_cmd__', {\n              detail: { cmd: 'reset', section: 'camera' },\n              bubbles: true, composed: true,\n            }))\n          }\n        >🧹 Reset Camera</button>\n      </ha-expansion-panel>\n    `;\n  }\n\n  _toggleAuto(on) {\n    if (this._syncingFromConfig) return;\n    this.dispatchEvent(new CustomEvent('panel-changed', {\n      detail: { prop: 'auto_discovery_sections.camera', val: on },\n      bubbles: true, composed: true,\n    }));\n  }\n\n  _onEntity(i, ent) {\n    const key = `camera${i+1}`;   // o climate${i+1} a seconda del pannello\n    this._entities[i] = ent || '';\n  \n    if (this._syncingFromConfig) return;\n  \n    // salva l’entità\n    this.dispatchEvent(new CustomEvent('panel-changed', {\n      detail: { prop: `entities.${key}.entity`, val: this._entities[i] },\n      bubbles: true, composed: true,\n    }));\n  \n    // se l’entità è stata svuotata → svuota anche l’icona\n    if (!this._entities[i]) {\n      this._icons[i] = '';\n      this.dispatchEvent(new CustomEvent('panel-changed', {\n        detail: { prop: `entities.${key}.icon`, val: '' },\n        bubbles: true, composed: true,\n      }));\n      return;\n    }\n  \n    // altrimenti calcola auto-icona come già fai\n    const st = this.hass?.states?.[this._entities[i]];\n    const iconFromState = st?.attributes?.icon;\n    const autoIco = iconFromState || resolveEntityIcon(this._entities[i], this.hass) || '';\n  \n    this._icons[i] = autoIco;\n    this.dispatchEvent(new CustomEvent('panel-changed', {\n      detail: { prop: `entities.${key}.icon`, val: autoIco },\n      bubbles: true, composed: true,\n    }));\n  }\n  _onPresence(ent) {\n    this._presence = ent || '';\n    if (this._syncingFromConfig) return;\n    this.dispatchEvent(new CustomEvent('panel-changed', {\n      detail: { prop: 'entities.camera.presence.entity', val: this._presence },\n      bubbles: true,\n      composed: true,\n    }));\n  }\n  _onIcon(icon) {\n    this._icon = icon || '';\n    if (this._syncingFromConfig) return;\n    this.dispatchEvent(new CustomEvent('panel-changed', {\n      detail: { prop: 'entities.camera.icon', val: this._icon },\n      bubbles: true, composed: true,\n    }));\n  }\n  \n  // Reset locale  richiesta di reset allo YAML\n  _reset = () => {\n    // 1) feedback immediato sulla UI\n    this._entity = '';\n    this._icon = '';\n    // se abbiamo reintrodotto presence/motion, puliamola senza errori anche se non esiste\n    if (typeof this._presence !== 'undefined') this._presence = '';\n    if (Array.isArray(this._candidates)) this._candidates = [];\n    if (Array.isArray(this._presenceCandidates)) this._presenceCandidates = [];\n\n    // 2) comanda il reset centralizzato dell'editor (usa resetCamera in backend)\n    this.dispatchEvent(new CustomEvent('__panel_cmd__', {\n      detail: { cmd: 'reset', section: 'camera' },\n      bubbles: true, composed: true,\n    }));\n\n    // 3) compatibilità: azzera esplicitamente le chiavi nel YAML\n    this.dispatchEvent(new CustomEvent('panel-changed', {\n      detail: { prop: 'entities.camera.entity', val: '' },\n      bubbles: true, composed: true,\n    }));\n    this.dispatchEvent(new CustomEvent('panel-changed', {\n      detail: { prop: 'entities.camera.icon', val: '' },\n      bubbles: true, composed: true,\n    }));\n    this.dispatchEvent(new CustomEvent('panel-changed', {\n      detail: { prop: 'entities.camera.presence.entity', val: '' },\n      bubbles: true, composed: true,\n    }));\n  }\n  \n  \n}\n\ncustomElements.define('camera-panel', CameraPanel);\n","// src/panels/ClimatePanel.js\nimport { LitElement, html, css } from 'lit';\nimport { maybeAutoDiscover } from '../helpers/auto-discovery.js';\nimport { candidatesFor } from '../helpers/entity-filters.js';\nimport { resolveEntityIcon } from '../helpers/icon-mapping.js';\n\nexport class ClimatePanel extends LitElement {\n  static properties = {\n    hass:     { type: Object },\n    config:   { type: Object },\n    expanded: { type: Boolean },\n\n    _entity:  { type: String, state: true },\n    _icon:    { type: String, state: true },\n    _candidates: { type: Array, state: true },\n  };\n\n  constructor() {\n    super();\n    this.hass       = {};\n    this.config     = {};\n    this.expanded   = false;\n\n    this._entity    = '';\n    this._icon      = '';\n    this._candidates = [];\n    this._syncingFromConfig = false;\n  }\n\n  updated(changed) {\n    if (!changed.has('config') && !changed.has('hass')) return;\n  \n    this._syncingFromConfig = true;\n  \n    // 🔁 Applica autodiscovery in base all'area (usando il valore di ritorno)\n    if (this.config?.area || this.config?.area_id) {\n      const next = maybeAutoDiscover(this.hass, this.config, 'area', false);\n      if (next && next !== this.config) {\n        this.dispatchEvent(new CustomEvent('config-changed', {\n          detail: { config: next }, bubbles: true, composed: true\n        }));\n      }\n    }\n  \n    // 🔹 Entità e icona dalla config\n    const ent = this.config?.entities?.climate?.entity || '';\n    const ico = this.config?.entities?.climate?.icon   || '';\n    this._entity = ent;\n    this._icon   = ico;\n  \n    // 🎯 Candidati: AD ON ⇒ filtrati per area; AD OFF ⇒ nessun filtro area\n    const adClimate = this.config?.auto_discovery_sections?.climate ?? false;\n    if (adClimate) {\n      const list = candidatesFor(this.hass, this.config, 'climate') || [];\n      this._candidates = Array.isArray(list) ? list : [];\n    } else {\n      let ids = Object.keys(this.hass?.states || {}).filter((id) => id.startsWith('climate.'));\n      if (this._entity && !ids.includes(this._entity)) ids.unshift(this._entity);\n      this._candidates = ids;\n    }\n  \n    // 🎨 Auto-icona al primo load se entità presente e icona vuota\n    if (this._entity && !this._icon) {\n      const st = this.hass?.states?.[this._entity];\n      const iconFromState = st?.attributes?.icon;\n      const autoIcon = iconFromState || resolveEntityIcon(this._entity, this.hass);\n      if (autoIcon) {\n        this._icon = autoIcon;\n        this.dispatchEvent(new CustomEvent('panel-changed', {\n          detail: { prop: 'entities.climate.icon', val: autoIcon },\n          bubbles: true, composed: true,\n        }));\n      }\n    }\n  \n    this._syncingFromConfig = false;\n  }\n  \n\n  static styles = css`\n    :host { display: block; }\n    .glass-panel {\n      margin: 0 !important; width: 100%; box-sizing: border-box;\n      border-radius: 40px; position: relative;\n      background: var(--glass-bg, rgba(200,120,80,0.28));\n      box-shadow: var(--glass-shadow, 0 2px 24px rgba(200,120,80,0.18));\n      overflow: hidden;\n    }\n    .glass-panel::after {\n      content:''; position:absolute; inset:0; border-radius:inherit;\n      background: var(--glass-sheen,\n        linear-gradient(120deg, rgba(255,255,255,0.18),\n        rgba(255,255,255,0.10) 70%, transparent 100%));\n      pointer-events:none;\n    }\n    .glass-header {\n      padding: 22px 0; text-align: center; font-size: 1.12rem;\n      font-weight: 700; color: #fff;\n    }\n    .input-group.autodiscover {\n      margin: 0 16px 13px; padding: 14px 18px 10px;\n      background: rgba(20,40,70,0.23);\n      border: 1.5px solid rgba(255,255,255,0.13);\n      box-shadow: 0 2px 14px rgba(40,120,180,0.10);\n      border-radius: 18px; display:flex; align-items:center; gap:8px;\n    }\n    .input-group { margin: 12px 16px; }\n    .input-group label {\n      display:block; font-weight:700; margin-bottom:6px; color:#ffb07e;\n    }\n    ha-selector, ha-icon-picker { width:100%; box-sizing:border-box; }\n    .reset-button {\n      border: 3.5px solid #ff4c6a; color:#ff4c6a; border-radius:24px;\n      padding:12px 38px; background:transparent; cursor:pointer;\n      display:block; margin: 20px auto; font-size:1.15rem; font-weight:700;\n      box-shadow: 0 2px 24px #ff4c6a44;\n    }\n  `;\n\n  render() {\n    const autoDisc = this.config?.auto_discovery_sections?.climate ?? false;\n    return html`\n      <ha-expansion-panel\n        class=\"glass-panel\"\n        .expanded=${this.expanded}\n        @expanded-changed=${e => (this.expanded = e.detail.expanded)}\n      >\n        <div slot=\"header\" class=\"glass-header\">🌡️ Climate</div>\n\n        <div class=\"input-group autodiscover\">\n          <input\n            type=\"checkbox\"\n            .checked=${autoDisc}\n            @change=${e => this._toggleAuto(e.target.checked)}\n          />\n          <label>🪄 Auto-discover</label>\n        </div>\n\n        <div class=\"input-group\">\n          <label>Climate (ID):</label>\n          <ha-selector\n            .hass=${this.hass}\n            .value=${this._entity}\n            .selector=${\n              this._candidates.length\n                ? { entity: { include_entities: this._candidates, multiple: false } }\n                : { entity: { domain: 'climate' } }\n            }\n            allow-custom-entity\n            @value-changed=${e => this._onEntity(e.detail.value)}\n          ></ha-selector>\n        </div>\n\n        <div class=\"input-group\">\n          <label>Climate Icon:</label>\n          <ha-icon-picker\n            .hass=${this.hass}\n            .value=${this._icon}\n            allow-custom-icon\n            @value-changed=${e => this._onIcon(e.detail.value)}\n          ></ha-icon-picker>\n        </div>\n\n        <button\n          class=\"reset-button\"\n          @click=${() =>\n            this.dispatchEvent(new CustomEvent('__panel_cmd__', {\n              detail: { cmd: 'reset', section: 'climate' },\n              bubbles: true, composed: true,\n            }))\n          }\n        >🧹 Reset Climate</button>\n      </ha-expansion-panel>\n    `;\n  }\n\n  _toggleAuto(on) {\n    if (this._syncingFromConfig) return;\n    this.dispatchEvent(new CustomEvent('panel-changed', {\n      detail: { prop: 'auto_discovery_sections.climate', val: on },\n      bubbles: true, composed: true,\n    }));\n  }\n\n  _onEntity(i, ent) {\n    const key = `camera${i+1}`;   // o climate${i+1} a seconda del pannello\n    this._entities[i] = ent || '';\n  \n    if (this._syncingFromConfig) return;\n  \n    // salva l’entità\n    this.dispatchEvent(new CustomEvent('panel-changed', {\n      detail: { prop: `entities.${key}.entity`, val: this._entities[i] },\n      bubbles: true, composed: true,\n    }));\n  \n    // se l’entità è stata svuotata → svuota anche l’icona\n    if (!this._entities[i]) {\n      this._icons[i] = '';\n      this.dispatchEvent(new CustomEvent('panel-changed', {\n        detail: { prop: `entities.${key}.icon`, val: '' },\n        bubbles: true, composed: true,\n      }));\n      return;\n    }\n  \n    // altrimenti calcola auto-icona come già fai\n    const st = this.hass?.states?.[this._entities[i]];\n    const iconFromState = st?.attributes?.icon;\n    const autoIco = iconFromState || resolveEntityIcon(this._entities[i], this.hass) || '';\n  \n    this._icons[i] = autoIco;\n    this.dispatchEvent(new CustomEvent('panel-changed', {\n      detail: { prop: `entities.${key}.icon`, val: autoIco },\n      bubbles: true, composed: true,\n    }));\n  }\n\n  _onIcon(icon) {\n    this._icon = icon || '';\n    if (this._syncingFromConfig) return;\n    this.dispatchEvent(new CustomEvent('panel-changed', {\n      detail: { prop: 'entities.climate.icon', val: this._icon },\n      bubbles: true, composed: true,\n    }));\n  }\n}\n\ncustomElements.define('climate-panel', ClimatePanel);\n","// src/bubble-room-editor.js\nimport { LitElement, html, css } from 'lit';\n\n// Pannelli\nimport './panels/RoomPanel.js';\nimport './panels/SensorPanel.js';\nimport './panels/MushroomPanel.js';\nimport './panels/SubButtonPanel.js';\nimport './panels/ColorPanel.js';\nimport './panels/CameraPanel.js';\nimport './panels/ClimatePanel.js';\n\n// Auto-discovery & reset helpers\nimport {\n  maybeAutoDiscover,\n  resetRoom, resetSensors, resetMushrooms, resetSubButtons,\n  resetClimate, resetCamera\n} from './helpers/auto-discovery.js';\n\nexport class BubbleRoomEditor extends LitElement {\n  static properties = {\n    hass:      { type: Object },\n    config:    { type: Object },\n    openPanel: { type: String, state: true },\n  };\n\n  constructor() {\n    super();\n    this.hass = undefined;\n    this.config = {};\n    this.openPanel = ''; // nessun pannello aperto di default\n\n    // bind espliciti\n    this._onPanelChanged  = this._onPanelChanged.bind(this);\n    this._onPanelCmd      = this._onPanelCmd.bind(this);\n    this._togglePanel     = this._togglePanel.bind(this);\n    this._onConfigChanged = this._onConfigChanged.bind(this);\n  }\n\n  // Lovelace chiama setConfig sull’editor: qui garantiamo sempre il type\n  setConfig(cfg) {\n    this.config = { type: cfg?.type || 'custom:bubble-room', ...(cfg || {}) };\n    this.requestUpdate();\n  }\n\n  set value(v) { this.config = v || {}; }\n  get value()  { return this.config; }\n\n  connectedCallback() {\n    super.connectedCallback();\n    this.addEventListener('panel-changed', this._onPanelChanged);\n    this.addEventListener('__panel_cmd__', this._onPanelCmd);\n  }\n  disconnectedCallback() {\n    this.removeEventListener('panel-changed', this._onPanelChanged);\n    this.removeEventListener('__panel_cmd__', this._onPanelCmd);\n    super.disconnectedCallback();\n  }\n\n  /* ============ utils config & dispatch ============ */\n\n  _emitConfig(next) {\n    // preserva/forza sempre il type della card (fix “Nessun tipo fornito”)\n    const withType = { type: this.config?.type || 'custom:bubble-room', ...(next || {}) };\n    this.config = withType;\n    this.dispatchEvent(new CustomEvent('config-changed', {\n      detail: { config: this.config },\n      bubbles: true, composed: true,\n    }));\n    this.requestUpdate();\n  }\n\n  /** Imposta un path puntato (es: \"entities.climate.icon\") e emette config-changed */\n  _setConfigValue(path, value) {\n    const keys = String(path).split('.');\n    const next = structuredClone(this.config || {});\n    let cur = next;\n    for (let i = 0; i < keys.length - 1; i++) {\n      const k = keys[i];\n      if (typeof cur[k] !== 'object' || cur[k] === null) cur[k] = {};\n      cur = cur[k];\n    }\n    cur[keys[keys.length - 1]] = value;\n    this._emitConfig(next);\n  }\n\n  /* ============ handlers eventi dai pannelli ============ */\n\n  /**\n   * Formato “nuovo” dei pannelli: detail { prop, val }\n   * Esempi:\n   *   prop: 'area', val: 'Soggiorno'\n   *   prop: 'auto_discovery_sections.climate', val: true\n   *   prop: 'entities.camera.icon', val: 'mdi:cctv'\n   */\n  _onPanelChanged(e) {\n    e.stopPropagation();\n    const { prop, val } = e.detail || {};\n    if (!prop) return;\n\n    // 1) applica il cambiamento\n    const prev = this.config;\n    const next = structuredClone(prev || {});\n    const parts = String(prop).split('.');\n    let cur = next;\n    for (let i = 0; i < parts.length - 1; i++) {\n      const k = parts[i];\n      if (typeof cur[k] !== 'object' || cur[k] === null) cur[k] = {};\n      cur = cur[k];\n    }\n    cur[parts[parts.length - 1]] = val;\n\n    // 2) autodiscovery se l'evento riguarda area o sezioni auto\n    const isArea = prop === 'area';\n    const isAD   = prop.startsWith('auto_discovery_sections.');\n    const applied = (isArea || isAD)\n      ? maybeAutoDiscover(this.hass, next, prop, false)\n      : next;\n\n    this._emitConfig(applied);\n  }\n\n  /**\n   * Alcuni pannelli legacy emettono detail { path, value }.\n   * Li normalizziamo a (prop,val).\n   */\n  _onConfigChanged(e) {\n    e.stopPropagation();\n    const { path, value } = e.detail || {};\n    if (!path) return;\n\n    // 1) applica\n    const prev = this.config;\n    const next = structuredClone(prev || {});\n    const parts = String(path).split('.');\n    let cur = next;\n    for (let i = 0; i < parts.length - 1; i++) {\n      const k = parts[i];\n      if (typeof cur[k] !== 'object' || cur[k] === null) cur[k] = {};\n      cur = cur[k];\n    }\n    cur[parts[parts.length - 1]] = value;\n\n    // 2) autodiscovery se area / sezioni\n    const isArea = path === 'area';\n    const isAD   = path.startsWith('auto_discovery_sections.');\n    const applied = (isArea || isAD)\n      ? maybeAutoDiscover(this.hass, next, path, false)\n      : next;\n\n    this._emitConfig(applied);\n  }\n\n  /**\n   * Reset centralizzati.\n   * I pannelli inviano: detail { cmd:'reset', section: 'room'|'sensors'|'mushrooms'|'subbuttons'|'climate'|'camera' }\n   */\n\n  _onPanelCmd(e) {\n    e.stopPropagation();\n    const { cmd, section } = e.detail || {};\n    if (cmd !== 'reset') return;\n\n    let next = this.config || {};\n\n    switch (section) {\n      case 'room':\n        next = resetRoom(next);\n        break;\n      case 'sensors':\n        next = resetSensors(next);\n        break;\n      case 'mushrooms':\n        next = resetMushrooms(next);\n        break;\n      case 'subbuttons':\n        next = resetSubButtons(next);\n        break;\n      case 'climate':\n        next = resetClimate(next);\n        break;\n      case 'camera':\n        next = resetCamera(next);\n        break;\n      default:\n        return;\n    }\n\n    // 🎯 Centralizza: se c’è almeno un toggle di autodiscovery attivo,\n    // riallinea TUTTE le sezioni abilitate in un colpo solo.\n    const ad = next?.auto_discovery_sections || {};\n    const anyAD =\n      ad.sensor || ad.mushroom || ad.subbutton || ad.presence ||\n      ad.climate || ad.camera;\n\n    if (anyAD) {\n      // Nota: passando `undefined` come path, l’helper applica l’AD\n      // a tutte le sezioni supportate e abilitate nei toggle.\n      next = maybeAutoDiscover(this.hass, next, undefined, false);\n      // In alternativa, se il tuo helper richiede un trigger “neutro”,\n      // usa: next = maybeAutoDiscover(this.hass, next, 'area', false);\n    }\n\n    this._emitConfig(next);\n  }\n\n\n  /**\n   * UI: apertura/chiusura dei pannelli (expansion)\n   * Usato da @expanded-changed dei pannelli figlio\n   */\n  _togglePanel(e, key) {\n    const opened = e?.detail?.expanded;\n    this.openPanel = opened ? key : '';\n  }\n\n  /* ============ UI ============ */\n\n  static styles = css`\n    :host { display:block; }\n    .editor-grid {\n      display:grid; gap: 16px;\n      grid-template-columns: 1fr;\n      align-items: start;\n    }\n  `;\n\n  render() {\n    const cfg = this.config || {};\n\n    return html`\n      <div class=\"editor-grid\">\n        <!-- ROOM -->\n        <room-panel\n          .hass=${this.hass}\n          .config=${cfg}\n          .expanded=${this.openPanel === 'room'}\n          @expanded-changed=${e => this._togglePanel(e, 'room')}\n          @panel-changed=${this._onPanelChanged}\n        ></room-panel>\n\n        <!-- CLIMATE -->\n        <climate-panel\n          .hass=${this.hass}\n          .config=${cfg}\n          .expanded=${this.openPanel === 'climate'}\n          @expanded-changed=${e => this._togglePanel(e, 'climate')}\n          @panel-changed=${this._onPanelChanged}\n        ></climate-panel>\n\n        <!-- CAMERA -->\n        <camera-panel\n          .hass=${this.hass}\n          .config=${cfg}\n          .expanded=${this.openPanel === 'camera'}\n          @expanded-changed=${e => this._togglePanel(e, 'camera')}\n          @panel-changed=${this._onPanelChanged}\n        ></camera-panel>\n\n        <!-- SENSOR -->\n        <sensor-panel\n          .hass=${this.hass}\n          .config=${cfg}\n          .expanded=${this.openPanel === 'sensor'}\n          @expanded-changed=${e => this._togglePanel(e, 'sensor')}\n          @panel-changed=${this._onPanelChanged}\n          @config-changed=${this._onConfigChanged}\n        ></sensor-panel>\n\n        <!-- MUSHROOM -->\n        <mushroom-panel\n          .hass=${this.hass}\n          .config=${cfg}\n          .expanded=${this.openPanel === 'mushroom'}\n          @expanded-changed=${e => this._togglePanel(e, 'mushroom')}\n          @panel-changed=${this._onPanelChanged}\n          @config-changed=${this._onConfigChanged}\n        ></mushroom-panel>\n\n        <!-- SUBBUTTON -->\n        <sub-button-panel\n          .hass=${this.hass}\n          .config=${cfg}\n          .expanded=${this.openPanel === 'subbuttons'}\n          @expanded-changed=${e => this._togglePanel(e, 'subbuttons')}\n          @panel-changed=${this._onPanelChanged}\n          @config-changed=${this._onConfigChanged}\n        ></sub-button-panel>\n\n        <!-- COLORS -->\n        <color-panel\n          .hass=${this.hass}\n          .config=${cfg}\n          .expanded=${this.openPanel === 'colors'}\n          @expanded-changed=${e => this._togglePanel(e, 'colors')}\n          @panel-changed=${this._onPanelChanged}\n          @config-changed=${this._onConfigChanged}\n        ></color-panel>\n      </div>\n    `;\n  }\n}\n\ncustomElements.define('bubble-room-editor', BubbleRoomEditor);","import { LitElement, html, css } from 'lit';\n\nexport class BubbleSubButton extends LitElement {\n  static properties = {\n    subbuttons: { type: Array },\n    preset: { type: String, reflect: true },\n  };\n\n  constructor() {\n    super();\n    this.subbuttons = [];\n    this.preset = 'liquid-glass';\n    this._holdThreshold = 500;\n    this._holdTimer = null;\n    this._holdFired = false;\n    this._currentIndex = -1;\n  }\n\n  static styles = css`\n    :host {\n      display: block;\n      height: 100%;\n      width: 100%;\n    }\n\n    .container {\n      display: flex;\n      flex-direction: column;\n      height: 100%;\n      width: 100%;\n      min-height: 0;\n      min-width: 0;\n      box-sizing: border-box;\n    }\n\n    :host([preset='standard']) .sub-button {\n      flex: 1 1 0%;\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      justify-content: center;\n      margin: 2px 0;\n      border-radius: 12px;\n      cursor: pointer;\n      transition: background 0.2s, transform 0.1s;\n      min-height: 0;\n    }\n\n    :host([preset='standard']) .sub-button:first-child {\n      margin-top: 0;\n    }\n\n    :host([preset='standard']) .sub-button:last-child {\n      margin-bottom: 0;\n    }\n\n    :host([preset='standard']) .sub-button:active {\n      transform: scale(0.97);\n    }\n\n    :host([preset='standard']) .sub-button ha-icon {\n      width: 80%;\n      height: 80%;\n    }\n\n    :host([preset='liquid-glass']) .sub-button {\n      flex: 1 1 0%;\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      justify-content: center;\n      position: relative;\n      overflow: hidden;\n      margin: 2px 0;\n      border-radius: 18px;\n      cursor: pointer;\n      min-height: 0;\n      color: var(--bubble-subbutton-color, #fff);\n      background:\n        radial-gradient(\n          140% 120% at 50% -20%,\n          var(--bubble-subbutton-glass-glow, rgba(255, 255, 255, 0.18)),\n          rgba(255, 255, 255, 0) 68%\n        ),\n        linear-gradient(\n          180deg,\n          var(--bubble-subbutton-glass-highlight, rgba(255, 255, 255, 0.08)) 0%,\n          rgba(var(--bubble-subbutton-tint, 255, 255, 255), 0.015) 52%,\n          rgba(var(--bubble-subbutton-tint, 255, 255, 255), 0.08) 100%\n        ),\n        linear-gradient(\n          150deg,\n          var(--bubble-subbutton-glass-soft, rgba(var(--bubble-subbutton-tint, 255, 255, 255), 0.028)) 0%,\n          rgba(var(--bubble-subbutton-tint, 255, 255, 255), 0) 58%\n        ),\n        var(--bubble-subbutton-glass-base, var(--bubble-subbutton-bg, rgba(255, 255, 255, 0.02)));\n      background-blend-mode: screen, normal, screen, normal;\n      box-shadow:\n        inset 0.5px 0.5px 1px rgba(255, 255, 255, 0.38),\n        inset -0.5px -0.5px 1px rgba(255, 255, 255, 0.06),\n        0 18px 32px var(--bubble-subbutton-glass-shadow, rgba(13, 22, 41, 0.12));\n      border: 2px solid var(--bubble-subbutton-border, currentColor);\n      backdrop-filter: blur(22px);\n      -webkit-backdrop-filter: blur(22px);\n      transition: background 0.35s ease, box-shadow 0.35s ease, transform 0.18s ease,\n        border-color 0.3s ease, filter 0.35s ease;\n      isolation: isolate;\n      filter:\n        saturate(var(--bubble-subbutton-saturation, 1))\n        brightness(var(--bubble-subbutton-luminance, 1));\n    }\n\n    :host([preset='liquid-glass']) .sub-button:first-child {\n      margin-top: 0;\n    }\n\n    :host([preset='liquid-glass']) .sub-button:last-child {\n      margin-bottom: 0;\n    }\n\n    :host([preset='liquid-glass']) .sub-button:active {\n      transform: scale(0.97);\n      box-shadow:\n        inset 0.5px 0.5px 1px rgba(255, 255, 255, 0.48),\n        inset -0.5px -0.5px 1.1px rgba(255, 255, 255, 0.12),\n        0 14px 26px var(--bubble-subbutton-glass-shadow-active, rgba(13, 22, 41, 0.17));\n      border-color: var(\n        --bubble-subbutton-border-active,\n        var(--bubble-subbutton-border-hover, var(--bubble-subbutton-border, currentColor))\n      );\n    }\n\n    :host([preset='liquid-glass']) .sub-button:hover {\n      box-shadow:\n        inset 0.5px 0.5px 1px rgba(255, 255, 255, 0.42),\n        inset -0.5px -0.5px 1px rgba(255, 255, 255, 0.1),\n        0 22px 38px var(--bubble-subbutton-glass-shadow-hover, rgba(13, 22, 41, 0.14));\n      border-color: var(\n        --bubble-subbutton-border-hover,\n        var(--bubble-subbutton-border, currentColor)\n      );\n    }\n\n    :host([preset='liquid-glass']) .sub-button::before,\n    :host([preset='liquid-glass']) .sub-button::after {\n      content: \"\";\n      position: absolute;\n      inset: 0;\n      pointer-events: none;\n      transition: opacity 0.35s ease;\n    }\n\n    :host([preset='liquid-glass']) .sub-button::before {\n      background:\n        linear-gradient(\n          135deg,\n          rgba(255, 255, 255, 0.42) 0%,\n          rgba(255, 255, 255, 0.18) 38%,\n          rgba(255, 255, 255, 0) 64%\n        ),\n        radial-gradient(\n          140% 120% at 50% -20%,\n          var(--bubble-subbutton-glass-sheen, rgba(255, 255, 255, 0.16)),\n          rgba(255, 255, 255, 0) 70%\n        );\n      opacity: 0.26;\n      mix-blend-mode: screen;\n      transform: translateY(-8%);\n    }\n\n    :host([preset='liquid-glass']) .sub-button::after {\n      border-radius: inherit;\n      border: 1px solid var(--bubble-subbutton-glass-rim, rgba(255, 255, 255, 0.32));\n      box-shadow:\n        inset 0 0 0 1px var(--bubble-subbutton-glass-rim-soft, rgba(255, 255, 255, 0.12)),\n        inset 0 -18px 32px -24px var(--bubble-subbutton-glass-rim-shadow, rgba(13, 22, 41, 0.24));\n      opacity: 0.38;\n      mix-blend-mode: screen;\n    }\n\n    :host([preset='liquid-glass']) .sub-button:hover::before {\n      opacity: 0.62;\n    }\n\n    :host([preset='liquid-glass']) .sub-button:hover::after {\n      opacity: 0.66;\n    }\n\n    :host([preset='liquid-glass']) .sub-button:active::after {\n      opacity: 0.78;\n    }\n\n    :host([preset='liquid-glass']) .sub-button ha-icon {\n      width: 80%;\n      height: 80%;\n      color: inherit;\n      filter:\n        drop-shadow(0 6px 12px rgba(var(--bubble-subbutton-glass-shadow-rgb, 13, 22, 41), 0.14))\n        brightness(var(--bubble-subbutton-icon-brightness, 1))\n        saturate(var(--bubble-subbutton-icon-saturation, 1));\n      transition: filter 0.35s ease, color 0.35s ease;\n    }\n\n    /* 👇 (Opzionale) Rende l'icona SVG responsiva */\n    ha-icon {\n      --mdc-icon-size: 100%;\n    }\n    \n    ha-icon svg {\n      width: 100%;\n      height: 100%;\n    }\n  `;\n  \n  render() {\n    return this.preset === 'standard'\n      ? this._renderStandard()\n      : this._renderLiquidGlass();\n  }\n\n  _renderStandard() {\n    return html`\n      <div class=\"container\">\n        ${this.subbuttons.map((btn, idx) => {\n          const bg = btn.active ? btn.colorOn : btn.colorOff;\n          const color = btn.active ? btn.iconOn : btn.iconOff;\n          return html`\n            <div\n              class=\"sub-button\"\n              style=\"background:${bg};color:${color};\"\n              @pointerdown=${() => this._onDown(idx)}\n              @pointerup=${() => this._onUp(idx)}\n              @pointerleave=${() => this._clearHoldTimer()}\n              @pointercancel=${() => this._clearHoldTimer()}\n            >\n              <ha-icon icon=\"${btn.icon}\"></ha-icon>\n            </div>\n          `;\n        })}\n      </div>\n    `;\n  }\n\n  _renderLiquidGlass() {\n    return html`\n      <div class=\"container\">\n        ${this.subbuttons.map((btn, idx) => {\n          const bg = btn.active ? btn.colorOn : btn.colorOff;\n          const color = btn.active ? btn.iconOn : btn.iconOff;\n          const glass = this._computeGlassColors(bg, btn.active);\n\n          const styleVars = [];\n\n          const iconTone = this._computeIconTone(color, btn.active);\n          if (iconTone) {\n            styleVars.push(`--bubble-subbutton-color:${iconTone}`);\n          }\n\n          if (glass) {\n            styleVars.push(`--bubble-subbutton-bg:${glass.surface}`);\n            styleVars.push(`--bubble-subbutton-glass-base:${glass.base}`);\n            styleVars.push(`--bubble-subbutton-glass-highlight:${glass.highlight}`);\n            styleVars.push(`--bubble-subbutton-glass-soft:${glass.soft}`);\n            styleVars.push(`--bubble-subbutton-glass-sheen:${glass.sheen}`);\n            styleVars.push(`--bubble-subbutton-glass-accent:${glass.accent}`);\n            styleVars.push(`--bubble-subbutton-tint:${glass.rgb}`);\n            styleVars.push(`--bubble-subbutton-glass-shadow:${glass.shadow}`);\n            styleVars.push(`--bubble-subbutton-glass-shadow-hover:${glass.shadowHover}`);\n            styleVars.push(`--bubble-subbutton-glass-shadow-active:${glass.shadowActive}`);\n            styleVars.push(`--bubble-subbutton-glass-shadow-rgb:${glass.shadowRgb}`);\n          } else if (bg) {\n            const brightened = btn.active ? this._lightenColor(bg, 0.35) : null;\n            styleVars.push(`--bubble-subbutton-bg:${brightened || bg}`);\n          }\n\n          const borderPalette = this._computeBorderColors(color, btn.active);\n          if (borderPalette) {\n            styleVars.push(`--bubble-subbutton-border:${borderPalette.base}`);\n            styleVars.push(`--bubble-subbutton-border-hover:${borderPalette.hover}`);\n            styleVars.push(`--bubble-subbutton-border-active:${borderPalette.active}`);\n          } else if (color) {\n            styleVars.push(`--bubble-subbutton-border:${color}`);\n            styleVars.push(`--bubble-subbutton-border-hover:${color}`);\n            styleVars.push(`--bubble-subbutton-border-active:${color}`);\n          }\n\n          const rimPalette = this._computeGlowPalette(color, btn.active);\n          if (rimPalette) {\n            styleVars.push(`--bubble-subbutton-glass-glow:${rimPalette.glow}`);\n            styleVars.push(`--bubble-subbutton-glass-rim:${rimPalette.rim}`);\n            styleVars.push(`--bubble-subbutton-glass-rim-soft:${rimPalette.rimSoft}`);\n            styleVars.push(`--bubble-subbutton-glass-rim-shadow:${rimPalette.rimShadow}`);\n          } else if (color) {\n            styleVars.push(`--bubble-subbutton-glass-glow:${color}`);\n            styleVars.push(`--bubble-subbutton-glass-rim:${color}`);\n            styleVars.push(`--bubble-subbutton-glass-rim-soft:${color}`);\n            styleVars.push(`--bubble-subbutton-glass-rim-shadow:${color}`);\n          }\n\n          if (btn.active) {\n            styleVars.push(`--bubble-subbutton-saturation:1.28`);\n            styleVars.push(`--bubble-subbutton-luminance:1.08`);\n            styleVars.push(`--bubble-subbutton-icon-brightness:1.4`);\n            styleVars.push(`--bubble-subbutton-icon-saturation:1.22`);\n          }\n\n          const styleAttr = styleVars.join(';');\n          const classes = ['sub-button'];\n          if (btn.active) classes.push('is-active');\n\n          return html`\n            <div\n              class=\"${classes.join(' ')}\"\n              style=\"${styleAttr}\"\n              @pointerdown=${() => this._onDown(idx)}\n              @pointerup=${() => this._onUp(idx)}\n              @pointerleave=${() => this._clearHoldTimer()}\n              @pointercancel=${() => this._clearHoldTimer()}\n            >\n              <ha-icon icon=\"${btn.icon}\"></ha-icon>\n            </div>\n          `;\n        })}\n      </div>\n    `;\n  }\n  \n  _onDown(idx) {\n    this._holdFired = false;\n    this._currentIndex = idx;\n    this._holdTimer = window.setTimeout(() => {\n      this._holdFired = true;\n      this._fireHassAction(idx, 'hold');\n    }, this._holdThreshold);\n  }\n  \n  _onUp(idx) {\n    this._clearHoldTimer();\n    if (!this._holdFired && this._currentIndex === idx) {\n      this._fireHassAction(idx, 'tap');\n    }\n  }\n  \n  _clearHoldTimer() {\n    if (this._holdTimer) {\n      clearTimeout(this._holdTimer);\n      this._holdTimer = null;\n    }\n  }\n\n  _lightenColor(color, weight = 0.3) {\n    const rgb = this._colorToRgb(color);\n    if (!rgb) return null;\n\n    const mixRatio = Math.min(Math.max(weight, 0), 1);\n    const mixed = this._mixWithWhite(rgb, mixRatio);\n    const alpha = typeof rgb.a === 'number' ? Math.min(Math.max(Number(rgb.a.toFixed(3)), 0), 1) : 1;\n\n    if (alpha < 1) {\n      return `rgba(${mixed.r}, ${mixed.g}, ${mixed.b}, ${alpha})`;\n    }\n\n    return `rgb(${mixed.r}, ${mixed.g}, ${mixed.b})`;\n  }\n\n  _computeGlassColors(color, isActive = false) {\n    const rgb = this._colorToRgb(color);\n    if (!rgb) return null;\n\n    const intensified = isActive ? this._boostColorIntensity(rgb, 0.42) : rgb;\n    const { r, g, b } = intensified;\n    const rgbString = `${r}, ${g}, ${b}`;\n    const softened = this._mixWithWhite(intensified, isActive ? 0.34 : 0.68);\n    const softenedString = `${softened.r}, ${softened.g}, ${softened.b}`;\n\n    const alphas = isActive\n      ? {\n          surface: 0.12,\n          base: 0.08,\n          highlight: 0.18,\n          soft: 0.1,\n          sheen: 0.28,\n          accent: 0.09,\n          border: 0.42,\n          borderHover: 0.52,\n          borderActive: 0.48,\n          shadow: 0.2,\n          shadowHover: 0.28,\n          shadowActive: 0.24,\n          glow: 0.5,\n          rim: 0.72,\n          rimSoft: 0.34,\n          rimShadow: 0.4,\n        }\n      : {\n          surface: 0.032,\n          base: 0.022,\n          highlight: 0.06,\n          soft: 0.028,\n          sheen: 0.12,\n          accent: 0.02,\n          border: 0.18,\n          borderHover: 0.26,\n          borderActive: 0.22,\n          shadow: 0.08,\n          shadowHover: 0.12,\n          shadowActive: 0.1,\n          glow: 0.2,\n          rim: 0.38,\n          rimSoft: 0.14,\n          rimShadow: 0.26,\n        };\n\n    const surface = `rgba(${softenedString}, ${alphas.surface})`;\n    const base = `rgba(${softenedString}, ${alphas.base})`;\n    const highlight = `rgba(${softenedString}, ${alphas.highlight})`;\n    const soft = `rgba(${softenedString}, ${alphas.soft})`;\n    const sheen = `rgba(${softenedString}, ${alphas.sheen})`;\n    const accent = `rgba(${softenedString}, ${alphas.accent})`;\n    const border = `rgba(${softenedString}, ${alphas.border})`;\n    const borderHover = `rgba(${softenedString}, ${alphas.borderHover})`;\n    const borderActive = `rgba(${softenedString}, ${alphas.borderActive})`;\n\n    const shadowFactor = 0.2;\n    const shadowR = Math.max(0, Math.round(r * shadowFactor));\n    const shadowG = Math.max(0, Math.round(g * shadowFactor));\n    const shadowB = Math.max(0, Math.round(b * shadowFactor));\n    const shadowRgb = `${shadowR}, ${shadowG}, ${shadowB}`;\n\n    const shadow = `rgba(${shadowRgb}, ${alphas.shadow})`;\n    const shadowHover = `rgba(${shadowRgb}, ${alphas.shadowHover})`;\n    const shadowActive = `rgba(${shadowRgb}, ${alphas.shadowActive})`;\n\n    const glow = `rgba(${softenedString}, ${alphas.glow})`;\n    const rim = `rgba(${softenedString}, ${alphas.rim})`;\n    const rimSoft = `rgba(${softenedString}, ${alphas.rimSoft})`;\n    const rimShadow = `rgba(${shadowRgb}, ${alphas.rimShadow})`;\n\n    return {\n      rgb: rgbString,\n      surface,\n      base,\n      highlight,\n      soft,\n      sheen,\n      accent,\n      shadow,\n      shadowHover,\n      shadowActive,\n      shadowRgb,\n      border,\n      borderHover,\n      borderActive,\n      glow,\n      rim,\n      rimSoft,\n      rimShadow,\n    };\n  }\n\n  _computeBorderColors(color, isActive = false) {\n    const rgb = this._colorToRgb(color);\n    if (!rgb) return null;\n\n    const baseAlpha = isActive ? 0.78 : 0.62;\n    const hoverAlpha = isActive ? 0.88 : 0.78;\n    const activeAlpha = isActive ? 0.82 : 0.7;\n\n    const base = `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, ${baseAlpha})`;\n    const hover = `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, ${hoverAlpha})`;\n    const active = `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, ${activeAlpha})`;\n\n    return { base, hover, active };\n  }\n\n  _computeGlowPalette(color, isActive = false) {\n    const rgb = this._colorToRgb(color);\n    if (!rgb) return null;\n\n    const intensified = isActive ? this._boostColorIntensity(rgb, 0.4) : rgb;\n    const softened = this._mixWithWhite(intensified, isActive ? 0.34 : 0.58);\n    const softenedString = `${softened.r}, ${softened.g}, ${softened.b}`;\n\n    const shadowFactor = 0.2;\n    const shadowR = Math.max(0, Math.round(intensified.r * shadowFactor));\n    const shadowG = Math.max(0, Math.round(intensified.g * shadowFactor));\n    const shadowB = Math.max(0, Math.round(intensified.b * shadowFactor));\n    const shadowRgb = `${shadowR}, ${shadowG}, ${shadowB}`;\n\n    return {\n      glow: `rgba(${softenedString}, ${isActive ? 0.55 : 0.3})`,\n      rim: `rgba(${softenedString}, ${isActive ? 0.74 : 0.48})`,\n      rimSoft: `rgba(${softenedString}, ${isActive ? 0.34 : 0.2})`,\n      rimShadow: `rgba(${shadowRgb}, ${isActive ? 0.42 : 0.26})`,\n    };\n  }\n\n  _computeIconTone(color, isActive = false) {\n    if (!color) return color;\n\n    const rgb = this._colorToRgb(color);\n    if (!rgb) return color;\n\n    if (!isActive) {\n      return this._rgbToCss({ r: rgb.r, g: rgb.g, b: rgb.b }, rgb.a);\n    }\n\n    const intensified = this._boostColorIntensity(rgb, 0.35);\n    const luminous = this._mixWithWhite(intensified, 0.2);\n    return this._rgbToCss(luminous, rgb.a);\n  }\n\n  _mixWithWhite({ r, g, b }, weight = 0.5) {\n    const ratio = Math.min(Math.max(weight, 0), 1);\n    const mix = value => Math.round(value + (255 - value) * ratio);\n    return {\n      r: mix(r),\n      g: mix(g),\n      b: mix(b),\n    };\n  }\n\n  _boostColorIntensity({ r, g, b, a }, amount = 0.18) {\n    const factor = 1 + Math.max(amount, 0);\n    const boost = value => Math.min(255, Math.round(value * factor));\n    const boosted = {\n      r: boost(r),\n      g: boost(g),\n      b: boost(b),\n    };\n\n    if (typeof a === 'number') {\n      boosted.a = a;\n    }\n\n    return boosted;\n  }\n\n  _rgbToCss({ r, g, b }, alpha = 1) {\n    const clampedAlpha = typeof alpha === 'number'\n      ? Math.min(Math.max(Number(alpha.toFixed(3)), 0), 1)\n      : 1;\n\n    if (clampedAlpha < 1) {\n      return `rgba(${r}, ${g}, ${b}, ${clampedAlpha})`;\n    }\n\n    return `rgb(${r}, ${g}, ${b})`;\n  }\n\n  _colorToRgb(color) {\n    if (!color || typeof color !== 'string' || color.startsWith('var(')) {\n      return null;\n    }\n\n    if (typeof document === 'undefined') {\n      return null;\n    }\n\n    if (!BubbleSubButton._colorCanvas) {\n      const canvas = document.createElement('canvas');\n      canvas.width = canvas.height = 1;\n      BubbleSubButton._colorCanvas = canvas;\n      BubbleSubButton._colorCtx = canvas.getContext('2d', { willReadFrequently: true }) || canvas.getContext('2d');\n    }\n\n    const ctx = BubbleSubButton._colorCtx;\n    if (!ctx) {\n      return null;\n    }\n\n    try {\n      ctx.fillStyle = '#000';\n      ctx.fillStyle = color;\n    } catch (err) {\n      return null;\n    }\n\n    const normalized = ctx.fillStyle;\n    ctx.clearRect(0, 0, 1, 1);\n    ctx.fillStyle = normalized;\n    ctx.fillRect(0, 0, 1, 1);\n\n    const data = ctx.getImageData(0, 0, 1, 1).data;\n    return {\n      r: data[0],\n      g: data[1],\n      b: data[2],\n      a: data[3] / 255,\n    };\n  }\n\n  _fireHassAction(idx, actionType) {\n    const cfg = this.subbuttons?.[idx];\n    if (!cfg || !cfg.entity_id) return;\n    \n    const actionConfig = {\n      entity: cfg.entity_id,\n      tap_action: cfg.tap_action || { action: 'toggle' },\n      hold_action: cfg.hold_action || { action: 'more-info' },\n    };\n    \n    const evt = new Event('hass-action', { bubbles: true, composed: true });\n    evt.detail = {\n      config: actionConfig,\n      action: actionType,\n    };\n    this.dispatchEvent(evt);\n  }\n}\n\nBubbleSubButton._colorCanvas = null;\nBubbleSubButton._colorCtx = null;\n\ncustomElements.define('bubble-subbutton', BubbleSubButton);\n","// src/components/BubbleName.js\nimport { LitElement, html, css } from 'lit';\n\nexport class BubbleName extends LitElement {\n  static properties = {\n    hass:      { type: Object },\n    name:      { type: String },\n    area:      { type: String },\n    config:    { type: Object },\n    container: { type: Object },\n\n    // Opzioni di fit\n    fitMode:   { type: String },   // 'height' | 'both'\n    stretchY:  { type: Number },   // es. 1.05 per allungare un 5%\n    preset:    { type: String, reflect: true },\n  };\n\n  constructor() {\n    super();\n    this.name = '';\n    this.fitMode = 'height'; // priorità all'altezza\n    this.stretchY = 1.12;       // nessuno stretch di default\n    this.preset = 'standard';\n    this._raf = null;\n    this._resizeObs = null;\n    this._lastScale = null;\n    this._lastBox = null;\n  }\n\n  // === Font loader: link Google Fonts nello shadow root ===\n  _ensureFonts() {\n    const root = this.renderRoot || this.shadowRoot;\n    if (!root) return;\n\n    // Evita di iniettare due volte\n    if (root.querySelector('link[data-bubble-fonts=\"1\"]')) return;\n\n    // Preconnect (opzionale, migliora tempo di caricamento)\n    const pre = document.createElement('link');\n    pre.rel = 'preconnect';\n    pre.href = 'https://fonts.gstatic.com';\n    pre.crossOrigin = 'anonymous';\n    pre.setAttribute('data-bubble-fonts', '1');\n    root.appendChild(pre);\n\n    const link = document.createElement('link');\n    link.rel = 'stylesheet';\n    link.href =\n      'https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Oswald:wght@400;700&family=Roboto+Condensed:wght@400;700&display=swap';\n    link.setAttribute('data-bubble-fonts', '1');\n\n    // Quando i font sono pronti, rifaccio lo scale\n    link.addEventListener('load', () => {\n      // Alcuni browser applicano i font con un frame di ritardo\n      requestAnimationFrame(() => this._scheduleScale());\n    });\n\n    root.appendChild(link);\n  }\n\n  firstUpdated() {\n    this._ensureFonts();\n    this._scheduleScale();\n\n    this._resizeObs = new ResizeObserver((entries) => {\n      const entry = entries[0];\n      let w = 0, h = 0;\n      if (entry?.contentBoxSize) {\n        const box = Array.isArray(entry.contentBoxSize)\n          ? entry.contentBoxSize[0]\n          : entry.contentBoxSize;\n        w = Math.round(box.inlineSize);\n        h = Math.round(box.blockSize);\n      } else {\n        const rect = this.getBoundingClientRect();\n        w = Math.round(rect.width);\n        h = Math.round(rect.height);\n      }\n      if (!this._lastBox || Math.abs(w - this._lastBox.w) > 2 || Math.abs(h - this._lastBox.h) > 2) {\n        this._lastBox = { w, h };\n        this._scheduleScale();\n      }\n    });\n    this._resizeObs.observe(this);\n\n    window.addEventListener('resize', this._scheduleScale, { passive: true });\n  }\n\n  updated(changed) {\n    if (changed.has('preset')) {\n      const desiredStretch = this.preset === 'liquid-glass' ? 1.32 : 1.12;\n      if (this.stretchY !== desiredStretch) {\n        this.stretchY = desiredStretch;\n      }\n    }\n\n    if (\n      changed.has('name') ||\n      changed.has('config') ||\n      changed.has('container') ||\n      changed.has('fitMode') ||\n      changed.has('stretchY') ||\n      changed.has('preset')\n    ) {\n      this._scheduleScale();\n    }\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback();\n    this._resizeObs?.disconnect();\n    window.removeEventListener('resize', this._scheduleScale);\n  }\n\n  _scheduleScale = () => {\n    if (this._raf) return;\n    this._raf = requestAnimationFrame(() => {\n      this._raf = null;\n      this._autoScaleFont();\n    });\n  };\n\n  _autoScaleFont() {\n    const el  = this.renderRoot.querySelector('.bubble-name');\n    const box = this.container || this.parentElement || this;\n    if (!el || !box) return;\n\n    const currentText = this.name ?? '';\n    const boxW = Math.max(0, Math.round(box.clientWidth));\n    const boxH = Math.max(0, Math.round(box.clientHeight));\n\n    if (\n      this._lastScale &&\n      this._lastScale.text === currentText &&\n      this._lastScale.w === boxW &&\n      this._lastScale.h === boxH &&\n      this._lastScale.fitMode === this.fitMode &&\n      this._lastScale.stretchY === this.stretchY\n    ) return;\n\n    // Evita callback del RO durante le misure\n    this._resizeObs.disconnect();\n\n    // Reset per misurazioni corrette\n    el.style.fontSize = '10px';\n    el.style.transform = 'none';\n\n    const MIN = 8;\n    const MAX = 240;\n    let targetPx;\n\n    if (this.fitMode === 'height') {\n      // 1) Fit per ALTEZZA (binary search)\n      let lo = MIN, hi = MAX;\n      for (let i = 0; i < 9 && lo <= hi; i++) {\n        const mid = (lo + hi) >> 1;\n        el.style.fontSize = `${mid}px`;\n        const okH = el.scrollHeight <= boxH;\n        if (okH) lo = mid + 1;\n        else     hi = mid - 1;\n      }\n      targetPx = Math.max(MIN, Math.min(MAX, hi));\n\n      // 2) Se la larghezza sfora, riduci proporzionalmente\n      el.style.fontSize = `${targetPx}px`;\n      const sw = el.scrollWidth;\n      if (sw > boxW && sw > 0) {\n        const factor = boxW / sw;\n        targetPx = Math.floor(targetPx * factor);\n      }\n    } else {\n      // Fit congiunto (altezza + larghezza)\n      let lo = MIN, hi = MAX;\n      for (let i = 0; i < 8 && lo <= hi; i++) {\n        const mid = (lo + hi) >> 1;\n        el.style.fontSize = `${mid}px`;\n        if (el.scrollWidth <= boxW && el.scrollHeight <= boxH) lo = mid + 1;\n        else hi = mid - 1;\n      }\n      targetPx = Math.max(MIN, Math.min(MAX, hi));\n    }\n\n    // Applica font-size finale\n    el.style.fontSize = `${targetPx}px`;\n\n    // Stretch verticale opzionale (riempie l’ultimo gap visivo)\n    if (this.stretchY && this.stretchY !== 1) {\n      el.style.transform = `scaleY(${this.stretchY})`;\n      el.style.transformOrigin = 'center';\n    } else {\n      el.style.transform = 'none';\n    }\n\n    this._lastScale = {\n      text: currentText, w: boxW, h: boxH,\n      fitMode: this.fitMode, stretchY: this.stretchY\n    };\n\n    // Riattiva observer\n    this._resizeObs.observe(this);\n  }\n\n  render() {\n    return html`\n      <div class=\"bubble-name\" title=\"${this.name || ''}\">\n        ${this.name}\n      </div>\n    `;\n  }\n\n  static styles = css`\n    :host { display: block; }\n\n    .bubble-name {\n      /* centratura e layout */\n      display: flex;\n      align-items: center;\n      justify-content: center;\n\n      width: 100%;\n      height: 100%;\n\n      /* leading serrato: riduce lo spazio sopra/sotto */\n      line-height: 0.95;\n\n      /* font stack “alto”: caricato automaticamente */\n      font-family:\n        \"Bebas Neue\",\n        \"Oswald\",\n        \"Roboto Condensed\",\n        \"Arial Narrow\",\n        Arial, sans-serif;\n\n      font-weight: 700;\n      letter-spacing: 0.01em;\n      font-stretch: condensed;\n\n      text-align: center;\n      white-space: nowrap;\n      text-transform: uppercase;\n      color: var(--bubble-room-name-color, white);\n\n      margin: 0;\n      padding: 0;\n\n      user-select: none;\n    }\n\n    :host([preset='liquid-glass']) .bubble-name {\n      font-family:\n        \"Bebas Neue\",\n        \"Roboto Condensed\",\n        \"Arial Narrow\",\n        Arial, sans-serif;\n      font-weight: 600;\n      letter-spacing: 0.08em;\n      line-height: 0.9;\n    }\n  `;\n}\n\ncustomElements.define('bubble-name', BubbleName);","// src/components/BubbleSensor.js\nimport { LitElement, html, css } from 'lit';\nimport { SENSOR_TYPE_MAP } from '../helpers/sensor-mapping.js';\n\nexport class BubbleSensor extends LitElement {\n  static properties = {\n    sensors: { type: Array },\n  };\n\n  constructor() {\n    super();\n    this.sensors = [];\n    this.rows = 1;\n    this.columns = 1;\n    this._resizeObserver = null;\n    this._resizeScheduled = false;\n    this._autoscaleScheduled = false;\n    this._lastBox = { w: 0, h: 0 };\n    this._pillCache = new WeakMap();\n    this._pendingChanged = null;\n\n    // profilo di font-size condiviso per gruppi di pill con stessa geometria\n    this._sharedSize = new Map(); // key -> { best, unit, label, icon }\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    this._updateLayout();\n    this._sharedSize.clear();\n    this._scheduleAutoscale();\n    this._resizeObserver = new ResizeObserver((entries) => {\n      const entry = entries[0];\n      let w = 0;\n      let h = 0;\n      if (entry && entry.contentBoxSize) {\n        const box = Array.isArray(entry.contentBoxSize)\n          ? entry.contentBoxSize[0]\n          : entry.contentBoxSize;\n        w = Math.round(box.inlineSize);\n        h = Math.round(box.blockSize);\n      } else {\n        const rect = this.getBoundingClientRect();\n        w = Math.round(rect.width);\n        h = Math.round(rect.height);\n      }\n      if (Math.abs(w - this._lastBox.w) > 2 || Math.abs(h - this._lastBox.h) > 2) {\n        this._lastBox = { w, h };\n        this._sharedSize.clear();\n        this._scheduleAutoscale();\n      }\n    });\n    this._resizeObserver.observe(this);\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback();\n    this._resizeObserver?.disconnect();\n    this._resizeObserver = null;\n  }\n\n  updated(changedProperties) {\n    if (changedProperties.has('sensors')) {\n      const prev = changedProperties.get('sensors') || [];\n      this._updateLayout();\n      this._sharedSize.clear();\n\n      const changedIdx = this._diffChangedSensorIndices(prev, this.sensors);\n      if (changedIdx.size === 0) return;\n\n      this._scheduleAutoscale(changedIdx);\n    }\n  }\n\n  _updateLayout() {\n    const count = this.sensors?.length || 0;\n    this.rows = count > 5 ? 2 : 1;\n    this.columns = count > 5 ? 5 : count || 1;\n  }\n\n  _scheduleAutoscale(changedIndices = null) {\n    if (this._autoscaleScheduled) {\n      this._pendingChanged = this._mergeChanged(this._pendingChanged, changedIndices);\n      return;\n    }\n    this._pendingChanged = this._mergeChanged(this._pendingChanged, changedIndices);\n    this._autoscaleScheduled = true;\n    requestAnimationFrame(() => {\n      this._autoscaleScheduled = false;\n      const payload = this._pendingChanged;\n      this._pendingChanged = null;\n      this._autoScaleValues(payload);\n    });\n  }\n\n  _mergeChanged(a, b) {\n    if (!a && !b) return null;\n    if (!a) return b instanceof Set ? new Set(b) : null;\n    if (!b) return a instanceof Set ? new Set(a) : null;\n    const out = new Set(a);\n    for (const v of b) out.add(v);\n    return out;\n  }\n\n  // ---------- Nuove utility per la taglia condivisa ----------\n  _keyForPill(pill) {\n    const w = Math.round(pill.clientWidth) || 0;\n    const h = Math.round(pill.clientHeight) || 0;\n    const hasUnit  = !!pill.querySelector('.sensor-unit')?.textContent?.trim();\n    const hasLabel = !!pill.querySelector('.sensor-label')?.textContent?.trim();\n    const hasIcon  = !!pill.querySelector('.sensor-icon');\n    return `${w}x${h}|u:${hasUnit?'1':'0'}|l:${hasLabel?'1':'0'}|i:${hasIcon?'1':'0'}`;\n  }\n\n  _textWeight(pill) {\n    const get = sel => pill.querySelector(sel)?.textContent ?? '';\n    const v = get('.sensor-value');\n    const u = get('.sensor-unit');\n    const l = get('.sensor-label');\n    return v.length + u.length * 0.8 + l.length * 1.1;\n  }\n\n  _measureAndApply(pill) {\n    this._fitValueAndUnit(pill);\n\n    const valueEl = pill.querySelector('.sensor-value');\n    const unitEl  = pill.querySelector('.sensor-unit');\n    const labelEl = pill.querySelector('.sensor-label');\n    const iconEl  = pill.querySelector('.sensor-icon');\n\n    const bestPx   = parseFloat(getComputedStyle(valueEl).fontSize) || 10;\n    const unitPx   = unitEl  ? parseFloat(getComputedStyle(unitEl).fontSize)   || Math.round(bestPx * 0.5) : 0;\n    const labelPx  = labelEl ? parseFloat(getComputedStyle(labelEl).fontSize) || Math.round(bestPx * 0.5) : 0;\n    const iconPx   = iconEl  ? parseFloat(getComputedStyle(iconEl).fontSize)  || Math.round(bestPx * 0.5) : 0;\n\n    return { best: bestPx, unit: unitPx, label: labelPx, icon: iconPx };\n  }\n\n  _applySharedSize(pill, shared) {\n    const valueEl = pill.querySelector('.sensor-value');\n    const unitEl  = pill.querySelector('.sensor-unit');\n    const labelEl = pill.querySelector('.sensor-label');\n    const iconEl  = pill.querySelector('.sensor-icon');\n    if (!valueEl) return;\n\n    valueEl.style.fontSize = `${shared.best}px`;\n    if (unitEl)  unitEl.style.fontSize  = `${shared.unit}px`;\n    if (labelEl) labelEl.style.fontSize = `${shared.label}px`;\n    if (iconEl)  iconEl.style.fontSize  = `${shared.icon}px`;\n\n    this._pillCache.set(pill, {\n      text: valueEl.textContent ?? '',\n      unitText: unitEl ? (unitEl.textContent ?? '') : '',\n      labelTxt: labelEl ? (labelEl.textContent ?? '') : '',\n      iconName: iconEl?.getAttribute('icon') || iconEl?.icon || '',\n      boxW: Math.round(pill.clientWidth),\n      boxH: Math.round(pill.clientHeight),\n      best: shared.best\n    });\n  }\n  // -----------------------------------------------------------\n\n  _autoScaleValues(changedIndices = null) {\n    const pills = this.renderRoot?.querySelectorAll('.sensor-pill');\n    if (!pills?.length) return;\n\n    const targetPills = changedIndices\n      ? Array.from(changedIndices).map(i => pills[i]).filter(Boolean)\n      : Array.from(pills);\n\n    if (!targetPills.length) return;\n\n    // Raggruppa per geometria e struttura\n    const groups = new Map();\n    for (const pill of targetPills) {\n      const key = this._keyForPill(pill);\n      if (!groups.has(key)) groups.set(key, []);\n      groups.get(key).push(pill);\n    }\n\n    // Per ogni gruppo: usa la taglia condivisa se esiste, altrimenti misura sul worst-case\n    for (const [key, group] of groups.entries()) {\n      const shared = this._sharedSize.get(key);\n      if (shared) {\n        for (const pill of group) this._applySharedSize(pill, shared);\n        continue;\n      }\n\n      // Scegli la pill con testo più \"pesante\"\n      let worst = group[0];\n      let worstScore = this._textWeight(worst);\n      for (let i = 1; i < group.length; i++) {\n        const s = this._textWeight(group[i]);\n        if (s > worstScore) {\n          worstScore = s;\n          worst = group[i];\n        }\n      }\n\n      const sharedComputed = this._measureAndApply(worst);\n      this._sharedSize.set(key, sharedComputed);\n      for (const pill of group) {\n        if (pill !== worst) this._applySharedSize(pill, sharedComputed);\n      }\n    }\n  }\n\n  _fitValueAndUnit(pill) {\n    const valueEl = pill.querySelector('.sensor-value');\n    const unitEl  = pill.querySelector('.sensor-unit');\n    const labelEl = pill.querySelector('.sensor-label');\n    const iconEl  = pill.querySelector('.sensor-icon');\n    if (!valueEl) return;\n\n    const text     = valueEl.textContent ?? '';\n    const unitText = unitEl ? (unitEl.textContent ?? '') : '';\n    const labelTxt = labelEl ? (labelEl.textContent ?? '') : '';\n    const iconName = iconEl?.getAttribute('icon') || iconEl?.icon || '';\n\n    const boxW = Math.round(pill.clientWidth);\n    const boxH = Math.round(pill.clientHeight);\n    if (boxW <= 0 || boxH <= 0) return;\n\n    const cacheKey = this._pillCache.get(pill);\n    if (cacheKey &&\n        cacheKey.text === text &&\n        cacheKey.unitText === unitText &&\n        cacheKey.labelTxt === labelTxt &&\n        cacheKey.iconName === iconName &&\n        cacheKey.boxW === boxW &&\n        cacheKey.boxH === boxH) {\n      return;\n    }\n\n    // niente padding né bordo: massimizziamo lo spazio interno\n    const PADDING_X = 0;\n    const PADDING_Y = 0;\n    const UNIT_ML   = 1; // lieve spazio tra valore e unità\n\n    valueEl.style.fontSize = '';\n    if (unitEl) unitEl.style.fontSize = '';\n    if (labelEl) labelEl.style.fontSize = '';\n    if (iconEl)  iconEl.style.fontSize  = '';\n\n    const maxWidth  = Math.max(0, boxW - PADDING_X);\n    const maxHeight = Math.max(0, boxH - PADDING_Y);\n    if (maxWidth === 0 || maxHeight === 0) return;\n\n    // abbassiamo i minimi e la taglia iniziale: emoji/icon più piccole\n    let lo = 5; // prima era 10\n    let hi = Math.min(40, maxHeight); // leggermente più compatto del 44\n    let best = lo;\n\n    // rapporti rivisti per avere emoji/unità un po' più piccole\n    const unitRatio  = 0.70;\n    const labelRatio = 0.70;\n    const iconRatio  = 0.70;\n\n    for (let i = 0; i < 8 && lo <= hi; i++) {\n      const mid = (lo + hi) >> 1;\n\n      valueEl.style.fontSize = `${mid}px`;\n      if (unitEl)  unitEl.style.fontSize  = `${Math.max(5, Math.round(mid * unitRatio))}px`;\n      if (labelEl) labelEl.style.fontSize = `${Math.max(5, Math.round(mid * labelRatio))}px`;\n      if (iconEl)  iconEl.style.fontSize  = `${Math.max(5, Math.round(mid * iconRatio))}px`;\n\n      const vW = valueEl.offsetWidth;\n      const vH = valueEl.offsetHeight;\n\n      const uW = unitEl ? unitEl.offsetWidth : 0;\n      const uH = unitEl ? unitEl.offsetHeight : 0;\n\n      const lW = labelEl ? labelEl.offsetWidth : 0;\n      const lH = labelEl ? labelEl.offsetHeight : 0;\n\n      const iW = iconEl ? iconEl.offsetWidth : 0;\n      const iH = iconEl ? iconEl.offsetHeight : 0;\n\n      const totalWidth  = (iW > 0 ? iW : 0) + lW + vW + (uW > 0 ? (UNIT_ML + uW) : 0);\n      const totalHeight = Math.max(iH, lH, vH, uH);\n\n      if (totalWidth <= maxWidth && totalHeight <= maxHeight) {\n        best = mid;\n        lo = mid + 1;\n      } else {\n        hi = mid - 1;\n      }\n    }\n\n    valueEl.style.fontSize = `${best}px`;\n    if (unitEl)  unitEl.style.fontSize  = `${Math.max(5, Math.round(best * unitRatio))}px`;\n    if (labelEl) labelEl.style.fontSize = `${Math.max(5, Math.round(best * labelRatio))}px`;\n    if (iconEl)  iconEl.style.fontSize  = `${Math.max(5, Math.round(best * iconRatio))}px`;\n\n    this._pillCache.set(pill, {\n      text, unitText, labelTxt, iconName, boxW, boxH, best\n    });\n  }\n\n  /** Helpers per confronto sensori */\n  _formatValueForCompare(value) {\n    if (value === null || value === undefined) return '--';\n  \n    // prova a estrarre un numero anche da stringhe tipo \"58,88 %\"\n    let n = null;\n    if (typeof value === 'number') {\n      n = value;\n    } else if (typeof value === 'string') {\n      const m = value.replace(',', '.').match(/-?\\d+(?:\\.\\d+)?/);\n      if (m) n = Number(m[0]);\n    }\n  \n    if (Number.isFinite(n)) {\n      // SOLO quando serve: intero → \"58\", altrimenti → \"58.9\"\n      return Number.isInteger(n) ? String(n) : n.toFixed(1);\n    }\n  \n    // fallback non numerico\n    return String(value).trim().replace(/\\s+/g, ' ');\n  }\n  \n  _formatValueForDisplay(value, decimals = 1, trimIntegers = true) {\n    if (value === null || value === undefined) return '--';\n  \n    if (typeof value === 'number' && Number.isFinite(value)) {\n      return (trimIntegers && Number.isInteger(value))\n        ? String(value)\n        : value.toFixed(decimals);\n    }\n  \n    if (typeof value === 'string') {\n      const m = value.replace(',', '.').match(/-?\\d+(?:\\.\\d+)?/);\n      if (m) {\n        const n = Number(m[0]);\n        if (Number.isFinite(n)) {\n          return (trimIntegers && Number.isInteger(n))\n            ? String(n)\n            : n.toFixed(decimals);\n        }\n      }\n      return value.trim();\n    }\n  \n    return String(value);\n  }\n  \n  \n\n  _getSensorKey(sensor, index) {\n    return sensor?.entity || sensor?.entity_id || `idx:${index}`;\n  }\n\n  _diffChangedSensorIndices(prev = [], next = []) {\n    const changed = new Set();\n\n    if ((prev?.length || 0) !== (next?.length || 0)) {\n      for (let i = 0; i < (next?.length || 0); i++) changed.add(i);\n      return changed;\n    }\n\n    const nextIndexByKey = new Map(next.map((s, i) => [this._getSensorKey(s, i), i]));\n\n    prev.forEach((prevSensor, prevIndex) => {\n      const key = this._getSensorKey(prevSensor, prevIndex);\n      const i = nextIndexByKey.get(key);\n      if (i === undefined) {\n        if (prevIndex < next.length) changed.add(prevIndex);\n        return;\n      }\n\n      const cur = next[i];\n\n      const prevText = [\n        prevSensor?.label ?? '',\n        this._formatValueForCompare(prevSensor?.value),\n        prevSensor?.unit ?? ''\n      ].join('|');\n\n      const nextText = [\n        cur?.label ?? '',\n        this._formatValueForCompare(cur?.value),\n        cur?.unit ?? ''\n      ].join('|');\n\n      const prevIcon  = prevSensor?.icon ?? '';\n      const nextIcon  = cur?.icon ?? '';\n      const prevDev   = prevSensor?.device_class ?? '';\n      const nextDev   = cur?.device_class ?? '';\n      const prevColor = prevSensor?.color ?? '';\n      const nextColor = cur?.color ?? '';\n\n      const textChanged  = prevText !== nextText;\n      const iconChanged  = prevIcon !== nextIcon;\n      const devChanged   = prevDev !== nextDev;\n      const colorChanged = prevColor !== nextColor;\n\n      if (textChanged || iconChanged || devChanged || colorChanged) {\n        changed.add(i);\n      }\n    });\n\n    return changed;\n  }\n\n  _openMoreInfo(entityId) {\n    if (!entityId || typeof entityId !== 'string') return;\n    const ev = new CustomEvent('hass-more-info', {\n      bubbles: true,\n      composed: true,\n      detail: { entityId },\n    });\n    const ha = document.querySelector('home-assistant');\n    (ha || this).dispatchEvent(ev);\n  }\n\n  static styles = css`\n    :host {\n      display: block;\n      height: 100%;\n      width: 100%;\n      box-sizing: border-box;\n      contain: strict;\n    }\n    .sensor-grid {\n      display: grid;\n      width: 100%;\n      height: 100%;\n      box-sizing: border-box;\n      padding: 0;\n      margin: 0;\n      gap: 0;                /* nessuno spazio tra le celle */\n    }\n    .sensor-pill {\n      display: flex;\n      align-items: center;\n      background: transparent;  /* niente sfondo */\n      border: 0;                /* niente bordo */\n      border-radius: 0;         /* niente raggio, si toccano */\n      font-size: 1em;\n      font-family: \"Bebas Neue\", \"Arial Narrow\", sans-serif;\n      font-weight: 700;\n      color: #e3f6ff;\n      box-sizing: border-box;\n      width: 100%;\n      height: 100%;\n      contain: strict;\n      cursor: pointer;\n      padding: 0;     \n      justify-content: center;  \n      text-align: center;         \n    }\n    .sensor-label {\n      font-weight: 600;\n      font-size: 0.5em;           /* sarà scalata via JS */\n      line-height: 1;\n      display: inline-block;\n      flex: 0 0 auto;\n    }\n    .sensor-value {\n      font-weight: 700;\n      font-variant-numeric: tabular-nums;\n      letter-spacing: 0.01em;\n      line-height: 1;\n      flex: 0 0 auto;\n    }\n    .sensor-unit {\n      font-weight: 600;\n      white-space: nowrap;\n      overflow: hidden;\n      text-overflow: ellipsis;\n      line-height: 1;\n      margin-left: 1px;         /* separa valore e unità */\n      flex: 0 0 auto;\n      opacity: 1;               /* assicurati sia visibile */\n    }\n  `;\n\n  render() {\n    const sensors = (this.sensors || []).map(sensor => {\n      const devClass = sensor.device_class;\n      const map = SENSOR_TYPE_MAP[devClass] || {};\n      const emoji = map.emoji || '❓';\n      const unit  = sensor.unit || map.units?.[0] || '';\n    \n      // Mostra 1 decimale SOLO se non è intero\n      const value = this._formatValueForDisplay(sensor.value, 1, true);\n    \n      return { ...sensor, value, label: emoji, unit };\n    });\n    \n\n    return html`\n      <div\n        class=\"sensor-grid\"\n        style=\"\n          grid-template-columns: repeat(${this.columns}, 1fr);\n          grid-template-rows: repeat(${this.rows}, 1fr);\n        \"\n      >\n        ${sensors.map(sensor => {\n          const entityId = sensor.entity || sensor.entity_id || '';\n          const title = entityId\n            ? `Show history graph: ${entityId}`\n            : 'Show history graph';\n\n          return html`\n            <div\n              class=\"sensor-pill\"\n              style=\"color:${sensor.color || '#e3f6ff'}\"\n              title=\"${title}\"\n              role=\"button\"\n              tabindex=\"0\"\n              @click=${() => this._openMoreInfo(entityId)}\n              @keydown=${(e) => { if (e.key === 'Enter' || e.key === ' ') this._openMoreInfo(entityId); }}\n            >\n              <ha-icon class=\"sensor-icon\" .icon=\"${sensor.icon || ''}\"></ha-icon>\n              <span class=\"sensor-label\">${sensor.label || ''}</span>\n              <span class=\"sensor-value\">${sensor.value ?? '--'}</span>\n              <span class=\"sensor-unit\">${sensor.unit || ''}</span>\n            </div>\n          `;\n        })}\n      </div>\n    `;\n  }\n}\n\ncustomElements.define('bubble-sensor', BubbleSensor);","// src/components/BubbleMushroom.js\nimport { LitElement, html, css } from 'lit';\nimport { resolveEntityIcon } from '../helpers/icon-mapping.js';\n\n\nexport class BubbleMushroom extends LitElement {\n  static properties = {\n    // Array: { entity_id, icon, color, dx?, dy?, tap_action?, hold_action?, double_tap_action? }\n    entities: { type: Array },\n  };\n\n  // BubbleMushroom.js\n  constructor() {\n    super();\n    this.entities = [];\n    this._containerSize = { width: 0, height: 0 };\n    this._rafSize = null;\n    this._ro = new ResizeObserver((entries) => {\n      const cr = entries[0]?.contentRect;\n      if (!cr) return;\n      // throttle ad un frame\n      if (this._rafSize) cancelAnimationFrame(this._rafSize);\n      this._rafSize = requestAnimationFrame(() => {\n        const w = Math.round(cr.width);\n        const h = Math.round(cr.height);\n        if (w !== this._containerSize.width || h !== this._containerSize.height) {\n          this._containerSize = { width: w, height: h };\n          this.requestUpdate();\n        }\n      });\n    });\n\n    // === GESTURE STATE (tap/hold/double_tap) ===\n    this._holdThreshold = 500; // ms\n    this._holdTimer = null;\n    this._holdFired = false;\n    this._lastTapTs = 0; // per double tap\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    this._ro.observe(this);\n  }\n  disconnectedCallback() {\n    this._ro.disconnect();\n    super.disconnectedCallback();\n  }\n\n  _updateSize() {\n    const r = this.getBoundingClientRect();\n    this._containerSize = { width: r.width, height: r.height };\n    this.requestUpdate();\n  }\n\n  // LEGACY: rimane per retrocompatibilità (ora usiamo pointer events)\n  _handleClick(entity) {\n    this.dispatchEvent(new CustomEvent('hass-action', {\n      detail: {\n        config: {\n          entity: entity.entity_id,\n          tap_action:  entity.tap_action  || { action: 'toggle' },\n          hold_action: entity.hold_action || { action: 'more-info' },\n        },\n        action: 'tap',\n      },\n      bubbles: true,\n      composed: true,\n    }));\n  }\n\n  // === NUOVO: invio unificato dell'azione come fanno i SubButton ===\n  _dispatchAction(entity, which) {\n    const id = entity.entity_id || entity.entity || entity;\n    const cfg = {\n      entity: id,\n      tap_action: entity.tap_action || { action: 'toggle' },\n      hold_action: entity.hold_action || { action: 'more-info' },\n      double_tap_action: entity.double_tap_action,\n    };\n    this.dispatchEvent(new CustomEvent('hass-action', {\n      detail: { config: cfg, action: which },\n      bubbles: true,\n      composed: true,\n    }));\n  }\n\n  _onPointerDown(ev, entity) {\n    ev.preventDefault();\n    this._holdFired = false;\n    clearTimeout(this._holdTimer);\n    this._holdTimer = setTimeout(() => {\n      this._holdFired = true;\n      this._dispatchAction(entity, 'hold');\n    }, this._holdThreshold);\n  }\n\n  _onPointerUp(ev, entity) {\n    ev.preventDefault();\n    clearTimeout(this._holdTimer);\n\n    // se è già partito l'hold, non fare altro\n    if (this._holdFired) {\n      this._holdFired = false;\n      return;\n    }\n\n    // double tap opzionale\n    const now = Date.now();\n    if (entity?.double_tap_action && (now - this._lastTapTs) < 300) {\n      this._lastTapTs = 0;\n      this._dispatchAction(entity, 'double_tap');\n      return;\n    }\n\n    // tap (piccolo delay per dare priorità al double tap)\n    this._lastTapTs = now;\n    setTimeout(() => {\n      if (Date.now() - this._lastTapTs >= 280) {\n        this._dispatchAction(entity, 'tap');\n      }\n    }, 280);\n  }\n\n  _onPointerCancel() {\n    clearTimeout(this._holdTimer);\n    this._holdFired = false;\n  }\n\n  static styles = css`\n    :host {\n      display: block;\n      width: 100%;\n      height: 100%;\n      position: absolute;\n      inset: 0;\n      contain: strict;\n      z-index: 3;\n      pointer-events: none;\n    }\n    .mushroom-entity {\n      position: absolute;\n      transform: translate(-50%, -50%);\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      z-index: 3;\n      pointer-events: auto;\n    }\n    .mushroom-entity ha-icon { display: block; }\n  `;\n\n  render() {\n    const { width, height } = this._containerSize;\n    if (!width || !height) return html``;\n\n    // dimensione dinamica (mobile -> desktop)\n    const vpWidth  = window.innerWidth || width;\n    const kMobile  = 0.55;\n    const kDesktop = 0.25;\n    const wMobile  = 100;\n    const wDesktop = 200;\n\n    let k;\n    if (vpWidth <= wMobile)        k = kMobile;\n    else if (vpWidth >= wDesktop)  k = kDesktop;\n    else {\n      const t = (vpWidth - wMobile) / (wDesktop - wMobile);\n      k = kMobile + (kDesktop - kMobile) * t;\n    }\n\n    // lato effettivo per non “allargare” troppo\n    const Rmax  = 1.6;\n    const sideW = Math.min(width, height * Rmax);\n    const side  = 0.5 * (height + sideW);\n    const size  = side * k; // diametro standard bolla\n\n    // ellisse (border-radius: 0 60% 60% 0) con clamping\n    const rxRaw  = width  * 0.60;\n    const ryRaw  = height * 0.60;\n    const scaleH = Math.min(1, width  / (rxRaw * 2));\n    const scaleV = Math.min(1, height / (ryRaw * 2));\n    const rX     = rxRaw * scaleH;\n    const rY     = ryRaw * scaleV;\n    const cX     = width - rX;\n    const cY     = height * 0.5;\n\n    const touchPad = 1; // 0 = a filo\n\n    // raggi per il contatto (centro bolla che “tocca” il bordo)\n    const rArcX = Math.max(0, rX - (size / 2) - touchPad);\n    const rArcY = Math.max(0, rY - (size / 2) - touchPad);\n\n    const deg = (d) => (Math.PI * d) / 180;\n\n    // angoli\n    const a30   = deg(30);\n    const aFlat = deg(85); // più grande = più a destra lungo la curva\n\n    // #1: appoggiata in alto-sinistra (dentro lo sfondo)\n    const contactX = (size / 2) + touchPad;\n    const contactY = (size / 2) + touchPad;\n\n    // scale per elementi speciali\n    const cameraScale  = 0.75;            // camera\n    const climateScale = 0.75;            // climate\n    const dCam = size * cameraScale;      // diametro camera\n    const dCli = size * climateScale;     // diametro climate\n\n    // POSIZIONI 1..5 per i mushroom “normali” (come nel codice originale)\n    const positionsGeneric = [\n      // 1 — alto-sinistra, dentro lo sfondo\n      { x: contactX, y: contactY },\n\n      // 2 — arco alto, vicino all'inizio curvatura (sposta con aFlat)\n      { x: cX + rArcX * Math.cos(-aFlat), y: cY + rArcY * Math.sin(-aFlat) },\n\n      // 3 — arco alto-destra\n      { x: cX + rArcX * Math.cos(-a30),   y: cY + rArcY * Math.sin(-a30)   },\n\n      // 4 — arco basso-destra\n      { x: cX + rArcX * Math.cos(+a30),   y: cY + rArcY * Math.sin(+a30)   },\n\n      // 5 — arco basso, vicino all'inizio curvatura\n      { x: cX + rArcX * Math.cos(+aFlat), y: cY + rArcY * Math.sin(+aFlat) },\n    ];\n\n    // indice locale per assegnare slot ai “generici”\n    let genIdx = 0;\n\n    return html`\n      ${this.entities.map((e) => {\n        const isCam = e?.kind === 'camera';\n        const isCli = e?.kind === 'climate';\n\n        // diametro per-ENTITÀ: camera/climate più piccoli (come prima)\n        const d = isCam ? dCam : (isCli ? dCli : size);\n        const iconSize = d * 0.95;\n\n        // === POSIZIONI: camera/climate esattamente come nel codice che hai incollato ===\n        // camera: { x: width - (dCam / 2), y: (dCam / 2) }\n        // climate: { x: (dCli / 2) + touchPad, y: height - (dCli / 2) - touchPad }\n        let base;\n        if (isCam) {\n          base = { x: (width - (d / 2)), y: (d / 2) }; // alto-destra, come prima (nessun margine extra)\n        } else if (isCli) {\n          base = { x: ((d / 2) + touchPad), y: (height - (d / 2) - touchPad) }; // basso-sinistra, come prima\n        } else {\n          base = positionsGeneric[Math.min(genIdx, positionsGeneric.length - 1)] ?? { x: cX, y: cY };\n          genIdx++;\n        }\n\n        // micro-shift solo per entità generiche; camera/climate ignorano dx/dy\n        const useDx = (isCam || isCli) ? 0 : (e.dx ?? 0);\n        const useDy = (isCam || isCli) ? 0 : (e.dy ?? 0);\n        const left = base.x + useDx;\n        const top  = base.y + useDy;\n\n        return html`\n          <div\n            class=\"mushroom-entity\"\n            style=\"\n              left:${left}px;\n              top:${top}px;\n              width:${d}px;\n              height:${d}px;\n              color:${e.color};\n            \"\n            @pointerdown=${(ev) => this._onPointerDown(ev, e)}\n            @pointerup=${(ev) => this._onPointerUp(ev, e)}\n            @pointercancel=${this._onPointerCancel}\n            @pointerleave=${this._onPointerCancel}\n            @contextmenu=${(ev) => ev.preventDefault()}\n          >\n            <ha-icon icon=\"${e.icon || resolveEntityIcon(e.entity_id, this.hass)}\" style=\"--mdc-icon-size:${iconSize}px;\"></ha-icon>\n          </div>\n        `;\n      })}\n    `;\n  }\n}\n\ncustomElements.define('bubble-mushroom', BubbleMushroom);","// src/elements/BubbleIcon.js\nimport { LitElement, html, css } from 'lit';\n\nexport class BubbleIcon extends LitElement {\n  static properties = {\n    // presentazione/stato\n    icon: { type: String },\n    active: { type: Boolean },\n    colorActive: { type: String },\n    colorInactive: { type: String },\n    backgroundActive: { type: String },\n    backgroundInactive: { type: String },\n    preset: { type: String, reflect: true },\n    \n    // azioni/contesto (stessa logica di BubbleSubButton)\n    entity_id: { type: String },\n    tap_action: { type: Object },\n    hold_action: { type: Object },\n  };\n  \n  constructor() {\n    super();\n    // UI\n    this.icon = '';\n    this.active = false;\n    this.colorActive = '#21df73';\n    this.colorInactive = '#173c16';\n    this.backgroundActive = 'rgba(33,223,115,0.1)';\n    this.backgroundInactive = 'rgba(23,60,22,0.1)';\n    this.preset = 'standard';\n    \n    // Azioni (default coerenti con SubButton)\n    this.entity_id = '';\n    this.tap_action = { action: 'more-info' };\n    this.hold_action = { action: 'none' };\n    \n    // Gestione hold come SubButton\n    this._holdThreshold = 500; // ms\n    this._holdTimer = null;\n    this._holdFired = false;\n  }\n  \n  static styles = css`\n    :host {\n      position: absolute;\n      display: block;\n      inset: 0;\n      box-sizing: border-box;\n      z-index: 1;\n    }\n    .container {\n      box-sizing: border-box;\n      border-radius: var(--bubble-main-icon-border-radius, 0 70% 70% 0);\n      display: flex;\n      width: 100%;\n      height: 100%;\n      justify-content: center;\n      align-items: center;\n      cursor: pointer;\n      user-select: none;\n      -webkit-user-select: none;\n      transition: background 0.2s, transform 0.1s;\n      position: relative;\n      overflow: hidden;\n      background: var(--bubble-main-icon-bg, transparent);\n    }\n    .container:active .icon {\n      transform: scale(0.98);\n    }\n    .icon {\n      --mdc-icon-size: var(--main-icon-size, 160px);\n      width: var(--mdc-icon-size);\n      height: var(--mdc-icon-size);\n      transform: translateX(var(--icon-shift-x, -20%));\n      transition: transform .18s ease, opacity .18s ease;\n    }\n\n    :host([preset='liquid-glass']) .container {\n      color: var(--bubble-main-icon-color, currentColor);\n      border: none;\n      background:\n        radial-gradient(\n          140% 120% at 50% -20%,\n          var(--bubble-main-icon-glass-glow, rgba(255, 255, 255, 0.18)),\n          rgba(255, 255, 255, 0) 72%\n        ),\n        linear-gradient(\n          180deg,\n          var(--bubble-main-icon-glass-highlight, rgba(255, 255, 255, 0.08)) 0%,\n          rgba(var(--bubble-main-icon-tint, 255, 255, 255), 0.015) 52%,\n          rgba(var(--bubble-main-icon-tint, 255, 255, 255), 0.08) 100%\n        ),\n        linear-gradient(\n          150deg,\n          var(--bubble-main-icon-glass-soft, rgba(var(--bubble-main-icon-tint, 255, 255, 255), 0.028)) 0%,\n          rgba(var(--bubble-main-icon-tint, 255, 255, 255), 0) 58%\n        ),\n        var(--bubble-main-icon-bg, rgba(255, 255, 255, 0.02));\n      background-blend-mode: screen, normal, screen, normal;\n      box-shadow:\n        inset 0.5px 0.5px 1px rgba(255, 255, 255, 0.38),\n        inset -0.5px -0.5px 1.1px rgba(255, 255, 255, 0.1),\n        0 28px 54px var(--bubble-main-icon-glass-shadow, rgba(13, 22, 41, 0.18));\n      backdrop-filter: blur(28px);\n      -webkit-backdrop-filter: blur(28px);\n      transition: background 0.35s ease, box-shadow 0.35s ease, filter 0.35s ease;\n      filter:\n        saturate(var(--bubble-main-icon-saturation, 1))\n        brightness(var(--bubble-main-icon-luminance, 1));\n      isolation: isolate;\n    }\n\n    :host([preset='liquid-glass']) .container::before,\n    :host([preset='liquid-glass']) .container::after {\n      content: \"\";\n      position: absolute;\n      inset: 0;\n      pointer-events: none;\n      transition: opacity 0.35s ease;\n    }\n\n    :host([preset='liquid-glass']) .container::before {\n      background:\n        linear-gradient(\n          140deg,\n          rgba(255, 255, 255, 0.34) 0%,\n          rgba(255, 255, 255, 0.16) 42%,\n          rgba(255, 255, 255, 0) 70%\n        ),\n        radial-gradient(\n          130% 120% at 50% -20%,\n          var(--bubble-main-icon-glass-sheen, rgba(255, 255, 255, 0.18)),\n          rgba(255, 255, 255, 0) 68%\n        );\n      opacity: 0.26;\n      mix-blend-mode: screen;\n      transform: translateY(-8%);\n    }\n\n    :host([preset='liquid-glass']) .container::after {\n      border-radius: inherit;\n      border: 1px solid var(--bubble-main-icon-glass-rim, rgba(255, 255, 255, 0.32));\n      box-shadow:\n        inset 0 0 0 1px var(--bubble-main-icon-glass-rim-soft, rgba(255, 255, 255, 0.12)),\n        inset 0 -18px 32px -24px var(--bubble-main-icon-glass-rim-shadow, rgba(13, 22, 41, 0.24));\n      opacity: 0.4;\n      mix-blend-mode: screen;\n    }\n\n    :host([preset='liquid-glass']) .container:hover::before {\n      opacity: 0.6;\n    }\n\n    :host([preset='liquid-glass']) .container:hover::after {\n      opacity: 0.68;\n    }\n\n    :host([preset='liquid-glass']) .container:active {\n      box-shadow:\n        inset 0.5px 0.5px 1px rgba(255, 255, 255, 0.44),\n        inset -0.5px -0.5px 1.2px rgba(255, 255, 255, 0.16),\n        0 24px 46px var(--bubble-main-icon-glass-shadow-active, rgba(13, 22, 41, 0.22));\n      border: none;\n    }\n\n    :host([preset='liquid-glass']) .container:hover {\n      border: none;\n    }\n\n    :host([preset='liquid-glass']) .icon {\n      filter:\n        drop-shadow(0 16px 32px rgba(var(--bubble-main-icon-shadow-rgb, 13, 22, 41), 0.2))\n        brightness(var(--bubble-main-icon-icon-brightness, 1))\n        saturate(var(--bubble-main-icon-icon-saturation, 1));\n      transition: filter 0.35s ease, opacity 0.18s ease, transform 0.18s ease;\n    }\n  `;\n  \n  render() {\n    const fg = this.active ? this.colorActive : this.colorInactive;\n    const rawBg = this.active ? this.backgroundActive : this.backgroundInactive;\n    const isLiquid = this.preset === 'liquid-glass';\n    const bg = this._withOpacity(rawBg, isLiquid ? 0.22 : 0.1) ?? rawBg;\n    const iconOpacity = this.active ? 0.9 : 0.8;\n\n    const styleChunks = [];\n    if (bg) {\n      styleChunks.push(`--bubble-main-icon-bg:${bg}`);\n    }\n    if (fg) {\n      styleChunks.push(`color:${fg}`);\n      if (!isLiquid) {\n        styleChunks.push(`--bubble-main-icon-border:${fg}`);\n      }\n      styleChunks.push(`--bubble-main-icon-color:${fg}`);\n    }\n\n    const containerStyle = styleChunks.map(chunk => `${chunk};`).join(' ');\n\n    return html`\n      <div\n        class=\"container\"\n        style=\"${containerStyle}\"\n        @pointerdown=${this._onDown}\n        @pointerup=${this._onUp}\n        @pointerleave=${this._clearHoldTimer}\n        @pointercancel=${this._clearHoldTimer}\n      >\n        <ha-icon\n          class=\"icon\"\n          icon=\"${this.icon || 'mdi:checkbox-blank-circle-outline'}\"\n          style=\"color:${fg};opacity:${iconOpacity}\"\n        ></ha-icon>\n      </div>\n    `;\n  }\n\n  _withOpacity(color, alpha) {\n    const parsed = BubbleIcon._parseColor(color);\n    if (!parsed) return null;\n    const { r, g, b } = parsed;\n    return `rgba(${r}, ${g}, ${b}, ${alpha})`;\n  }\n\n  static _parseColor(color) {\n    if (!color || typeof color !== 'string' || color.startsWith('var(')) {\n      return null;\n    }\n\n    if (typeof document === 'undefined') {\n      return null;\n    }\n\n    if (!BubbleIcon._colorCanvas) {\n      const canvas = document.createElement('canvas');\n      canvas.width = canvas.height = 1;\n      BubbleIcon._colorCanvas = canvas;\n      BubbleIcon._colorCtx = canvas.getContext('2d', { willReadFrequently: true }) || canvas.getContext('2d');\n    }\n\n    const ctx = BubbleIcon._colorCtx;\n    if (!ctx) {\n      return null;\n    }\n\n    try {\n      ctx.fillStyle = '#000';\n      ctx.fillStyle = color;\n    } catch (_err) {\n      return null;\n    }\n\n    const normalized = ctx.fillStyle;\n    ctx.clearRect(0, 0, 1, 1);\n    ctx.fillStyle = normalized;\n    ctx.fillRect(0, 0, 1, 1);\n\n    const [r, g, b, a] = ctx.getImageData(0, 0, 1, 1).data;\n    return { r, g, b, a: a / 255 };\n  }\n\n  /* ───────────── GESTURE: identiche a BubbleSubButton ───────────── */\n  \n  _onDown = () => {\n    this._holdFired = false;\n    this._holdTimer = window.setTimeout(() => {\n      this._holdFired = true;\n      this._fireHassAction('hold');\n    }, this._holdThreshold);\n  };\n  \n  _onUp = () => {\n    this._clearHoldTimer();\n    if (!this._holdFired) this._fireHassAction('tap');\n  };\n  \n  _clearHoldTimer = () => {\n    if (this._holdTimer) {\n      clearTimeout(this._holdTimer);\n      this._holdTimer = null;\n    }\n  };\n  \n  /* ───────────── Evento emesso: stesso payload di BubbleSubButton ───────────── */\n  \n  /* ───────────── Evento emesso: stesso payload di BubbleSubButton ───────────── */\n  _fireHassAction(actionType /* 'tap' | 'hold' */ ) {\n    // Prendi la config dell'azione corrente (tap/hold)\n    const cfg = (actionType === 'hold' ? this.hold_action : this.tap_action) || { action: 'more-info' };\n    const action = cfg.action || 'more-info';\n    \n    // Alcune azioni richiedono l'entità; altre no.\n    const needsEntity = action === 'toggle' || action === 'call-service' || action === 'more-info';\n    \n    // Se l'azione richiede entity ma non c'è, non fare nulla;\n    // MA se è 'navigate' (o qualunque azione che non richiede entity), procedi comunque.\n    if (needsEntity && !this.entity_id) {\n      return;\n    }\n    \n    // Emetti l'evento come fa BubbleSubButton (anche se entity_id è vuota per \"navigate\").\n    const evt = new Event('hass-action', { bubbles: true, composed: true });\n    evt.detail = {\n      config: {\n        entity: this.entity_id, // può essere undefined/'' per 'navigate'\n        tap_action: this.tap_action || { action: 'more-info' },\n        hold_action: this.hold_action || { action: 'none' },\n      },\n      action: actionType,\n    };\n    this.dispatchEvent(evt);\n  }\n}\n\nBubbleIcon._colorCanvas = null;\nBubbleIcon._colorCtx = null;\n\ncustomElements.define('bubble-icon', BubbleIcon);\n","// src/bubble-room.js\nimport { LitElement, html, css } from 'lit';\nimport './bubble-room-editor.js';\nimport './components/BubbleSubButton.js';\nimport './components/BubbleName.js';\nimport './components/BubbleSensor.js';\nimport './components/BubbleMushroom.js';\nimport './components/BubbleIcon.js';\nimport { resolveEntityIcon } from './helpers/icon-mapping.js';\n\nexport class BubbleRoom extends LitElement {\n  static properties = {\n    config: { type: Object },\n    hass:   { type: Object },\n  };\n\n  /* copia mutabile delle entità (dx, dy, ecc.) */\n  _entities = {};\n\n  constructor() {\n    super();\n    this.config = {};\n    this.hass   = {};\n  }\n\n  /* ───────────── configurazione ───────────── */\n  setConfig(rawConfig) {\n    this.config = { layout: 'wide', ...rawConfig };\n    this._entities = structuredClone(this.config.entities || {});\n  \n    // default soft per i nuovi gruppi (se non ci sono)\n    this._entities.camera  = this._entities.camera  || { entity: '', icon: '' };\n    if (!this._entities.camera.presence) this._entities.camera.presence = { entity: '' };\n    this._entities.climate = this._entities.climate || { entity: '', icon: '' };\n  }\n  \n  get hass() {\n    return this._hass;\n  }\n  \n  set hass(hass) {\n    this._hass = hass;\n    // aggiorna il render solo quando arrivano davvero gli stati\n    if (hass?.states) {\n      this.requestUpdate?.();\n    }\n  }\n\n  static getStubConfig() {\n    return {\n      type: 'custom:bubble-room',\n      layout: 'wide',\n      name: [],\n      area: [],\n      sensors: [],\n      mushrooms: [],\n      subbuttons: [],\n      colors: {\n        subbutton: {\n          background_on: 'rgba(var(--color-blue),1)',\n          background_off: 'rgba(var(--color-blue),0.3)',\n          icon_on: 'yellow',\n          icon_off: '#666',\n        },\n      },\n    };\n  }\n\n  static async getConfigElement() {\n    await import('./bubble-room-editor.js');\n    return document.createElement('bubble-room-editor');\n  }\n\n  /* ───────────── ciclo vita ───────────── */\n  connectedCallback() {\n    super.connectedCallback();\n    this._resizeObs = new ResizeObserver(() => this.requestUpdate());\n  }\n  firstUpdated() {\n    const area = this.shadowRoot?.querySelector('.icon-mushroom-area');\n    area && this._resizeObs.observe(area);\n  }\n  disconnectedCallback() {\n    this._resizeObs?.disconnect();\n    super.disconnectedCallback();\n  }\n\n  /** riclona se l’utente modifica la card dall’editor */\n  updated(changed) {\n    if (changed.has('config')) {\n      this._entities = structuredClone(this.config.entities || {});\n    }\n  }\n\n  /* ───────────── sub-button helper ───────────── */\n  _getSubButtons() {\n    const bgOn   = this.config.colors?.subbutton?.background_on  ?? '#00d46d';\n    const bgOff  = this.config.colors?.subbutton?.background_off ?? '#999';\n    const iconOn = this.config.colors?.subbutton?.icon_on ?? 'yellow';\n    const iconOff= this.config.colors?.subbutton?.icon_off ?? '#666';\n  \n    return (this.config.subbuttons || []).map(sb => {\n      const stateObj = this.hass.states?.[sb.entity_id];\n  \n      // Ordine di priorità icona:\n      // 1) icona personalizzata in config\n      // 2) icona da entity (device_class / icon attribute / mapping)\n      let finalIcon = sb.icon || resolveEntityIcon(sb.entity_id, this.hass);\n  \n      const active = stateObj?.state === 'on';\n  \n      return {\n        icon: finalIcon,\n        active,\n        colorOn:  bgOn,\n        colorOff: bgOff,\n        iconOn,\n        iconOff,\n        entity_id: sb.entity_id,\n        tap_action: sb.tap_action,\n        hold_action: sb.hold_action,\n      };\n    });\n  }\n  \n\n  /* ───────────── presenza stanza ───────────── */\n  _isRoomActive() {\n    const entityId = this.config?.entities?.presence?.entity;\n    if (!entityId) return false;\n    const state = this.hass?.states?.[entityId]?.state;\n    return ['on', 'home', 'occupied', 'motion', 'detected'].includes(state);\n  }\n\n  /** lato dell’icona principale */\n  _getMainIconSize() {\n    const area = this.shadowRoot?.querySelector('.icon-mushroom-area');\n    if (!area) return 64;\n    return Math.round(Math.min(area.clientWidth, area.clientHeight) * 0.60);\n  }\n\n  /* ───────────── sensori ───────────── */\n  _getSensors() {\n    const entities = this._entities || {};\n    const sensorColorActive =\n      this.config.colors?.room?.sensor_active ??\n      this.config.colors?.room?.text_active ??\n      '#21df73';\n\n    const sensorColorInactive =\n      this.config.colors?.room?.sensor_inactive ??\n      this.config.colors?.room?.text_inactive ??\n      '#173c16';\n\n    const color = this._isRoomActive() ? sensorColorActive : sensorColorInactive;\n\n    const result = [];\n    for (let i = 1; i <= 6; i++) {\n      const entId = entities[`sensor${i}`]?.entity;\n      const st    = this.hass?.states?.[entId];\n      if (!entId || !st) continue;\n\n      result.push({\n        icon:  st.attributes.icon || '',\n        value: st.state,\n        unit:  st.attributes.unit_of_measurement,\n        device_class: st.attributes.device_class,\n        color,\n        entity: entId,\n      });\n    }\n    return result;\n  }\n\n  /* ───────────── mushroom ───────────── */\n  _getMushrooms() {\n    const entities = this._entities || {};\n  \n    const activeCol   = this.config.colors?.mushroom?.active   ?? '#00e676';\n    const inactiveCol = this.config.colors?.mushroom?.inactive ?? '#888';\n  \n    const list = [];\n  \n    // i “mushroom” normali (1..5) — ora passiamo anche entity_id, tap_action, hold_action\n    for (let i = 1; i <= 5; i++) {\n      const key   = `mushroom${i}`;\n      const conf  = entities[key] || {};\n      const entId = conf.entity;\n      const st    = this.hass?.states?.[entId];\n      if (!entId || !st) continue;\n  \n      list.push({\n        icon:  conf.icon || st.attributes.icon || resolveEntityIcon(entId, this.hass) || 'mdi:flash',\n        state: st.state,\n        color: st.state === 'on' ? activeCol : inactiveCol,\n        dx: conf.dx ?? 0,\n        dy: conf.dy ?? 0,\n        angle_deg: conf.angle_deg,\n        radius_factor: conf.radius_factor,\n\n        // >>> aggiunte per far funzionare le azioni impostate in MushroomPanel\n        entity_id: entId,\n        tap_action:  conf.tap_action,\n        hold_action: conf.hold_action,\n      });\n    }\n  \n    // 6) CAMERA (in alto a destra: posizione/scala gestite in BubbleMushroom)\n    const camCfg = entities.camera || {};\n    const camId  = camCfg.entity;\n    if (camId && this.hass.states?.[camId]) {\n      const st = this.hass?.states?.[camId];\n      const presId = camCfg.presence?.entity;\n      const presState = presId ? this.hass?.states?.[presId]?.state : undefined;\n      const presActive = presId ? ['on', 'home', 'occupied', 'motion', 'detected'].includes(presState) : true;\n      list.push({\n        icon: camCfg.icon || st.attributes.icon || resolveEntityIcon(camId, this.hass) || 'mdi:cctv',\n        state: st.state,\n        color: presActive ? activeCol : inactiveCol,\n        left: 'calc(100% - 12px - 36px)', // fisso in alto-destra\n        top: 12,\n        dx: 0,\n        dy: 0,\n        kind: 'camera',\n        angle_deg: camCfg.angle_deg,\n        radius_factor: camCfg.radius_factor,\n        entity_id: camId,\n        tap_action: { action: 'more-info' },\n        hold_action: { action: 'none' },\n      });\n    }\n  \n    // 7) CLIMATE (fisso via kind:'climate')\n    const cliCfg = this._entities?.climate || {};\n    const cliId = cliCfg.entity;\n    if (cliId && this.hass.states?.[cliId]) {\n      const st = this.hass?.states?.[cliId];\n      const isActive =\n        (st.state && st.state !== 'off' && st.state !== 'idle') ||\n        (st.attributes?.hvac_action && st.attributes.hvac_action !== 'off');\n      \n      list.push({\n        icon: cliCfg.icon || st.attributes.icon || resolveEntityIcon(cliId, this.hass) || 'mdi:thermostat',\n        state: st.state,\n        color: isActive ? activeCol : inactiveCol,\n        dx: 0,\n        dy: 0,\n        angle_deg: cliCfg.angle_deg,\n        radius_factor: cliCfg.radius_factor,\n        kind: 'climate',\n        entity_id: cliId,\n      });\n    }\n  \n    return list;\n  }\n  \n  /* stub click */\n  _onMushroomClick(_ev) {\n    /* puoi gestire altri eventi qui */\n  }\n\n  /* ───────────── render ───────────── */\n  render() {\n    const layout        = this.config.layout || 'wide';\n    const mainIconSize  = this._getMainIconSize();\n    const subbuttons    = this._getSubButtons();\n    const subbuttonMode = this.config?.subbutton_style || 'standard';\n    const isActive      = this._isRoomActive();\n\n    /* palette */\n    const iconColorActive   = this.config.colors?.room?.icon_active   ?? '#21df73';\n    const iconColorInactive = this.config.colors?.room?.icon_inactive ?? '#173c16';\n    const iconBgActive      = this.config.colors?.room?.background_active   ?? 'rgba(33,223,115,0.12)';\n    const iconBgInactive    = this.config.colors?.room?.background_inactive ?? 'rgba(23,60,22,0.12)';\n    const textColorActive   = this.config.colors?.room?.text_active   ?? '#ffffff';\n    const textColorInactive = this.config.colors?.room?.text_inactive ?? 'rgba(255,255,255,0.5)';\n\n    // Azioni per la main icon: uso quelle della card (tap/hold) e come fallback entity la \"presence\"\n    const mainEntity = this.config?.entities?.presence?.entity || '';\n    const tapAct     = this.config?.tap_action  || { action: 'more-info' };\n    const holdAct    = this.config?.hold_action || { action: 'none' };\n\n    return html`\n      <div class=\"bubble-room-grid ${layout}\">\n        <div class=\"main-area\">\n          <div class=\"row1\">\n            <bubble-sensor .sensors=\"${this._getSensors()}\"></bubble-sensor>\n\n            <div class=\"name-placeholder\" id=\"nameContainer\">\n              <bubble-name\n                .name=\"${this.config.name}\"\n                .area=\"${this.config.area}\"\n                .hass=${this.hass}\n                .config=${this.config}\n                .container=${this.shadowRoot?.getElementById('nameContainer')}\n                .preset=\"${subbuttonMode}\"\n                style=\"--bubble-room-name-color:${isActive ? textColorActive : textColorInactive}\"\n              ></bubble-name>\n            </div>\n          </div>\n\n          <div class=\"row2\">\n            <div class=\"icon-mushroom-area\">\n              <bubble-icon\n                .icon=\"${this.config.icon || resolveEntityIcon(this.config.entity, this.hass)}\"\n                .active=${isActive}\n                .colorActive=\"${iconColorActive}\"\n                .colorInactive=\"${iconColorInactive}\"\n                .backgroundActive=\"${iconBgActive}\"\n                .backgroundInactive=\"${iconBgInactive}\"\n                .preset=\"${subbuttonMode}\"\n                style=\"\n                  --main-icon-size:${mainIconSize}px;\n                  --icon-shift-x:-20%;\n                \"\n                .entity_id=${mainEntity}\n                .tap_action=${tapAct}\n                .hold_action=${holdAct}\n                @hass-action=${this._onMainIconAction}\n              ></bubble-icon>\n\n              <bubble-mushroom\n                .entities=\"${this._getMushrooms()}\"\n                .containerSize=\"${{ width: 180, height: 180 }}\"\n                @mushroom-entity-click=\"${this._onMushroomClick}\"\n              ></bubble-mushroom>\n            </div>\n            <div class=\"k-space\"></div>\n          </div>\n        </div>\n\n        <div class=\"sidebar\">\n          <bubble-subbutton\n            .subbuttons=\"${subbuttons}\"\n            .preset=\"${subbuttonMode}\"\n          ></bubble-subbutton>\n        </div>\n      </div>\n    `;\n  }\n\n  /* ───────────── esecuzione azioni main icon (come SubButton) ───────────── */\n  _onMainIconAction = (e) => {\n    // e.detail = { config:{ entity, tap_action, hold_action }, action: 'tap'|'hold' }\n    const { config, action } = e.detail || {};\n    if (!config) return;\n\n    const actCfg = action === 'hold'\n      ? (config.hold_action || { action: 'none' })\n      : (config.tap_action  || { action: 'none' });\n\n    this._runAction(actCfg, config.entity);\n  };\n\n  _runAction(actionCfg, fallbackEntity) {\n    const act = actionCfg?.action || 'none';\n    if (act === 'none') return;\n\n    switch (act) {\n      case 'navigate': {\n        const path = actionCfg.navigation_path || actionCfg.navigationPath;\n        if (path) {\n          window.history.pushState({}, '', path);\n          window.dispatchEvent(new Event('location-changed'));\n        }\n        break;\n      }\n      case 'more-info': {\n        const entityId = actionCfg.entity || fallbackEntity;\n        if (entityId) {\n          this.dispatchEvent(new CustomEvent('hass-more-info', {\n            detail: { entityId }, bubbles: true, composed: true\n          }));\n        }\n        break;\n      }\n      case 'toggle': {\n        const entityId = actionCfg.entity || fallbackEntity;\n        if (entityId && this.hass?.callService) {\n          this.hass.callService('homeassistant', 'toggle', { entity_id: entityId });\n        }\n        break;\n      }\n      case 'call-service': {\n        const srv = actionCfg.service || '';\n        const [domain, service] = srv.split('.');\n        if (domain && service && this.hass?.callService) {\n          const data = { ...(actionCfg.service_data || actionCfg.data || {}) };\n          if (!data.entity_id && fallbackEntity) data.entity_id = fallbackEntity;\n          this.hass.callService(domain, service, data);\n        }\n        break;\n      }\n      default:\n        // no-op\n        break;\n    }\n  }\n\n  /* ───────────── stili originali ───────────── */\n  static styles = css`\n    :host { display:block; height:100%; box-sizing:border-box; }\n    .bubble-room-grid { display:grid; grid-template-columns:2fr 1fr;\n      width:100%; height:100%; box-sizing:border-box; }\n    .main-area { display:grid; height:100%; min-height:0; box-sizing:border-box; }\n    .row1 { display:grid; min-height:0; box-sizing:border-box;\n      grid-template-columns:1fr; }\n    .row2 { display:grid; height:100%; min-height:0; box-sizing:border-box;\n    }\n    .name-placeholder { display:flex; align-items:center; justify-content:center;\n      width:100%; max-width:100%; height:100%; box-sizing:border-box;\n      contain:strict; flex-shrink:1; }\n    .icon-mushroom-area { box-sizing:border-box;\n      position:relative; width:100%; height:100%; display:flex; align-items:center; }\n    .k-space { box-sizing:border-box; }\n    .sidebar { display:flex; flex-direction:column; height:100%; min-height:0;\n      box-sizing:border-box; }\n\n    .bubble-room-grid.tall .main-area { grid-template-rows:1fr 2fr; }\n    .bubble-room-grid.tall .row1      { grid-template-rows:1fr 2fr; }\n    .bubble-room-grid.tall .row2      { grid-template-columns:1fr 0fr; }\n\n    .bubble-room-grid.wide .main-area { grid-template-rows:1fr 2fr; }\n    .bubble-room-grid.wide .row1      { grid-template-rows:1fr 2fr; }\n    .bubble-room-grid.wide .row2      { grid-template-columns:2fr 1fr; }\n  `;\n}\n\ncustomElements.define('bubble-room', BubbleRoom);\n\nwindow.customCards.push({\n  type: 'bubble-room',\n  name: 'Bubble Room',\n  description: 'All‑in‑one room card: control entities, see sensors, and tweak colors & layout.',\n  preview: false,\n  documentationURL: 'https://github.com/mon3y78/Lovelace-Bubble-room',\n});"],"names":["t","window","e","ShadowRoot","ShadyCSS","nativeShadow","Document","prototype","CSSStyleSheet","s","Symbol","n","WeakMap","o","constructor","this","_$cssResult$","Error","cssText","styleSheet","length","get","replaceSync","set","toString","i","reduce","c","cssRules","r","trustedTypes","h","emptyScript","reactiveElementPolyfillSupport","toAttribute","Boolean","Object","Array","JSON","stringify","fromAttribute","Number","parse","a","l","attribute","type","String","converter","reflect","hasChanged","d","u","HTMLElement","super","_$Ei","Map","isUpdatePending","hasUpdated","_$El","_$Eu","addInitializer","finalize","push","observedAttributes","elementProperties","forEach","_$Ep","_$Ev","createProperty","state","noAccessor","hasOwnProperty","getPropertyDescriptor","defineProperty","requestUpdate","configurable","enumerable","getPropertyOptions","getPrototypeOf","properties","getOwnPropertyNames","getOwnPropertySymbols","elementStyles","finalizeStyles","styles","isArray","Set","flat","reverse","unshift","toLowerCase","_$E_","Promise","enableUpdating","_$AL","_$Eg","addController","_$ES","renderRoot","isConnected","hostConnected","call","removeController","splice","indexOf","createRenderRoot","shadowRoot","attachShadow","shadowRootOptions","adoptedStyleSheets","map","document","createElement","litNonce","setAttribute","textContent","appendChild","connectedCallback","disconnectedCallback","hostDisconnected","attributeChangedCallback","_$AK","_$EO","removeAttribute","has","_$EC","_$Ej","reject","scheduleUpdate","performUpdate","shouldUpdate","willUpdate","hostUpdate","update","_$Ek","_$AE","hostUpdated","firstUpdated","updated","updateComplete","getUpdateComplete","mode","ReactiveElement","reactiveElementVersions","createPolicy","createHTML","Math","random","slice","createComment","f","_","m","p","RegExp","g","$","y","x","_$litType$","strings","values","w","T","for","A","E","C","createTreeWalker","P","V","v","lastIndex","exec","test","startsWith","N","parts","el","currentNode","content","firstChild","remove","append","childNodes","nextNode","nodeType","hasAttributes","getAttributeNames","endsWith","getAttribute","split","index","name","ctor","H","L","z","k","tagName","data","innerHTML","S","_$Co","_$Cl","_$litDirective$","_$AO","_$AT","_$AS","M","_$AV","_$AN","_$AD","_$AM","parentNode","_$AU","creationScope","importNode","R","nextSibling","Z","_$AI","_$AH","_$AA","_$AB","options","_$Cp","startNode","endNode","_$AR","iterator","insertBefore","createTextNode","_$AC","_$AP","setConnected","element","fill","j","arguments","I","capture","once","passive","removeEventListener","addEventListener","handleEvent","host","B","litHtmlPolyfillSupport","litHtmlVersions","renderOptions","_$Do","renderBefore","render","_$litPart$","finalized","_$litElement$","globalThis","litElementHydrateSupport","LitElement","litElementPolyfillSupport","litElementVersions","FILTER_LABELS","alarm_control_panel","binary_sensor","camera","climate","cover","fan","light","lock","media_player","scene","script","siren","vacuum","motion","occupancy","presence","moving","door","opening","garage_door","vibration","sound","moisture","water","smoke","gas","carbon_monoxide","cold","heat","light_level","connectivity","lock_dc","plug","power","problem","running","safety","tamper","switch","input_boolean","COMMON_CATS","BINARY_SENSOR_CATS","FILTERS","cats","includeDomains","entityFilter","id","hass","domain","dc","states","attributes","device_class","includes","_cats","_id","_hass","_isValidAreaId","areaId","trim","_matchAreaId","entityId","entReg","entities","entity_id","_toEntityMap","devReg","devices","device_id","_toDeviceMap","regEnt","area_id","devId","deviceId","attrAreaId","candidatesFor","config","section","desc","byDesc","keys","filter","scoped","area","inArea","eid","entitiesInArea","filtered","selectedAll","sectionConfig","acc","walk","add","from","_extractSelectedEntities","subbuttons","list","selected","out","sel","_keepSelectedFirst","DEBUG","__BUBBLE_DEBUG__","maybeAutoDiscover","changedProp","debug","ad","auto_discovery_sections","isAreaChange","isADChange","console","info","sections","_cache","IconCache","_e","_m","DEFAULT_ICON","DOMAIN_ICON_MAP","sensor","humidifier","DEVICE_CLASS_ICON_MAP","on","off","garage","battery","blind","curtain","shutter","awning","shade","gate","damper","_stateIsOnLike","resolveEntityIcon","b","_normalizeArgs","cached","st","attrs","_domain","icon","devClass","domainIconMap","iconOn","iconOff","fallback","_list","mdiIcons","sort","warm","PRESENCE_CATS","RoomPanel","static","_expanded","activeFilters","layout","css","_syncingFromConfig","changed","presence_filters","cfgLayout","pres","entity","roomIcon","autoIcon","_fire","_onLayoutClick","grid","columns","rows","prop","val","dispatchEvent","CustomEvent","detail","bubbles","composed","_onPresenceEntityChange","ent","currentIcon","_onAreaChange","cfg","mushroom","subbutton","next","toUpperCase","_presenceCandidatesNoArea","filters","allowed","ids","wants","size","autoDisc","presEntity","presFilters","filterOptions","cat","value","label","charAt","presCandidates","actions","tapCfg","tap_action","holdCfg","hold_action","html","expanded","target","checked","select","multiple","include_entities","action","navigation_path","service","service_data","undefined","cmd","customElements","define","SENSOR_TYPE_MAP","temperature","emoji","units","apparent_temperature","humidity","pressure","illuminance","sound_pressure","pm1","pm2_5","pm10","co2","uv_index","irradiance","wind_speed","formatter","unit","isNaN","toFixed","speed","wind_gust","wind_bearing","precipitation","precipitation_intensity","precipitation_probability","cloud_coverage","visibility","dew_point","energy","power_factor","voltage","current","frequency","apparent_power","reactive_power","monetary","signal_strength","_fallback","sharedPanelStyles","SensorPanel","_filters","_entities","allTypes","_ignoreNextFilterChange","key","cfgFilter","sensor_filters","cfgEnt","entries","niceLabel","replace","_toggleAuto","open","_renderSensor","_reset","types","cands","allIds","hasTypes","typeSet","_togglePill","_clearFilter","_onFilter","_onEntity","stateObj","unit_of_measurement","idx","all","delete","arr","querySelector","MushroomPanel","_icons","_ALL_CATS","cfgFilters","mushroom_filters","ents","rec","pending","cfgIcon","iconFromState","autoIco","_renderMushroom","cfgNoArea","_onIcon","_onAction","_extraFields","act","_safeJson","txt","nextFilters","field","_autoIconFor","SubButtonPanel","_filtersHydrated","min","existing","subbutton_filters","_renderSubButton","_emit","vals","newFilters","patch","ColorPanel","_room","_subbutton","_mushroom","_sensor","_selectedPreset","_expandedColors","_subbuttonStyle","colors","icon_active","room","icon_inactive","background_active","background_inactive","text_active","text_inactive","background_on","background_off","icon_on","icon_off","active","inactive","sensor_active","sensor_inactive","subbutton_style","PRESETS","green","sub","blue","amber","purple","red","yellow","teal","gray","_renderStyleChooser","_renderPresetChooser","_toggleColor","_renderColorField","_resetColors","description","opt","_renderStyleCard","isSelected","_selectStyle","_onStyleKeydown","_renderPresetCard","_applySelectedPreset","roomA","roomI","iconA","iconI","rgba","_parseRGBA","hex","padStart","join","_updateColor","_updateColorRaw","preset","ops","sec","str","parseInt","alpha","raw","style","event","preventDefault","CameraPanel","_entity","_icon","_candidates","_presence","_presenceCandidates","presBin","presIds","_onPresence","ClimatePanel","ico","BubbleRoomEditor","openPanel","_onPanelChanged","bind","_onPanelCmd","_togglePanel","_onConfigChanged","setConfig","_emitConfig","withType","_setConfigValue","path","structuredClone","cur","stopPropagation","prev","isArea","isAD","applied","presence_entity","resetRoom","resetSensors","resetMushrooms","resetSubButtons","resetClimate","resetCamera","opened","BubbleSubButton","_holdThreshold","_holdTimer","_holdFired","_currentIndex","_renderStandard","_renderLiquidGlass","btn","bg","colorOn","colorOff","color","_onDown","_onUp","_clearHoldTimer","glass","_computeGlassColors","styleVars","iconTone","_computeIconTone","surface","base","highlight","soft","sheen","accent","rgb","shadow","shadowHover","shadowActive","shadowRgb","brightened","_lightenColor","borderPalette","_computeBorderColors","hover","rimPalette","_computeGlowPalette","glow","rim","rimSoft","rimShadow","styleAttr","classes","setTimeout","_fireHassAction","clearTimeout","weight","_colorToRgb","mixRatio","max","mixed","_mixWithWhite","isActive","intensified","_boostColorIntensity","rgbString","softened","softenedString","alphas","border","borderHover","borderActive","round","baseAlpha","hoverAlpha","activeAlpha","_rgbToCss","luminous","ratio","mix","amount","factor","boost","boosted","clampedAlpha","_colorCanvas","canvas","width","height","_colorCtx","getContext","willReadFrequently","ctx","fillStyle","err","normalized","clearRect","fillRect","getImageData","actionType","actionConfig","evt","Event","BubbleName","container","fitMode","stretchY","_raf","_resizeObs","_lastScale","_lastBox","_ensureFonts","root","pre","rel","href","crossOrigin","link","requestAnimationFrame","_scheduleScale","ResizeObserver","entry","contentBoxSize","box","inlineSize","blockSize","rect","getBoundingClientRect","abs","observe","desiredStretch","disconnect","_autoScaleFont","parentElement","currentText","boxW","clientWidth","boxH","clientHeight","text","fontSize","transform","MAX","targetPx","lo","hi","mid","scrollHeight","sw","scrollWidth","floor","transformOrigin","BubbleSensor","sensors","_resizeObserver","_resizeScheduled","_autoscaleScheduled","_pillCache","_pendingChanged","_sharedSize","_updateLayout","clear","_scheduleAutoscale","changedProperties","changedIdx","_diffChangedSensorIndices","count","changedIndices","_mergeChanged","payload","_autoScaleValues","_keyForPill","pill","_textWeight","_measureAndApply","_fitValueAndUnit","valueEl","unitEl","labelEl","iconEl","bestPx","parseFloat","getComputedStyle","best","_applySharedSize","shared","unitText","labelTxt","iconName","pills","querySelectorAll","targetPills","groups","group","worst","worstScore","sharedComputed","cacheKey","maxWidth","maxHeight","vW","offsetWidth","vH","offsetHeight","uW","uH","lW","lH","iW","iH","totalWidth","totalHeight","_formatValueForCompare","match","isFinite","isInteger","_formatValueForDisplay","decimals","trimIntegers","_getSensorKey","nextIndexByKey","prevSensor","prevIndex","_openMoreInfo","ev","title","BubbleMushroom","_containerSize","_rafSize","_ro","cr","contentRect","cancelAnimationFrame","_lastTapTs","_updateSize","_handleClick","_dispatchAction","which","double_tap_action","_onPointerDown","_onPointerUp","now","Date","_onPointerCancel","vpWidth","innerWidth","kMobile","sideW","rxRaw","ryRaw","rX","rY","cX","cY","rArcX","rArcY","deg","PI","a30","aFlat","dCam","dCli","positionsGeneric","cos","sin","genIdx","isCam","kind","isCli","iconSize","useDx","dx","useDy","dy","left","top","BubbleIcon","colorActive","colorInactive","backgroundActive","backgroundInactive","fg","rawBg","isLiquid","_withOpacity","iconOpacity","styleChunks","containerStyle","chunk","parsed","_parseColor","_err","BubbleRoom","rawConfig","getStubConfig","mushrooms","getConfigElement","_getSubButtons","bgOn","bgOff","sb","_isRoomActive","_getMainIconSize","_getSensors","sensorColorActive","sensorColorInactive","result","entId","_getMushrooms","activeCol","inactiveCol","conf","angle_deg","radius_factor","camCfg","camId","presId","presState","presActive","cliCfg","cliId","hvac_action","_onMushroomClick","_ev","mainIconSize","subbuttonMode","iconColorActive","iconColorInactive","iconBgActive","iconBgInactive","textColorActive","textColorInactive","mainEntity","tapAct","holdAct","getElementById","_onMainIconAction","actCfg","_runAction","actionCfg","fallbackEntity","navigationPath","history","pushState","callService","srv","customCards","preview","documentationURL"],"mappings":"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"}